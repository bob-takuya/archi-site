import{u as $t,a as Nt,j as e,A as Yt,T as Ft,b as i,I as Qe,M as Ot,D as ct,B as s,C as Zt,L as dt,c as ht,d as xt,e as k,H as Lt,f as Ze,P as ke,g as Ie,S as Bt,h as te,G as P,i as ae,k as pe,l as fe,F as be,m as rt,n as O,o as Ae,p as ze,q as Ht,r as Ce,R as Pt,s as tt,t as Me,v as le,w as Ue,x as Je,y as ut,z as mt,E as gt,J as pt,K as ft,N as ee,O as zt,Q as jt,U as Be,V as $e,W as yt,X as He,Y as bt,Z as _e,_ as Ve,$ as Ct,a0 as Mt,a1 as Ut,a2 as Gt,a3 as Kt,a4 as qt,a5 as Qt,a6 as Jt,a7 as Vt,a8 as Xt,a9 as er,aa as tr,ab as me,ac as U,ad as rr,ae as sr,af as nr,ag as ar,ah as or,ai as ir}from"./ui-CyZ5RW7z.js";import{a as lr,u as Ge,r as x,L as B,e as Ke,f as At,R as Tt,H as cr,h as dr,i as Ee}from"./vendor-C30vB44U.js";import{d as hr}from"./database-C3TWL7Qm.js";import{L as Et,M as xr,T as ur,a as st,P as nt}from"./map-C0JyOu4T.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const l of document.querySelectorAll('link[rel="modulepreload"]'))g(l);new MutationObserver(l=>{for(const m of l)if(m.type==="childList")for(const d of m.addedNodes)d.tagName==="LINK"&&d.rel==="modulepreload"&&g(d)}).observe(document,{childList:!0,subtree:!0});function o(l){const m={};return l.integrity&&(m.integrity=l.integrity),l.referrerPolicy&&(m.referrerPolicy=l.referrerPolicy),l.crossOrigin==="use-credentials"?m.credentials="include":l.crossOrigin==="anonymous"?m.credentials="omit":m.credentials="same-origin",m}function g(l){if(l.ep)return;l.ep=!0;const m=o(l);fetch(l.href,m)}})();var It,at=lr;It=at.createRoot,at.hydrateRoot;const ot=[{title:"ホーム",path:"/",icon:e.jsx(Lt,{})},{title:"建築作品",path:"/architecture",icon:e.jsx(Ze,{})},{title:"建築家",path:"/architects",icon:e.jsx(ke,{})},{title:"マップ",path:"/map",icon:e.jsx(Ie,{})},{title:"DBエクスプローラー",path:"/db-explorer",icon:e.jsx(Bt,{})}],mr=()=>{const t=Ge().pathname,o=$t(),g=Nt(o.breakpoints.down("sm")),[l,m]=x.useState(!1),d=c=>a=>{a.type==="keydown"&&(a.key==="Tab"||a.key==="Shift")||m(c)};return e.jsx(Yt,{position:"static",color:"primary",component:"nav",role:"navigation","aria-label":"メインナビゲーション",children:e.jsxs(Ft,{children:[e.jsx(i,{variant:"h6",component:B,to:"/","data-testid":"site-title",sx:{flexGrow:1,color:"white",textDecoration:"none",fontWeight:"bold"},children:"建築データベース"}),g?e.jsxs(e.Fragment,{children:[e.jsx(Qe,{edge:"end",color:"inherit","aria-label":"menu","data-testid":"mobile-menu-button",onClick:d(!0),children:e.jsx(Ot,{})}),e.jsx(ct,{anchor:"right",open:l,onClose:d(!1),children:e.jsxs(s,{sx:{width:250},role:"presentation",onClick:d(!1),onKeyDown:d(!1),children:[e.jsx(s,{sx:{display:"flex",justifyContent:"flex-end",p:1},children:e.jsx(Qe,{onClick:d(!1),children:e.jsx(Zt,{})})}),e.jsx(dt,{role:"menu","aria-label":"ナビゲーションメニュー",children:ot.map(({title:c,path:a,icon:f})=>e.jsxs(ht,{component:B,to:a,role:"menuitem","data-testid":`nav-link-${c.toLowerCase()}`,sx:{color:t===a?"primary.main":"text.primary",backgroundColor:t===a?"rgba(0, 0, 0, 0.08)":"transparent",fontWeight:t===a?"bold":"normal","&:hover":{backgroundColor:"rgba(0, 0, 0, 0.04)"}},children:[f,e.jsx(xt,{primary:c,sx:{ml:2}})]},c))})]})})]}):e.jsx(s,{sx:{display:"flex"},role:"menubar","aria-label":"デスクトップナビゲーション",children:ot.map(({title:c,path:a})=>e.jsx(k,{component:B,to:a,color:"inherit",role:"menuitem","data-testid":`nav-link-${c.toLowerCase()}`,sx:{mx:1,fontWeight:t===a?"bold":"normal",borderBottom:t===a?"2px solid white":"none"},children:c},c))})]})})},gr=()=>e.jsx(s,{component:"footer",role:"contentinfo","data-testid":"footer",sx:{py:3,px:2,mt:"auto",backgroundColor:"primary.main",color:"white"},children:e.jsx(te,{maxWidth:"sm",children:e.jsxs(i,{variant:"body1",align:"center",children:["建築データベース © ",new Date().getFullYear()]})})}),pr="modulepreload",fr=function(n,t){return new URL(n,t).href},it={},jr=function(t,o,g){let l=Promise.resolve();if(o&&o.length>0){const d=document.getElementsByTagName("link"),c=document.querySelector("meta[property=csp-nonce]"),a=c?.nonce||c?.getAttribute("nonce");l=Promise.allSettled(o.map(f=>{if(f=fr(f,g),f in it)return;it[f]=!0;const p=f.endsWith(".css"),A=p?'[rel="stylesheet"]':"";if(!!g)for(let C=d.length-1;C>=0;C--){const D=d[C];if(D.href===f&&(!p||D.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${f}"]${A}`))return;const T=document.createElement("link");if(T.rel=p?"stylesheet":pr,p||(T.as="script"),T.crossOrigin="",T.href=f,a&&T.setAttribute("nonce",a),document.head.appendChild(T),p)return new Promise((C,D)=>{T.addEventListener("load",C),T.addEventListener("error",()=>D(new Error(`Unable to preload CSS for ${f}`)))})}))}function m(d){const c=new Event("vite:preloadError",{cancelable:!0});if(c.payload=d,window.dispatchEvent(c),!c.defaultPrevented)throw d}return l.then(d=>{for(const c of d||[])c.status==="rejected"&&m(c.reason);return t().catch(m)})},lt=({variant:n="card",count:t=6})=>{const o=()=>e.jsx(pe,{sx:{height:"100%"},children:e.jsxs(fe,{children:[e.jsx(ae,{variant:"text",height:40,sx:{mb:1}}),e.jsx(ae,{variant:"text",height:20,sx:{mb:1}}),e.jsx(ae,{variant:"text",height:20,width:"60%"})]})}),g=()=>e.jsxs(s,{sx:{p:2},children:[e.jsx(ae,{variant:"text",height:32,sx:{mb:1}}),e.jsx(ae,{variant:"text",height:24,sx:{mb:1}}),e.jsx(ae,{variant:"text",height:20,width:"40%"})]}),l=()=>e.jsx(te,{maxWidth:"lg",children:e.jsxs(s,{sx:{textAlign:"center",py:8},children:[e.jsx(ae,{variant:"text",height:60,sx:{mb:2}}),e.jsx(ae,{variant:"text",height:30,sx:{mb:4}}),e.jsx(s,{sx:{display:"flex",justifyContent:"center",mb:4},children:e.jsx(ae,{variant:"rectangular",width:500,height:56,sx:{borderRadius:1}})})]})}),m=()=>e.jsx(ae,{variant:"rectangular",width:"100%",height:400,sx:{borderRadius:2}});return n==="hero"?l():n==="map"?m():n==="list"?e.jsx(s,{children:Array.from({length:t}).map((d,c)=>e.jsx(s,{sx:{borderBottom:"1px solid #e0e0e0"},children:g()},c))}):e.jsx(P,{container:!0,spacing:4,children:Array.from({length:t}).map((d,c)=>e.jsx(P,{item:!0,xs:12,sm:6,md:4,children:o()},c))})},yr=()=>{const[n,t]=x.useState(""),[o,g]=x.useState([]),[l,m]=x.useState(!0),[d,c]=x.useState(null),[a,f]=x.useState(!1);x.useEffect(()=>{const A=setTimeout(()=>{console.warn("Emergency timeout: forcing app to render without database"),m(!1),f(!1),c("データベースの初期化がタイムアウトしました")},3e3);return(async()=>{try{m(!0),c(null),console.log("最近の建築作品を取得中...");const{getAllArchitectures:T}=await jr(async()=>{const{getAllArchitectures:q}=await Promise.resolve().then(()=>Er);return{getAllArchitectures:q}},void 0,import.meta.url),C=new Promise((q,u)=>{setTimeout(()=>u(new Error("データベース接続がタイムアウトしました")),5e3)}),D=T(1,6),M=await Promise.race([D,C]);clearTimeout(A),g(M.items),f(!0),console.log("建築作品の取得に成功しました",M)}catch(T){console.error("建築作品の取得に失敗:",T),clearTimeout(A),c(T.message||"データベースからの読み込みに失敗しました"),f(!1)}finally{m(!1)}})(),()=>{clearTimeout(A)}},[]);const p=A=>{A.preventDefault(),n.trim()&&(window.location.href=`/architecture?search=${encodeURIComponent(n)}`)};return e.jsxs(te,{maxWidth:"lg","data-testid":"homepage-container",children:[e.jsx(be,{in:!0,timeout:1e3,children:e.jsxs(s,{component:"section",role:"banner","aria-labelledby":"main-heading",sx:{pt:8,pb:6,textAlign:"center",background:"linear-gradient(135deg, #ECEFF4 0%, #D8DEE9 100%)",borderRadius:3,mb:6,position:"relative",overflow:"hidden"},children:[e.jsx(s,{sx:{position:"absolute",top:0,left:0,right:0,bottom:0,opacity:.1,background:"repeating-linear-gradient(45deg, transparent, transparent 10px, rgba(46, 52, 64, 0.1) 10px, rgba(46, 52, 64, 0.1) 20px)"}}),e.jsxs(s,{sx:{position:"relative",zIndex:1},children:[e.jsx(i,{component:"h1",variant:"h1",align:"center",color:"text.primary",gutterBottom:!0,id:"main-heading",sx:{background:"linear-gradient(135deg, #2E3440 0%, #4C566A 100%)",backgroundClip:"text",WebkitBackgroundClip:"text",color:"transparent",mb:2},children:"建築データベース"}),e.jsxs(i,{variant:"h5",align:"center",color:"text.secondary",paragraph:!0,sx:{mb:4,maxWidth:600,mx:"auto"},children:["日本の建築作品と建築家を検索・閲覧できる",e.jsx("br",{}),"包括的なデータベース"]}),e.jsxs(rt,{direction:"row",spacing:3,justifyContent:"center",sx:{mb:4},children:[e.jsx(O,{icon:e.jsx(Ze,{}),label:"14,000+ 建築作品",color:"primary",variant:"outlined"}),e.jsx(O,{icon:e.jsx(ke,{}),label:"2,900+ 建築家",color:"secondary",variant:"outlined"}),e.jsx(O,{icon:e.jsx(Ie,{}),label:"全国対応",color:"info",variant:"outlined"})]}),e.jsx(be,{in:!0,timeout:1500,children:e.jsxs(s,{component:"form",onSubmit:p,role:"search","aria-label":"建築作品検索",sx:{mt:4,display:"flex",justifyContent:"center",alignItems:"center",maxWidth:600,mx:"auto",gap:2},children:[e.jsx(Ae,{fullWidth:!0,variant:"outlined",placeholder:"建築作品、建築家、住所などで検索",value:n,onChange:A=>t(A.target.value),inputProps:{"aria-label":"建築作品検索","data-testid":"search-input",role:"searchbox"},sx:{"& .MuiOutlinedInput-root":{backgroundColor:"white",boxShadow:"0 4px 12px rgba(0, 0, 0, 0.1)"}}}),e.jsx(k,{type:"submit",variant:"contained",color:"primary",startIcon:e.jsx(ze,{}),size:"large","data-testid":"search-button",sx:{px:3,py:1.5,minWidth:120},children:"検索"})]})}),!a&&e.jsx(lt,{variant:"hero"})]})]})}),e.jsxs(s,{component:"section","aria-labelledby":"recent-works-heading",sx:{py:4},children:[e.jsxs(s,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:3},children:[e.jsxs(s,{sx:{display:"flex",alignItems:"center",gap:2},children:[e.jsx(Ht,{color:"primary"}),e.jsx(i,{variant:"h4",fontWeight:"bold",id:"recent-works-heading",component:"h2",children:"最近の建築作品"})]}),a&&e.jsx(Ce,{title:"リフレッシュ",children:e.jsx(Qe,{onClick:()=>window.location.reload(),color:"primary",children:e.jsx(Pt,{})})})]}),d&&e.jsx(be,{in:!0,children:e.jsx(tt,{severity:"error",sx:{mb:3,borderRadius:2,"& .MuiAlert-message":{display:"flex",alignItems:"center",gap:2}},children:e.jsxs(s,{children:[d,e.jsx(k,{size:"small",variant:"outlined",sx:{ml:2},component:B,to:"/db-explorer",children:"診断ツールを開く"})]})})}),l?e.jsx(lt,{variant:"card",count:6}):o.length>0?e.jsx(be,{in:!0,timeout:800,children:e.jsx(P,{container:!0,spacing:4,children:o.map((A,_)=>e.jsx(P,{item:!0,xs:12,sm:6,md:4,children:e.jsx(be,{in:!0,timeout:1e3+_*200,children:e.jsx(pe,{sx:{height:"100%",display:"flex",flexDirection:"column",background:"linear-gradient(135deg, #FFFFFF 0%, #F8F9FA 100%)",border:"1px solid #E5E9F0","&:hover":{"& .card-content":{transform:"translateY(-2px)"}}},children:e.jsx(Me,{component:B,to:`/architecture/${A.ZAW_ID}`,sx:{height:"100%"},children:e.jsxs(fe,{className:"card-content",sx:{flexGrow:1,transition:"transform 0.3s ease-in-out",p:3},children:[e.jsx(i,{gutterBottom:!0,variant:"h6",component:"h3",sx:{fontWeight:600,color:"text.primary",mb:2,lineHeight:1.3},children:A.ZAW_NAME}),e.jsxs(rt,{spacing:1,children:[e.jsxs(s,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(ke,{fontSize:"small",color:"secondary"}),e.jsx(i,{variant:"body2",color:"text.secondary",children:A.ZAW_ARCHITECT||"建築家不明"})]}),e.jsxs(s,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(Ie,{fontSize:"small",color:"secondary"}),e.jsxs(i,{variant:"body2",color:"text.secondary",children:[A.ZAW_ADDRESS||"場所不明"," • ",A.ZAW_YEAR&&A.ZAW_YEAR!==0?A.ZAW_YEAR+"年":"年代不明"]})]})]})]})})})})},A.ZAW_ID))})}):e.jsxs(le,{sx:{p:6,textAlign:"center",background:"linear-gradient(135deg, #F8F9FA 0%, #ECEFF4 100%)"},children:[e.jsx(i,{variant:"h6",color:"text.secondary",gutterBottom:!0,children:"建築作品が見つかりませんでした"}),e.jsx(i,{variant:"body2",color:"text.secondary",children:"データベースの接続を確認してください"})]}),a&&e.jsx(be,{in:!0,timeout:1200,children:e.jsx(s,{sx:{display:"flex",justifyContent:"center",mt:4},children:e.jsx(k,{variant:"outlined",color:"primary",component:B,to:"/architecture",size:"large",sx:{px:4,py:1.5,borderWidth:2,"&:hover":{borderWidth:2}},children:"すべての作品を見る"})})})]}),e.jsx(Ue,{sx:{my:6}}),e.jsx(be,{in:!0,timeout:1400,children:e.jsxs(s,{component:"section","aria-labelledby":"features-heading",sx:{mb:6},children:[e.jsx(i,{variant:"h4",align:"center",gutterBottom:!0,id:"features-heading",component:"h2",sx:{mb:4,fontWeight:"bold"},children:"データベースの特徴"}),e.jsxs(P,{container:!0,spacing:4,children:[e.jsx(P,{item:!0,xs:12,md:4,children:e.jsxs(pe,{sx:{height:"100%",display:"flex",flexDirection:"column",background:"linear-gradient(135deg, #88C0D0 0%, #5E81AC 100%)",color:"white",position:"relative",overflow:"hidden"},children:[e.jsx(s,{sx:{position:"absolute",top:-20,right:-20,opacity:.2},children:e.jsx(Ze,{sx:{fontSize:100}})}),e.jsxs(fe,{sx:{position:"relative",zIndex:1,p:3},children:[e.jsxs(s,{sx:{display:"flex",alignItems:"center",mb:2},children:[e.jsx(Ze,{sx:{mr:2,fontSize:32}}),e.jsx(i,{variant:"h5",fontWeight:"bold",children:"建築作品"})]}),e.jsx(i,{paragraph:!0,sx:{mb:3,opacity:.9},children:"日本全国から14,000件以上の建築作品情報を閲覧できます。地域、年代、カテゴリーなどで詳細検索が可能です。"}),e.jsx(k,{variant:"contained",component:B,to:"/architecture",sx:{mt:"auto",backgroundColor:"rgba(255, 255, 255, 0.2)",color:"white","&:hover":{backgroundColor:"rgba(255, 255, 255, 0.3)"}},children:"作品を探す"})]})]})}),e.jsx(P,{item:!0,xs:12,md:4,children:e.jsxs(pe,{sx:{height:"100%",display:"flex",flexDirection:"column",background:"linear-gradient(135deg, #D08770 0%, #BF616A 100%)",color:"white",position:"relative",overflow:"hidden"},children:[e.jsx(s,{sx:{position:"absolute",top:-20,right:-20,opacity:.2},children:e.jsx(ke,{sx:{fontSize:100}})}),e.jsxs(fe,{sx:{position:"relative",zIndex:1,p:3},children:[e.jsxs(s,{sx:{display:"flex",alignItems:"center",mb:2},children:[e.jsx(ke,{sx:{mr:2,fontSize:32}}),e.jsx(i,{variant:"h5",fontWeight:"bold",children:"建築家"})]}),e.jsx(i,{paragraph:!0,sx:{mb:3,opacity:.9},children:"2,900人以上の建築家情報を収録。経歴、作品リスト、所属事務所などの詳細情報を確認できます。"}),e.jsx(k,{variant:"contained",component:B,to:"/architects",sx:{mt:"auto",backgroundColor:"rgba(255, 255, 255, 0.2)",color:"white","&:hover":{backgroundColor:"rgba(255, 255, 255, 0.3)"}},children:"建築家を探す"})]})]})}),e.jsx(P,{item:!0,xs:12,md:4,children:e.jsxs(pe,{sx:{height:"100%",display:"flex",flexDirection:"column",background:"linear-gradient(135deg, #A3BE8C 0%, #8CAF69 100%)",color:"white",position:"relative",overflow:"hidden"},children:[e.jsx(s,{sx:{position:"absolute",top:-20,right:-20,opacity:.2},children:e.jsx(Ie,{sx:{fontSize:100}})}),e.jsxs(fe,{sx:{position:"relative",zIndex:1,p:3},children:[e.jsxs(s,{sx:{display:"flex",alignItems:"center",mb:2},children:[e.jsx(Ie,{sx:{mr:2,fontSize:32}}),e.jsx(i,{variant:"h5",fontWeight:"bold",children:"マップ表示"})]}),e.jsx(i,{paragraph:!0,sx:{mb:3,opacity:.9},children:"建築作品を地図上で視覚的に探索できます。位置情報をもとに周辺の建築作品を発見できます。"}),e.jsx(k,{variant:"contained",component:B,to:"/map",sx:{mt:"auto",backgroundColor:"rgba(255, 255, 255, 0.2)",color:"white","&:hover":{backgroundColor:"rgba(255, 255, 255, 0.3)"}},children:"マップを開く"})]})]})})]})]})})]})},br={from:"cdn",config:{serverMode:"full",requestChunkSize:4096,url:"./db/archimap.sqlite"}},Cr="./sql-wasm.js",Ar="./sql-wasm.wasm";let ge=null,Xe=!1,We=null;var Le=(n=>(n.NOT_INITIALIZED="not_initialized",n.INITIALIZING="initializing",n.READY="ready",n.ERROR="error",n))(Le||{});const Tr=()=>ge?"ready":Xe?"initializing":"not_initialized",vt=async()=>{if(ge)return ge;if(We)return We;Xe=!0;try{We=hr.createDbWorker([br],Cr,Ar,()=>console.log("データベースワーカーの準備完了")),ge=await We,console.log("データベース接続を確立しました");const n=await ge.db.exec("SELECT sqlite_version()");return console.log(`SQLite バージョン: ${n[0]?.values[0][0]}`),ge}catch(n){throw console.error("データベース初期化エラー:",n),n}finally{Xe=!1,We=null}},Rt=async(n,t=[])=>{try{return ge||await vt(),await ge.db.exec(n,t)}catch(o){throw console.error("クエリ実行エラー:",o),o}},St=n=>{if(!n||n.length===0)return[];const{columns:t,values:o}=n[0];return o.map(g=>{const l={};return t.forEach((m,d)=>{l[m]=g[d]}),l})},qe=async(n,t=[])=>{const o=await Rt(n,t);return St(o)[0]},Ne=async(n,t=[])=>{const o=await Rt(n,t);return St(o)},wt=async n=>qe("SELECT * FROM ZCDARCHITECTURE WHERE ZAW_ID = ?",[n]),Dt=async(n=1,t=12,o="",g="ZAW_NAME",l="asc",m={})=>{const d=(n-1)*t;let c="1=1";const a=[];o&&(c+=" AND (ZAW_NAME LIKE ? OR ZAW_ADDRESS LIKE ? OR ZAW_DETAIL LIKE ?)",a.push(`%${o}%`,`%${o}%`,`%${o}%`)),m.architect&&(c+=" AND (ZAW_ARCHITECT LIKE ? OR a.ZAR_NAME LIKE ? OR a.ZAR_NAMEENG LIKE ?)",a.push(`%${m.architect}%`,`%${m.architect}%`,`%${m.architect}%`)),m.location&&(c+=" AND ZAW_ADDRESS LIKE ?",a.push(`%${m.location}%`)),m.prefecture&&(c+=" AND ZAW_PREFECTURE = ?",a.push(m.prefecture)),m.yearFrom&&(c+=" AND ZAW_YEAR >= ?",a.push(m.yearFrom)),m.yearTo&&(c+=" AND ZAW_YEAR <= ?",a.push(m.yearTo));let f="LEFT JOIN ZCDARCHITECT a ON ZCDARCHITECTURE.ZAW_ARCHITECT_ID = a.ZAR_ID";m.tags&&m.tags.length>0&&(f+=`
      INNER JOIN ZCDARCHITECTURE_TAG ON ZCDARCHITECTURE.ZAW_ID = ZCDARCHITECTURE_TAG.ARCHITECTURE_ID
      INNER JOIN ZCDTAG ON ZCDARCHITECTURE_TAG.TAG_ID = ZCDTAG.TAG_ID
    `,c+=" AND ZCDTAG.TAG_NAME IN (",c+=m.tags.map(()=>"?").join(","),c+=")",a.push(...m.tags));const p=`
    SELECT COUNT(DISTINCT ZCDARCHITECTURE.ZAW_ID) as total
    FROM ZCDARCHITECTURE
    ${f}
    WHERE ${c}
  `,A=`
    SELECT DISTINCT ZCDARCHITECTURE.*
    FROM ZCDARCHITECTURE
    ${f}
    WHERE ${c}
    ORDER BY ${g} ${l==="desc"?"DESC":"ASC"}
    LIMIT ? OFFSET ?
  `,_=[...a,t,d];try{const C=(await qe(p,a))?.total||0;return{results:await Ne(A,_),total:C,page:n,limit:t,totalPages:Math.ceil(C/t)}}catch(T){throw console.error("建築作品データ取得エラー:",T),T}},Wt=async(n,t={})=>{let o=`
    ZAW_LAT BETWEEN ? AND ?
    AND ZAW_LNG BETWEEN ? AND ?
    AND ZAW_LAT IS NOT NULL
    AND ZAW_LNG IS NOT NULL
  `;const g=[n.south,n.north,n.west,n.east];t.searchTerm&&(o+=" AND (ZAW_NAME LIKE ? OR ZAW_ADDRESS LIKE ? OR ZAW_ARCHITECT LIKE ?)",g.push(`%${t.searchTerm}%`,`%${t.searchTerm}%`,`%${t.searchTerm}%`)),t.architect&&(o+=" AND (ZAW_ARCHITECT LIKE ? OR a.ZAR_NAME LIKE ? OR a.ZAR_NAMEENG LIKE ?)",g.push(`%${t.architect}%`,`%${t.architect}%`,`%${t.architect}%`)),t.yearFrom&&(o+=" AND ZAW_YEAR >= ?",g.push(t.yearFrom)),t.yearTo&&(o+=" AND ZAW_YEAR <= ?",g.push(t.yearTo));let l="LEFT JOIN ZCDARCHITECT a ON ZCDARCHITECTURE.ZAW_ARCHITECT_ID = a.ZAR_ID";t.tags&&t.tags.length>0&&(l+=`
      INNER JOIN ZCDARCHITECTURE_TAG ON ZCDARCHITECTURE.ZAW_ID = ZCDARCHITECTURE_TAG.ARCHITECTURE_ID
      INNER JOIN ZCDTAG ON ZCDARCHITECTURE_TAG.TAG_ID = ZCDTAG.TAG_ID
    `,o+=" AND ZCDTAG.TAG_NAME IN (",o+=t.tags.map(()=>"?").join(","),o+=")",g.push(...t.tags));const m=`
    SELECT DISTINCT ZCDARCHITECTURE.*
    FROM ZCDARCHITECTURE
    ${l}
    WHERE ${o}
    LIMIT 500
  `;return Ne(m,g)},Er=Object.freeze(Object.defineProperty({__proto__:null,getAllArchitectures:Dt,getArchitectureById:wt,getArchitectureForMap:Wt},Symbol.toStringTag,{value:"Module"})),Ir=()=>{const[n,t]=x.useState([]),[o,g]=x.useState(!0),[l,m]=x.useState(0),[d,c]=x.useState(1),[a,f]=x.useState(""),[p,A]=x.useState(""),[_,T]=x.useState([]),[C,D]=x.useState([]),[M,q]=x.useState([]),[u,E]=x.useState("year_desc"),[j,S]=x.useState({}),[$,ne]=x.useState(null),[R,je]=x.useState(""),[X,ce]=x.useState({}),re=12,G=Ge(),Q=Ke();x.useEffect(()=>{(async()=>{try{q([])}catch(y){console.error("タグ取得エラー:",y)}})()},[]),x.useEffect(()=>{const h=new URLSearchParams(G.search),y=h.get("tag"),v=h.get("search"),N=h.get("year"),K=h.get("prefecture"),Y=h.get("category"),F=h.get("architect"),W=h.get("sort");if(W&&E(W),y){const I=y.split(",").map(r=>r.trim()).filter(r=>r),L=new Set,J=[];I.forEach(r=>{const b=r.match(/\d{4}年\d{1,2}月号?/);if(b){const w=r.replace(b[0],"").trim();w&&(L.add(w),J.push(r))}else L.add(r)}),T(Array.from(L)),D(J),A(y),f(`tag:${y}`),H(1,`tag:${y}`,W||u)}else N?(f(`year:${N}`),H(1,`year:${N}`,W||u)):K?(f(`prefecture:${K}`),H(1,`prefecture:${K}`,W||u)):Y?(f(`category:${Y}`),H(1,`category:${Y}`,W||u)):F?(f(`architect:${F}`),H(1,`architect:${F}`,W||u)):v?(f(v),H(1,v,W||u)):H(1,a,W||u)},[G.search]);const H=async(h,y=a,v=u)=>{g(!0);try{const N=await Dt(h,re,y,v);t(N.items),m(N.total),c(h)}catch(N){console.error("Error fetching architectures:",N)}finally{g(!1)}},oe=(h,y)=>{c(y),H(y,a,u),window.scrollTo(0,0)},ye=h=>{f(h.target.value)},de=async(h,y)=>{ne(h.currentTarget),je(y);try{const v=[];ce(N=>({...N,[y]:v}))}catch(v){console.error(`Failed to get years for tag ${y}:`,v)}},he=()=>{ne(null),je("")},ve=h=>{const y=h?`${R}${h}`:R;let v=[...C];const N=v.findIndex(I=>I.startsWith(R)&&(I===R||I.match(new RegExp(`^${R}\\d{4}年\\d{1,2}月号?`))||I.match(new RegExp(`^${R}\\d{4}年度?`))||I.match(new RegExp(`^${R}第\\d+回`))||I.match(new RegExp(`^${R}\\(\\d{4}\\)`))));N>=0?h?v[N]=y:v.splice(N,1):h&&v.push(y),D(v),he();const K=[..._];K.includes(R)||K.push(R);const Y=[...K,...v].filter((I,L,J)=>J.indexOf(I)===L&&!v.some(r=>r!==I&&r.startsWith(I))).join(",");A(Y);const F=`tag:${Y}`;f(F),H(1,F,u);const W=new URLSearchParams;W.set("tag",Y),u!=="year_desc"&&W.set("sort",u),Q({search:W.toString()})},Re=(h,y)=>{const v=_.filter(Y=>!y.includes(Y));let N=[...C].filter(Y=>!v.some(F=>Y.startsWith(F)));const K=y.filter(Y=>!_.includes(Y));if(K.length>0&&K.forEach(async Y=>{if(!X[Y])try{const F=[];if(ce(W=>({...W,[Y]:F})),F&&F.length===1){const W=`${Y}${F[0]}`;N.push(W)}}catch(F){console.error(`Failed to get years for tag ${Y}:`,F)}}),T(y),D(N),y.length>0||N.length>0){const Y=[...y,...N].filter((I,L,J)=>J.indexOf(I)===L&&!N.some(r=>r!==I&&r.startsWith(I))).join(",");A(Y);const F=`tag:${Y}`;f(F),H(1,F,u);const W=new URLSearchParams;W.set("tag",Y),u!=="year_desc"&&W.set("sort",u),Q({search:W.toString()})}else Te()},xe=h=>{const y=h.target.value;E(y),H(d,a,y);const v=new URLSearchParams(G.search);v.set("sort",y),Q({search:v.toString()})},ue=()=>{c(1),H(1,a,u);const h=new URLSearchParams;if(u!=="year_desc"&&h.set("sort",u),a.startsWith("tag:")){const y=a.substring(4).trim();h.set("tag",y)}else if(a.startsWith("year:")){const y=a.substring(5).trim();h.set("year",y)}else if(a.startsWith("prefecture:")){const y=a.substring(11).trim();h.set("prefecture",y)}else if(a.startsWith("category:")){const y=a.substring(9).trim();h.set("category",y)}else if(a.startsWith("architect:")){const y=a.substring(10).trim();h.set("architect",y)}else a&&h.set("search",a);Q({search:h.toString()})},Te=()=>{A(""),f(""),T([]),D([]),c(1),H(1,"",u);const h=new URLSearchParams;u!=="year_desc"&&h.set("sort",u),Q({search:h.toString()})},ie=Math.ceil(l/re);return e.jsxs(te,{maxWidth:"lg",sx:{py:4},children:[e.jsx(i,{variant:"h4",component:"h1",gutterBottom:!0,children:"建築作品一覧"}),e.jsxs(le,{sx:{p:3,mb:4},children:[e.jsxs(s,{sx:{display:"flex",flexDirection:{xs:"column",sm:"row"},gap:2,mb:3},children:[e.jsx(Ae,{fullWidth:!0,label:"建築作品名、住所、建築家で検索",value:a,onChange:ye,onKeyPress:h=>h.key==="Enter"&&ue(),InputProps:{startAdornment:e.jsx(Je,{position:"start",children:e.jsx(ze,{})})}}),e.jsx(k,{variant:"contained",onClick:ue,sx:{minWidth:"120px"},children:"検索"})]}),e.jsxs(s,{sx:{display:"flex",flexDirection:{xs:"column",md:"row"},gap:2,mb:3,alignItems:"flex-start"},children:[e.jsx(ut,{multiple:!0,id:"tags-selector",options:M,value:_,onChange:Re,renderInput:h=>e.jsx(Ae,{...h,variant:"outlined",label:"タグで絞り込み",placeholder:"タグを選択"}),renderTags:(h,y)=>h.map((v,N)=>{const K=C.some(I=>I.startsWith(v)&&I!==v),Y=!!(X[v]&&X[v].length>0),F=C.find(I=>I.startsWith(v)&&I!==v);let W="";if(F){const I=F.substring(v.length);I.match(/\d{4}年\d{1,2}月号?/)?W=I.replace(/^(\d{4})/,(L,J)=>`'${J.substring(2)}`):I.match(/\d{4}年度?/)?W=I.replace(/^(\d{4})/,(L,J)=>`'${J.substring(2)}`):I.match(/第\d+回/)?W=I:I.match(/\(\d{4}\)/)?W=I.replace(/\((\d{4})\)/,(L,J)=>`'${J.substring(2)}`):W=I}return e.jsx(O,{label:e.jsxs(s,{sx:{display:"flex",alignItems:"center"},children:[v,F&&e.jsx(i,{variant:"caption",sx:{ml:.5,fontWeight:"bold",backgroundColor:"rgba(0, 0, 0, 0.08)",borderRadius:"4px",px:.5,py:.2},children:W}),Y&&e.jsx(mt,{fontSize:"small"})]}),...y({index:N}),color:K?"primary":"default",variant:"outlined",onClick:I=>{I.stopPropagation(),de(I,v)},onDelete:I=>{y({index:N}).onDelete(I)},sx:{maxWidth:"100%","& .MuiChip-label":{overflow:"hidden",whiteSpace:"nowrap",textOverflow:"ellipsis"}}},v)}),sx:{flex:2}}),e.jsxs(gt,{sx:{minWidth:200,flex:1},children:[e.jsx(pt,{id:"sort-select-label",children:"並び替え"}),e.jsxs(ft,{labelId:"sort-select-label",id:"sort-select",value:u,label:"並び替え",onChange:xe,startAdornment:e.jsx(Je,{position:"start",children:e.jsx(zt,{})}),children:[e.jsx(ee,{value:"year_desc",children:"年代（新しい順）"}),e.jsx(ee,{value:"year_asc",children:"年代（古い順）"}),e.jsx(ee,{value:"name_asc",children:"名前（昇順）"}),e.jsx(ee,{value:"name_desc",children:"名前（降順）"}),e.jsx(ee,{value:"architect_asc",children:"建築家（昇順）"}),e.jsx(ee,{value:"architect_desc",children:"建築家（降順）"})]})]})]}),e.jsx(jt,{open:!!$,anchorEl:$,onClose:he,anchorOrigin:{vertical:"bottom",horizontal:"left"},children:e.jsxs(s,{sx:{p:2,maxHeight:300,width:"250px",overflowY:"auto"},children:[e.jsxs(i,{variant:"subtitle2",sx:{mb:1},children:[R," の選択:"]}),e.jsxs(s,{sx:{display:"flex",flexDirection:"column",gap:1},children:[e.jsx(O,{label:"指定なし",onClick:()=>ve(""),variant:"outlined",size:"small",color:_.includes(R)&&!C.some(h=>h.startsWith(R)&&h!==R)?"primary":"default"}),X[R]?.map(h=>{let y=h,v="default";return C.some(N=>N===`${R}${h}`)&&(v="primary"),e.jsx(O,{label:y,onClick:()=>ve(h),variant:"outlined",size:"small",color:v,sx:{overflow:"hidden",textOverflow:"ellipsis",maxWidth:"100%"}},h)})]})]})}),(p||a)&&e.jsx(s,{sx:{mb:3},children:e.jsx(tt,{severity:"info",action:e.jsx(k,{color:"inherit",size:"small",onClick:Te,children:"クリア"}),children:p?`タグ「${p}」で絞り込み中`:`「${a}」で検索中`})}),e.jsxs(s,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:2},children:[e.jsxs(i,{variant:"body2",color:"text.secondary",children:[l," 件の建築作品"]}),ie>1&&e.jsx(Be,{count:ie,page:d,onChange:oe,color:"primary",size:"small"})]})]}),o?e.jsx(s,{sx:{display:"flex",justifyContent:"center",py:4},children:e.jsx($e,{})}):e.jsxs(e.Fragment,{children:[n.length===0?e.jsxs(s,{sx:{textAlign:"center",py:4},children:[e.jsx(i,{variant:"h6",children:"建築作品が見つかりませんでした"}),e.jsx(i,{variant:"body2",color:"text.secondary",sx:{mt:1},children:"検索条件を変更してお試しください"})]}):e.jsx(P,{container:!0,spacing:3,children:n.map(h=>e.jsx(P,{item:!0,xs:12,sm:6,md:4,lg:3,children:e.jsx(pe,{sx:{height:"100%",display:"flex",flexDirection:"column",transition:"transform 0.2s","&:hover":{transform:"scale(1.02)"}},children:e.jsx(Me,{component:B,to:`/architecture/${h.id}`,sx:{display:"flex",flexDirection:"column",alignItems:"flex-start",height:"100%"},children:e.jsxs(fe,{sx:{width:"100%",flexGrow:1},children:[e.jsx(i,{gutterBottom:!0,variant:"h6",component:"h2",children:h.name}),e.jsxs(s,{sx:{display:"flex",flexDirection:"column",gap:1,mt:2},children:[h.architectName&&e.jsxs(s,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(yt,{fontSize:"small",color:"action"}),e.jsx(i,{variant:"body2",color:"text.secondary",children:h.architectName})]}),h.city&&e.jsxs(s,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(He,{fontSize:"small",color:"action"}),e.jsx(i,{variant:"body2",color:"text.secondary",children:h.city})]}),h.completedYear>0&&e.jsxs(s,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(bt,{fontSize:"small",color:"action"}),e.jsxs(i,{variant:"body2",color:"text.secondary",children:[h.completedYear,"年"]})]})]})]})})})},h.id))}),ie>1&&e.jsx(s,{sx:{display:"flex",justifyContent:"center",mt:4},children:e.jsx(Be,{count:ie,page:d,onChange:oe,color:"primary"})})]})]})};delete Et.Icon.Default.prototype._getIconUrl;Et.Icon.Default.mergeOptions({iconRetinaUrl:"https://unpkg.com/leaflet@1.7.1/dist/images/marker-icon-2x.png",iconUrl:"https://unpkg.com/leaflet@1.7.1/dist/images/marker-icon.png",shadowUrl:"https://unpkg.com/leaflet@1.7.1/dist/images/marker-shadow.png"});const Pe=({markers:n=[],center:t,zoom:o=13,height:g="500px",singleMarker:l})=>{const[m,d]=x.useState(t);return x.useEffect(()=>{l&&l.latitude&&l.longitude?d([l.latitude,l.longitude]):t&&d(t)},[l,t]),e.jsx("div",{style:{height:g,width:"100%",marginBottom:"20px"},children:e.jsxs(xr,{center:m,zoom:o,style:{height:"100%",width:"100%"},children:[e.jsx(ur,{attribution:'© <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors',url:"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png"}),n.map((c,a)=>c.latitude&&c.longitude?e.jsx(st,{position:[c.latitude,c.longitude],children:e.jsxs(nt,{children:[e.jsx(i,{variant:"h6",children:c.name}),e.jsx(i,{variant:"body2",children:c.location}),e.jsx(k,{component:B,to:`/architecture/${c.id}`,size:"small",variant:"outlined",sx:{mt:1},children:"詳細を見る"})]})},`marker-${c.id||a}`):null),l&&l.latitude&&l.longitude&&e.jsx(st,{position:[l.latitude,l.longitude],children:e.jsxs(nt,{children:[e.jsx(i,{variant:"h6",children:l.name}),e.jsx(i,{variant:"body2",children:l.location})]})})]})})},vr=()=>{const{id:n}=At(),[t,o]=x.useState(null),[g,l]=x.useState(!0),[m,d]=x.useState(null),c=Ke();if(x.useEffect(()=>{(async()=>{l(!0);try{const D=await wt(n);if(!D)throw new Error("建築作品の取得に失敗しました");o(D)}catch(D){console.error("Error fetching work:",D),d(D.message)}finally{l(!1)}})()},[n]),g)return e.jsx(s,{sx:{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"60vh"},children:e.jsx($e,{})});if(m)return e.jsxs(te,{children:[e.jsxs(i,{variant:"h5",color:"error",sx:{textAlign:"center",my:4},children:["エラーが発生しました: ",m]}),e.jsx(k,{variant:"contained",component:B,to:"/architecture",startIcon:e.jsx(_e,{}),children:"建築作品一覧に戻る"})]});if(!t)return e.jsxs(te,{children:[e.jsx(i,{variant:"h5",sx:{textAlign:"center",my:4},children:"建築作品が見つかりませんでした"}),e.jsx(k,{variant:"contained",component:B,to:"/architecture",startIcon:e.jsx(_e,{}),children:"建築作品一覧に戻る"})]});const a=t.tag?t.tag.split(",").filter(C=>C.trim()!==""&&!C.includes("の追加建築")):[],f=a.find(C=>C.includes("新建築")),p=f?f.replace("新建築",""):"",A=C=>{console.log(`タグがクリックされました: ${C}`),c(`/architecture?tag=${encodeURIComponent(C)}`)},_=(C,D)=>{const M=`${C} ${D?.name||""} 建築`;return`https://www.google.com/search?q=${encodeURIComponent(M)}&tbm=isch`},T=C=>`https://ja.wikipedia.org/wiki/Special:Search?search=${encodeURIComponent(C)}`;return e.jsxs(te,{maxWidth:"lg",sx:{py:4},children:[e.jsx(k,{variant:"outlined",component:B,to:"/architecture",startIcon:e.jsx(_e,{}),sx:{mb:3},children:"建築作品一覧に戻る"}),e.jsxs(le,{sx:{p:3,mb:4},children:[e.jsxs(s,{sx:{mb:2},children:[e.jsx(i,{variant:"h4",component:"h1",gutterBottom:!0,children:t.name||"無題"}),t.location&&e.jsxs(i,{variant:"subtitle1",color:"text.secondary",gutterBottom:!0,children:[e.jsx(He,{fontSize:"small",sx:{verticalAlign:"middle",mr:.5}}),t.location]}),e.jsxs(s,{sx:{display:"flex",flexWrap:"wrap",gap:1,mb:2},children:[t.completedYear!==0&&e.jsx(O,{icon:e.jsx(bt,{}),label:`${t.completedYear}年`,variant:"outlined",size:"small",onClick:()=>c(`/architecture?year=${t.completedYear}`),clickable:!0}),t.city&&e.jsx(O,{icon:e.jsx(He,{}),label:t.city,variant:"outlined",size:"small",onClick:()=>c(`/architecture?prefecture=${encodeURIComponent(t.city)}`),clickable:!0}),t.architect&&t.architect.name&&e.jsx(O,{icon:e.jsx(yt,{}),label:t.architect.name,component:B,to:`/architects/${t.architect.id}`,clickable:!0,color:"primary",size:"small"}),t.bigCategory&&e.jsx(O,{icon:e.jsx(Ve,{}),label:t.bigCategory,variant:"outlined",size:"small",onClick:()=>c(`/architecture?category=${encodeURIComponent(t.bigCategory)}`),clickable:!0}),t.category&&t.category!==t.bigCategory&&e.jsx(O,{icon:e.jsx(Ve,{}),label:t.category,variant:"outlined",size:"small",onClick:()=>c(`/architecture?category=${encodeURIComponent(t.category)}`),clickable:!0})]}),a.length>0&&e.jsx(s,{sx:{display:"flex",flexWrap:"wrap",gap:1,mb:2},children:a.map((C,D)=>e.jsx(O,{icon:e.jsx(Ct,{}),label:C,onClick:()=>A(C),clickable:!0,color:"secondary",variant:"outlined",size:"small"},D))})]}),e.jsx(Ue,{sx:{my:3}}),e.jsxs(s,{sx:{mb:3,display:"flex",flexDirection:"row",gap:1},children:[t.shinkenchikuUrl&&e.jsx(Ce,{title:"新建築データで見る",children:e.jsxs(k,{variant:"contained",href:t.shinkenchikuUrl,target:"_blank",rel:"noopener noreferrer",size:"small",sx:{backgroundColor:"#003366",color:"#ffffff","&:hover":{backgroundColor:"#002244"}},children:[e.jsx(s,{sx:{display:"flex",alignItems:"center",justifyContent:"center",mr:.5},children:e.jsx("img",{src:"https://data.shinkenchiku.online/favicon.ico",alt:"新建築データ",style:{height:"16px",width:"auto",marginRight:"4px"}})}),p&&e.jsx(i,{variant:"caption",children:p})]})}),e.jsx(Ce,{title:"Google画像検索",children:e.jsx(k,{href:_(t.name,t.architect),target:"_blank",rel:"noopener noreferrer",startIcon:e.jsx(Mt,{}),variant:"contained",size:"small",sx:{backgroundColor:"#4285F4",color:"#ffffff","&:hover":{backgroundColor:"#3367D6"}},children:"画像"})}),e.jsx(Ce,{title:"Wikipediaで検索",children:e.jsx(k,{href:T(t.name),target:"_blank",rel:"noopener noreferrer",startIcon:e.jsx(Ut,{}),variant:"contained",size:"small",sx:{backgroundColor:"#333333",color:"#ffffff","&:hover":{backgroundColor:"#222222"}},children:"Wikipedia"})})]}),t.description&&e.jsxs(s,{sx:{mt:3},children:[e.jsx(i,{variant:"h6",gutterBottom:!0,children:"概要"}),e.jsx(i,{variant:"body1",paragraph:!0,sx:{whiteSpace:"pre-line"},children:t.description})]}),t.latitude&&t.longitude&&e.jsxs(s,{sx:{mt:3},children:[e.jsx(i,{variant:"h6",gutterBottom:!0,children:"位置情報"}),e.jsx(s,{sx:{height:"400px",width:"100%",mt:2,border:"1px solid #eee",borderRadius:"4px",overflow:"hidden"},children:e.jsx(Pe,{singleMarker:{id:t.id||0,latitude:t.latitude,longitude:t.longitude,name:t.name,location:t.location},center:[t.latitude,t.longitude],zoom:15})})]})]})]})},Rr=async n=>qe("SELECT * FROM ZCDARCHITECT WHERE ZAR_ID = ?",[n]),Sr=async(n=1,t=12,o="",g=[],l="ZAR_NAME",m="asc",d={})=>{const c=(n-1)*t;let a="1=1";const f=[];o&&(a+=" AND (ZAR_NAME LIKE ? OR ZAR_KANA LIKE ? OR ZAR_NAMEENG LIKE ?)",f.push(`%${o}%`,`%${o}%`,`%${o}%`)),d.nationality&&(a+=" AND ZAR_NATIONALITY = ?",f.push(d.nationality)),d.category&&(a+=" AND ZAR_CATEGORY = ?",f.push(d.category)),d.school&&(a+=" AND ZAR_SCHOOL = ?",f.push(d.school)),d.birthYearFrom&&(a+=" AND ZAR_BIRTHYEAR >= ?",f.push(d.birthYearFrom)),d.birthYearTo&&(a+=" AND ZAR_BIRTHYEAR <= ?",f.push(d.birthYearTo)),d.deathYear&&(a+=" AND ZAR_DEATHYEAR = ?",f.push(d.deathYear));let p="";g&&g.length>0&&(p=`
      INNER JOIN ZCDARCHITECT_TAG ON ZCDARCHITECT.ZAR_ID = ZCDARCHITECT_TAG.ARCHITECT_ID
      INNER JOIN ZCDTAG ON ZCDARCHITECT_TAG.TAG_ID = ZCDTAG.TAG_ID
    `,a+=" AND ZCDTAG.TAG_NAME IN (",a+=g.map(()=>"?").join(","),a+=")",f.push(...g));const A=`
    SELECT COUNT(DISTINCT ZCDARCHITECT.ZAR_ID) as total
    FROM ZCDARCHITECT
    ${p}
    WHERE ${a}
  `,_=`
    SELECT DISTINCT ZCDARCHITECT.*
    FROM ZCDARCHITECT
    ${p}
    WHERE ${a}
    ORDER BY ${l} ${m==="desc"?"DESC":"ASC"}
    LIMIT ? OFFSET ?
  `,T=[...f,t,c];try{const D=(await qe(A,f))?.total||0;return{results:await Ne(_,T),total:D,page:n,limit:t,totalPages:Math.ceil(D/t)}}catch(C){throw console.error("建築家データ取得エラー:",C),C}},wr=async()=>Ne(`
    SELECT TAG_ID, TAG_NAME, COUNT(ARCHITECT_ID) as TAG_COUNT
    FROM ZCDTAG
    LEFT JOIN ZCDARCHITECT_TAG ON ZCDTAG.TAG_ID = ZCDARCHITECT_TAG.TAG_ID
    GROUP BY ZCDTAG.TAG_ID, ZCDTAG.TAG_NAME
    ORDER BY TAG_COUNT DESC, TAG_NAME
  `),Dr=()=>{console.log("ArchitectsPage コンポーネントがレンダリングされました");const[n,t]=x.useState([]),[o,g]=x.useState(!0),[l,m]=x.useState(0),[d,c]=x.useState(0),[a,f]=x.useState(1),[p,A]=x.useState(""),[_,T]=x.useState([]),[C,D]=x.useState([]),[M,q]=x.useState([]),[u,E]=x.useState("name"),[j,S]=x.useState("asc"),[$,ne]=x.useState(null),[R,je]=x.useState(""),[X,ce]=x.useState({}),[re,G]=x.useState(""),[Q,H]=x.useState(""),[oe,ye]=x.useState(""),[de,he]=x.useState(""),[ve,Re]=x.useState(""),[xe,ue]=x.useState(""),Te=Ke(),ie=Ge(),h=new URLSearchParams(ie.search);x.useEffect(()=>{console.log("tagMenuAnchorEl 状態変更:",!!$)},[$]),x.useEffect(()=>{console.log("タグ読み込みのuseEffectが実行されました"),(async()=>{try{console.log("建築家タグ取得開始");const b=await wr();console.log("取得した建築家タグ:",b),q(["国籍","カテゴリー","学校","生年","没年"])}catch(b){console.error("タグ取得エラー:",b)}})()},[]),x.useEffect(()=>{console.log("建築家データ読み込みのuseEffectが実行されました",ie.search),(async()=>{g(!0);try{const b=parseInt(h.get("page")||"1"),w=h.get("search")||"",V=h.get("tags")?h.get("tags").split(","):[],Z=h.get("sortBy")||"name",z=h.get("sortOrder")||"asc",se=h.get("nationality")||"",Ye=h.get("category")||"",Fe=h.get("school")||"",Se=h.get("birthYearFrom")||"",we=h.get("birthYearTo")||"",De=h.get("deathYear")||"";console.log("URLから読み取ったパラメータ:",{page:b,search:w,tags:V,sort:Z,order:z,nat:se,cat:Ye,sch:Fe,birthFrom:Se,birthTo:we,death:De}),f(b),A(w),T(V),E(Z),S(z),G(se),H(Ye),ye(Fe),he(Se),Re(we),ue(De),console.log("建築家データ取得開始:",{page:b,search:w,tags:V,sort:Z,order:z,nat:se,cat:Ye,sch:Fe,birthFrom:Se,birthTo:we,death:De});const Oe=await Sr(b,10,w,V,Z,z,se,Ye,Fe,Se?parseInt(Se):0,we?parseInt(we):0,De?parseInt(De):0);console.log("取得した建築家データ:",Oe),t(Oe.items),m(Oe.totalPages),c(Oe.total)}catch(b){console.error("建築家データ取得エラー:",b)}finally{g(!1)}})()},[ie.search]);const y=async r=>{console.log(`${r}の年度取得開始`);let b="";if(r==="国籍"?b="SELECT DISTINCT ZAT_NATIONALITY as value FROM ZCDARCHITECT WHERE ZAT_NATIONALITY != '' ORDER BY ZAT_NATIONALITY":r==="カテゴリー"?b="SELECT DISTINCT ZAT_CATEGORY as value FROM ZCDARCHITECT WHERE ZAT_CATEGORY != '' ORDER BY ZAT_CATEGORY":r==="学校"?b="SELECT DISTINCT ZAT_SCHOOL as value FROM ZCDARCHITECT WHERE ZAT_SCHOOL != '' ORDER BY ZAT_SCHOOL":r==="生年"?b="SELECT DISTINCT ZAT_BIRTHYEAR as value FROM ZCDARCHITECT WHERE ZAT_BIRTHYEAR > 0 ORDER BY ZAT_BIRTHYEAR DESC":r==="没年"&&(b="SELECT DISTINCT ZAT_DEATHYEAR as value FROM ZCDARCHITECT WHERE ZAT_DEATHYEAR > 0 ORDER BY ZAT_DEATHYEAR DESC"),!b)return[];try{return(await Ne(b)).map(V=>String(V.value)).filter(Boolean)}catch(w){return console.error(`${r}の値取得エラー:`,w),[]}},v=async(r,b)=>{if(console.log(`${b}の年度メニューを開く`,r.currentTarget),ne(r.currentTarget),je(b),!X[b])try{const w=await y(b);console.log(`取得した${b}の年度:`,w),ce(V=>({...V,[b]:w}))}catch(w){console.error(`${b}の年度取得エラー:`,w)}},N=()=>{console.log("年度メニューを閉じる"),ne(null),je("")},K=r=>{console.log(`年度選択: ${r} (タグ: ${R})`),R==="国籍"?G(r):R==="カテゴリー"?H(r):R==="学校"?ye(r):R==="生年"?he(r):R==="没年"&&ue(r),N(),L()},Y=(r,b)=>{console.log("タグ選択変更:",b),T(b);const w=_.filter(Z=>!b.includes(Z));for(const Z of w)Z==="国籍"?G(""):Z==="カテゴリー"?H(""):Z==="学校"?ye(""):Z==="生年"?(he(""),Re("")):Z==="没年"&&ue("");const V=b.filter(Z=>!_.includes(Z));V.length>0&&V.forEach(async Z=>{if(!X[Z])try{const z=await y(Z);ce(se=>({...se,[Z]:z}))}catch(z){console.error(`${Z}の年度取得エラー:`,z)}}),L()},F=(r,b)=>{console.log(`ページ変更: ${b}`),f(b);const w=new URLSearchParams(ie.search);w.set("page",b.toString()),Te({search:w.toString()})},W=()=>{console.log(`検索実行: ${p}`),L()},I=()=>{console.log("検索条件をクリア"),A(""),T([]),D([]),G(""),H(""),ye(""),he(""),Re(""),ue(""),f(1);const r=new URLSearchParams;u!=="name"&&r.set("sortBy",u),j!=="asc"&&r.set("sortOrder",j),Te({search:r.toString()})},L=()=>{console.log("URLと検索を更新");const r=new URLSearchParams;a>1&&r.set("page",a.toString()),p&&r.set("search",p),_.length>0&&r.set("tags",_.join(",")),u!=="name"&&r.set("sortBy",u),j!=="asc"&&r.set("sortOrder",j),re&&r.set("nationality",re),Q&&r.set("category",Q),oe&&r.set("school",oe),de&&r.set("birthYearFrom",de),ve&&r.set("birthYearTo",ve),xe&&r.set("deathYear",xe),console.log("新しいURLパラメータ:",r.toString()),Te({search:r.toString()})},J=()=>{const r=[];return re&&r.push({label:`国籍: ${re}`,onDelete:()=>{G(""),L()}}),de&&r.push({label:`生年: ${de}`,onDelete:()=>{he(""),L()}}),xe&&r.push({label:`没年: ${xe}`,onDelete:()=>{ue(""),L()}}),Q&&r.push({label:`カテゴリー: ${Q}`,onDelete:()=>{H(""),L()}}),oe&&r.push({label:`学校: ${oe}`,onDelete:()=>{ye(""),L()}}),r.length===0&&!p&&_.length===0?null:e.jsx(s,{sx:{mb:3},children:e.jsx(tt,{severity:"info",action:e.jsx(k,{color:"inherit",size:"small",onClick:I,children:"クリア"}),children:r.length>0?`フィルター: ${r.map(b=>b.label).join(", ")}`:p?`「${p}」で検索中`:_.length>0?`タグ「${_.join(", ")}」で絞り込み中`:""})})};return e.jsxs(te,{maxWidth:"lg",sx:{py:4},children:[e.jsx(i,{variant:"h4",component:"h1",gutterBottom:!0,children:"建築家一覧"}),e.jsxs(le,{sx:{p:3,mb:4},children:[e.jsxs(s,{sx:{display:"flex",flexDirection:{xs:"column",sm:"row"},gap:2,mb:3},children:[e.jsx(Ae,{fullWidth:!0,label:"建築家名、国籍、カテゴリーで検索",value:p,onChange:r=>A(r.target.value),onKeyPress:r=>r.key==="Enter"&&W(),InputProps:{startAdornment:e.jsx(Je,{position:"start",children:e.jsx(ze,{})})}}),e.jsx(k,{variant:"contained",onClick:W,sx:{minWidth:"120px"},children:"検索"})]}),e.jsxs(s,{sx:{display:"flex",flexDirection:{xs:"column",md:"row"},gap:2,mb:3,alignItems:"flex-start"},children:[e.jsx(ut,{multiple:!0,id:"tags-selector",options:M,value:_,onChange:Y,fullWidth:!0,renderInput:r=>e.jsx(Ae,{...r,variant:"outlined",label:"タグで絞り込み",placeholder:"タグを選択"}),renderTags:(r,b)=>r.map((w,V)=>{const Z=!!(X[w]&&X[w].length>0);let z="";return w==="国籍"?z=re:w==="カテゴリー"?z=Q:w==="学校"?z=oe:w==="生年"?z=de:w==="没年"&&(z=xe),e.jsx(O,{label:e.jsxs(s,{sx:{display:"flex",alignItems:"center"},children:[w,z&&e.jsx(i,{variant:"caption",sx:{ml:.5,fontWeight:"bold",backgroundColor:"rgba(0, 0, 0, 0.08)",borderRadius:"4px",px:.5,py:.2},children:z}),Z&&e.jsx(mt,{fontSize:"small"})]}),...b({index:V}),color:z?"primary":"default",variant:"outlined",onClick:se=>{se.stopPropagation(),v(se,w)},onDelete:se=>{b({index:V}).onDelete(se)},sx:{maxWidth:"100%","& .MuiChip-label":{overflow:"hidden",whiteSpace:"nowrap"}}},w)})}),e.jsxs(gt,{sx:{minWidth:200},children:[e.jsx(pt,{id:"sort-select-label",children:"並び替え"}),e.jsxs(ft,{labelId:"sort-select-label",value:`${u}_${j}`,label:"並び替え",onChange:r=>{const[b,w]=r.target.value.split("_");E(b),S(w),L()},children:[e.jsx(ee,{value:"name_asc",children:"名前 (昇順)"}),e.jsx(ee,{value:"name_desc",children:"名前 (降順)"}),e.jsx(ee,{value:"birthYear_asc",children:"生年 (昇順)"}),e.jsx(ee,{value:"birthYear_desc",children:"生年 (降順)"}),e.jsx(ee,{value:"nationality_asc",children:"国籍 (昇順)"}),e.jsx(ee,{value:"nationality_desc",children:"国籍 (降順)"})]})]})]}),e.jsx(jt,{open:!!$,anchorEl:$,onClose:N,anchorOrigin:{vertical:"bottom",horizontal:"left"},transformOrigin:{vertical:"top",horizontal:"left"},children:e.jsxs(s,{sx:{p:2,width:300,maxHeight:400,overflow:"auto"},children:[e.jsx(i,{variant:"subtitle1",gutterBottom:!0,children:R==="国籍"?"国籍を選択":R==="カテゴリー"?"カテゴリーを選択":R==="学校"?"学校を選択":R==="生年"?"生年を選択":R==="没年"?"没年を選択":"タグ値を選択"}),e.jsxs(s,{sx:{display:"flex",flexWrap:"wrap",gap:1,mt:1},children:[e.jsx(O,{label:"指定なし",onClick:()=>K(""),variant:"outlined",size:"small",sx:{mb:1}}),X[R]?.map(r=>e.jsx(O,{label:r,onClick:()=>K(r),variant:"outlined",size:"small",color:R==="国籍"&&r===re||R==="カテゴリー"&&r===Q||R==="学校"&&r===oe||R==="生年"&&r===de||R==="没年"&&r===xe?"primary":"default",sx:{overflow:"hidden",textOverflow:"ellipsis",maxWidth:"100%"}},r))]})]})}),e.jsx(J,{}),e.jsxs(s,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:2},children:[e.jsxs(i,{variant:"body2",color:"text.secondary",children:[d,"人の建築家"]}),l>1&&e.jsx(Be,{count:l,page:a,onChange:F,color:"primary",size:"small"})]})]}),o?e.jsx(s,{sx:{display:"flex",justifyContent:"center",py:4},children:e.jsx($e,{})}):e.jsxs(e.Fragment,{children:[n.length===0?e.jsxs(s,{sx:{textAlign:"center",py:4},children:[e.jsx(i,{variant:"h6",children:"建築家が見つかりませんでした"}),e.jsx(i,{variant:"body2",color:"text.secondary",sx:{mt:1},children:"検索条件を変更してお試しください"})]}):e.jsx(P,{container:!0,spacing:3,children:n.map(r=>e.jsx(P,{item:!0,xs:12,sm:6,md:4,children:e.jsx(pe,{sx:{height:"100%",display:"flex",flexDirection:"column",transition:"transform 0.2s","&:hover":{transform:"scale(1.02)"}},children:e.jsx(Me,{component:B,to:`/architects/${r.id}`,children:e.jsxs(fe,{children:[e.jsx(i,{variant:"h6",component:"div",gutterBottom:!0,children:r.name}),e.jsxs(i,{variant:"body2",color:"text.secondary",gutterBottom:!0,children:[r.nationality," • ",r.birthYear||"?","-",r.deathYear||"現在"]}),e.jsx(s,{sx:{display:"flex",flexWrap:"wrap",gap:.5,mt:1},children:r.tags&&r.tags.map(b=>e.jsx(O,{label:b,size:"small",variant:"outlined",sx:{pointerEvents:"none"}},b))})]})})})},r.id))}),l>1&&e.jsx(s,{sx:{display:"flex",justifyContent:"center",mt:4},children:e.jsx(Be,{count:l,page:a,onChange:F,color:"primary"})})]})]})},Wr=({architectures:n,compact:t=!1})=>!n||n.length===0?e.jsx(i,{variant:"body2",color:"text.secondary",children:"登録されている作品はありません。"}):e.jsx(P,{container:!0,spacing:t?2:3,children:n.map(o=>e.jsx(P,{item:!0,xs:12,sm:6,md:t?6:4,children:e.jsx(pe,{sx:{height:"100%",display:"flex",flexDirection:"column",transition:"transform 0.2s","&:hover":{transform:"scale(1.02)"}},children:e.jsx(Me,{component:B,to:`/architecture/${o.id}`,sx:{flexGrow:1},children:e.jsxs(fe,{children:[e.jsx(i,{gutterBottom:!0,variant:"h6",component:"h2",children:o.name}),o.completedYear>0&&e.jsxs(s,{sx:{display:"flex",alignItems:"center",mb:1},children:[e.jsx(Gt,{fontSize:"small",sx:{mr:1,color:"text.secondary"}}),e.jsxs(i,{variant:"body2",color:"text.secondary",children:[o.completedYear,"年"]})]}),(o.city||o.location)&&e.jsxs(s,{sx:{display:"flex",alignItems:"center",mb:1},children:[e.jsx(He,{fontSize:"small",sx:{mr:1,color:"text.secondary"}}),e.jsxs(i,{variant:"body2",color:"text.secondary",children:[o.city?o.city:"",o.city&&o.location?" / ":"",o.location?o.location:""]})]}),o.tag&&e.jsx(s,{sx:{display:"flex",flexWrap:"wrap",gap:.5,mt:1},children:o.tag.split(",").filter(g=>g.trim()!==""&&!g.includes("の追加建築")).map((g,l)=>e.jsx(O,{label:g.trim(),size:"small",color:"secondary",variant:"outlined",sx:{height:"20px",fontSize:"0.65rem"}},l))})]})})})},o.id))}),kr=()=>e.jsx(s,{component:"span",sx:{display:"inline-flex",alignItems:"center",justifyContent:"center",width:24,height:24},children:e.jsx(i,{variant:"caption",component:"span",sx:{fontFamily:"serif",fontWeight:"bold",fontSize:"16px"},children:"W"})}),_r=()=>{const{id:n}=At(),[t,o]=x.useState(null),[g,l]=x.useState(!0),[m,d]=x.useState(null),[c,a]=x.useState([]),f=Ke();x.useEffect(()=>{n&&(async()=>{l(!0);try{const E=await Rr(parseInt(n));if(!E){d("建築家情報が見つかりませんでした。"),l(!1);return}o(E);const j=[];if(E.teacher1){const S={name:E.teacher1,id:null};try{S.id=await p(E.teacher1)}catch($){console.error("教師情報の取得に失敗:",$)}j.push(S)}if(E.teacher2){const S={name:E.teacher2,id:null};try{S.id=await p(E.teacher2)}catch($){console.error("教師情報の取得に失敗:",$)}j.push(S)}if(E.teacher3){const S={name:E.teacher3,id:null};try{S.id=await p(E.teacher3)}catch($){console.error("教師情報の取得に失敗:",$)}j.push(S)}a(j)}catch(E){console.error("建築家データ取得エラー:",E),d("建築家情報の読み込み中にエラーが発生しました。")}finally{l(!1)}})()},[n]);const p=async u=>null,A=()=>{if(!t)return null;const u=[];if(t.school){let E=t.school;t.faculty&&(E+=` ${t.faculty}`),u.push(E)}return t.schoolAbroad&&u.push(t.schoolAbroad),u.length>0?u.join("、"):null},_=()=>!c||c.length===0?null:c.map((u,E)=>e.jsxs("span",{children:[E>0&&"、",u.id?e.jsx(sr,{component:B,to:`/architects/${u.id}`,color:"inherit",underline:"hover",children:u.name}):u.name]},E)),T=(u,E)=>{if(!E)return;let j="";switch(u){case"nationality":j=`nationality=${encodeURIComponent(E)}`;break;case"born":j=`birthyear_from=${encodeURIComponent(E)}&birthyear_to=${encodeURIComponent(E)}`;break;case"died":j=`deathyear=${encodeURIComponent(E)}`;break;case"category":j=`category=${encodeURIComponent(E)}`;break;default:return}f(`/architects?${j}`)},C=(u,E)=>{const j=`${u} ${E||""} 建築家`;return`https://www.google.com/search?q=${encodeURIComponent(j)}`},D=u=>`https://ja.wikipedia.org/wiki/Special:Search?search=${encodeURIComponent(u)}`;if(g)return e.jsx(te,{maxWidth:"lg",sx:{py:4},children:e.jsx(s,{sx:{display:"flex",justifyContent:"center",py:8},children:e.jsx($e,{})})});if(m||!t)return e.jsx(te,{maxWidth:"lg",sx:{py:4},children:e.jsxs(le,{sx:{p:3},children:[e.jsx(i,{variant:"h5",color:"error",gutterBottom:!0,children:"エラー"}),e.jsx(i,{paragraph:!0,children:m||"建築家情報が見つかりませんでした。"}),e.jsx(k,{variant:"outlined",startIcon:e.jsx(_e,{}),onClick:()=>f(-1),children:"戻る"})]})});const M=new Set;t.works&&t.works.forEach(u=>{u.tag&&u.tag.split(",").forEach(j=>{const S=j.trim();S&&!S.includes("の追加建築")&&M.add(S)})});const q=[];if(t.nationality&&q.push(`nationality:${t.nationality}`),t.birthYear>0){const u=Math.floor(t.birthYear/10)*10;q.push(`born:${u}s`)}return t.deathYear>0&&q.push(`died:${t.deathYear}`),t.category&&q.push(`category:${t.category}`),t.school&&q.push(`school:${t.school}`),e.jsxs(te,{maxWidth:"lg",sx:{py:4},children:[e.jsx(k,{variant:"outlined",component:B,to:"/architects",startIcon:e.jsx(_e,{}),sx:{mb:3},children:"建築家一覧に戻る"}),e.jsxs(le,{sx:{p:3,mb:4},children:[e.jsx(i,{variant:"h4",component:"h1",gutterBottom:!0,children:t.name||"不明"}),e.jsxs(s,{sx:{display:"flex",flexWrap:"wrap",gap:2,my:3},children:[t.nationality&&e.jsx(O,{icon:e.jsx(Kt,{}),label:`nationality:${t.nationality}`,variant:"outlined",onClick:()=>T("nationality",t.nationality),clickable:!0}),t.birthYear>0&&e.jsx(O,{icon:e.jsx(qt,{}),label:`born:${Math.floor(t.birthYear/10)*10}s`,variant:"outlined",onClick:()=>T("born",Math.floor(t.birthYear/10)*10),clickable:!0}),t.deathYear>0&&e.jsx(O,{icon:e.jsx(Qt,{}),label:`died:${t.deathYear}`,variant:"outlined",onClick:()=>T("died",t.deathYear),clickable:!0}),t.category&&e.jsx(O,{icon:e.jsx(Ve,{}),label:`category:${t.category}`,variant:"outlined",onClick:()=>T("category",t.category),clickable:!0}),t.office&&e.jsx(O,{icon:e.jsx(Jt,{}),label:t.office,variant:"outlined"})]}),e.jsx(Ue,{sx:{my:3}}),e.jsxs(s,{sx:{mb:3,display:"flex",flexDirection:"row",gap:1},children:[t.website&&e.jsx(Ce,{title:"公式ホームページ",children:e.jsx(k,{href:t.website.startsWith("http")?t.website:`http://${t.website}`,target:"_blank",rel:"noopener noreferrer",startIcon:e.jsx(Vt,{}),variant:"contained",size:"small",sx:{backgroundColor:"#4caf50",color:"#ffffff","&:hover":{backgroundColor:"#388e3c"}},children:"ホームページ"})}),e.jsx(Ce,{title:"Google検索",children:e.jsx(k,{href:C(t.name,t.nationality),target:"_blank",rel:"noopener noreferrer",startIcon:e.jsx(ze,{}),variant:"contained",size:"small",sx:{backgroundColor:"#4285F4",color:"#ffffff","&:hover":{backgroundColor:"#3367D6"}},children:"検索"})}),e.jsx(Ce,{title:"Wikipediaで検索",children:e.jsx(k,{href:D(t.name),target:"_blank",rel:"noopener noreferrer",startIcon:e.jsx(kr,{}),variant:"contained",size:"small",sx:{backgroundColor:"#333333",color:"#ffffff","&:hover":{backgroundColor:"#222222"}},children:"Wikipedia"})})]}),e.jsx(Xt,{component:le,variant:"outlined",sx:{mb:4},children:e.jsx(er,{children:e.jsxs(tr,{children:[t.nationality&&e.jsxs(me,{children:[e.jsx(U,{component:"th",sx:{width:"30%",bgcolor:"rgba(0, 0, 0, 0.03)"},children:e.jsx(i,{variant:"subtitle2",children:"国籍"})}),e.jsx(U,{children:t.nationality})]}),(t.birthYear>0||t.deathYear>0)&&e.jsxs(me,{children:[e.jsx(U,{component:"th",sx:{width:"30%",bgcolor:"rgba(0, 0, 0, 0.03)"},children:e.jsx(i,{variant:"subtitle2",children:"生年 - 没年"})}),e.jsxs(U,{children:[t.birthYear>0?`${t.birthYear}年`:"不明",t.deathYear>0?` - ${t.deathYear}年`:""]})]}),t.office&&e.jsxs(me,{children:[e.jsx(U,{component:"th",sx:{width:"30%",bgcolor:"rgba(0, 0, 0, 0.03)"},children:e.jsx(i,{variant:"subtitle2",children:"事務所"})}),e.jsx(U,{children:t.office})]}),t.prefecture&&e.jsxs(me,{children:[e.jsx(U,{component:"th",sx:{width:"30%",bgcolor:"rgba(0, 0, 0, 0.03)"},children:e.jsx(i,{variant:"subtitle2",children:"拠点"})}),e.jsx(U,{children:t.prefecture})]}),t.nameEn&&e.jsxs(me,{children:[e.jsx(U,{component:"th",sx:{width:"30%",bgcolor:"rgba(0, 0, 0, 0.03)"},children:e.jsx(i,{variant:"subtitle2",children:"英語表記"})}),e.jsx(U,{children:t.nameEn})]}),(t.school||t.faculty||t.schoolAbroad)&&e.jsxs(me,{children:[e.jsx(U,{component:"th",sx:{width:"30%",bgcolor:"rgba(0, 0, 0, 0.03)"},children:e.jsx(i,{variant:"subtitle2",children:"教育背景"})}),e.jsx(U,{children:e.jsxs(s,{sx:{display:"flex",alignItems:"center"},children:[e.jsx(rr,{sx:{mr:1,fontSize:"1rem",color:"text.secondary"}}),e.jsx(i,{variant:"body2",children:A()})]})})]}),(t.teacher1||t.teacher2||t.teacher3)&&e.jsxs(me,{children:[e.jsx(U,{component:"th",sx:{width:"30%",bgcolor:"rgba(0, 0, 0, 0.03)"},children:e.jsx(i,{variant:"subtitle2",children:"師事した建築家"})}),e.jsx(U,{children:e.jsx(s,{sx:{display:"flex",flexDirection:"column",gap:1},children:_()})})]}),t.category&&e.jsxs(me,{children:[e.jsx(U,{component:"th",sx:{width:"30%",bgcolor:"rgba(0, 0, 0, 0.03)"},children:e.jsx(i,{variant:"subtitle2",children:"カテゴリー"})}),e.jsx(U,{children:t.category})]})]})})}),M.size>0&&e.jsxs(s,{sx:{mb:4},children:[e.jsx(i,{variant:"h6",gutterBottom:!0,children:"受賞歴・選定"}),e.jsx(s,{sx:{display:"flex",flexWrap:"wrap",gap:1,mb:2},children:Array.from(M).map((u,E)=>e.jsx(O,{icon:e.jsx(Ct,{}),label:String(u),onClick:()=>T("category",u),clickable:!0,color:"secondary",variant:"outlined",size:"small"},E))})]}),t.bio&&e.jsxs(s,{sx:{mb:4},children:[e.jsx(i,{variant:"h6",gutterBottom:!0,children:"経歴"}),e.jsx(i,{variant:"body1",sx:{whiteSpace:"pre-line"},children:t.bio})]}),t.works&&t.works.length>0&&e.jsxs(e.Fragment,{children:[e.jsxs(s,{sx:{mb:4},children:[e.jsx(i,{variant:"h6",gutterBottom:!0,children:"作品マップ"}),t.works.some(u=>u.latitude&&u.longitude)?e.jsx(s,{sx:{height:"400px",width:"100%",mb:3,border:"1px solid #eee",borderRadius:"4px",overflow:"hidden"},children:e.jsx(Pe,{markers:t.works.filter(u=>u.latitude&&u.longitude),zoom:5,center:[t.works[0].latitude||35.6762,t.works[0].longitude||139.6503]})}):e.jsx(i,{variant:"body2",color:"text.secondary",children:"位置情報が登録されている作品がありません。"})]}),e.jsxs(s,{sx:{mb:4},children:[e.jsx(i,{variant:"h6",gutterBottom:!0,children:"代表作品"}),e.jsx(Wr,{architectures:t.works})]})]})]})]})},$r=()=>{const[n,t]=x.useState(!0),[o,g]=x.useState([]),[l,m]=x.useState([]),[d,c]=x.useState({yearFrom:"",yearTo:""}),[a,f]=x.useState(!1),[p,A]=x.useState(null),[_,T]=x.useState(!1);x.useEffect(()=>{D()},[]);const C=j=>{if(!j||j.length===0)return{from:0,to:0};const S=j.filter(G=>G.completedYear>0);if(S.length===0)return{from:0,to:0};const $=S.map(G=>G.completedYear).sort((G,Q)=>G-Q),ne=$[0],R=$[$.length-1],je=Math.min(100,Math.floor((R-ne)/2)),X=Math.floor(Math.random()*($.length-Math.floor($.length/4))),ce=$[X],re=Math.min(ce+je,R);return{from:ce,to:re}},D=async()=>{t(!0);try{const j=await Wt();if(m(j),!d.yearFrom&&!d.yearTo){const S=C(j);c({yearFrom:S.from.toString(),yearTo:S.to.toString()});const $=j.filter(ne=>ne.completedYear>=S.from&&ne.completedYear<=S.to);g($)}else{let S=j;d.yearFrom&&(S=S.filter($=>$.completedYear>=parseInt(d.yearFrom))),d.yearTo&&(S=S.filter($=>$.completedYear<=parseInt(d.yearTo))),g(S)}}catch(j){console.error("Error fetching works:",j)}finally{t(!1)}},M=j=>{const{name:S,value:$}=j.target;c({...d,[S]:$})},q=()=>{t(!0);let j=l;d.yearFrom&&(j=j.filter(S=>S.completedYear>=parseInt(d.yearFrom))),d.yearTo&&(j=j.filter(S=>S.completedYear<=parseInt(d.yearTo))),g(j),t(!1)},u=()=>{c({yearFrom:"",yearTo:""}),g(l)},E=j=>{A(j),T(!0)};return e.jsxs(te,{maxWidth:"lg",sx:{py:4},children:[e.jsx(i,{variant:"h4",component:"h1",gutterBottom:!0,children:"建築地図"}),e.jsxs(le,{sx:{p:3,mb:4},children:[e.jsx(k,{startIcon:e.jsx(nr,{}),onClick:()=>f(!a),sx:{mb:2},children:a?"フィルターを閉じる":"フィルターを表示"}),a&&e.jsx(s,{sx:{mb:2},children:e.jsxs(P,{container:!0,spacing:2,children:[e.jsx(P,{item:!0,xs:12,sm:6,md:4,children:e.jsx(Ae,{fullWidth:!0,label:"年代（から）",name:"yearFrom",type:"number",value:d.yearFrom,onChange:M})}),e.jsx(P,{item:!0,xs:12,sm:6,md:4,children:e.jsx(Ae,{fullWidth:!0,label:"年代（まで）",name:"yearTo",type:"number",value:d.yearTo,onChange:M})}),e.jsx(P,{item:!0,xs:12,md:4,children:e.jsxs(s,{sx:{display:"flex",gap:1,height:"100%"},children:[e.jsx(k,{variant:"contained",color:"primary",onClick:q,sx:{flexGrow:1},children:"フィルター適用"}),e.jsx(k,{variant:"outlined",onClick:u,sx:{flexGrow:1},children:"クリア"})]})})]})}),e.jsxs(s,{sx:{display:"flex",alignItems:"center",mb:2},children:[e.jsx(Ie,{sx:{mr:1}}),e.jsxs(i,{variant:"body2",color:"text.secondary",children:["マップ上に表示された作品: ",o.length,"件 ",d.yearFrom&&d.yearTo&&`(${d.yearFrom}年〜${d.yearTo}年)`]})]})]}),n?e.jsx(s,{sx:{display:"flex",justifyContent:"center",py:4},children:e.jsx($e,{})}):e.jsxs(s,{sx:{height:600,bgcolor:"grey.200",position:"relative",borderRadius:1},children:[e.jsx(Pe,{markers:o,height:"600px",zoom:5,center:[35.6762,139.6503]}),e.jsxs(s,{sx:{position:"absolute",top:16,right:16,width:320,maxHeight:568,overflow:"auto",bgcolor:"background.paper",borderRadius:1,boxShadow:3,p:2,zIndex:1e3},children:[e.jsx(i,{variant:"h6",gutterBottom:!0,children:"作品リスト"}),o.length===0?e.jsx(i,{variant:"body2",children:"条件に一致する作品はありません"}):e.jsx(dt,{dense:!0,children:o.map(j=>e.jsxs(Tt.Fragment,{children:[e.jsx(ht,{onClick:()=>E(j),sx:{cursor:"pointer",bgcolor:p&&p.id===j.id?"action.selected":"transparent","&:hover":{bgcolor:"action.hover"}},children:e.jsx(xt,{primary:j.name,secondary:e.jsxs(e.Fragment,{children:[j.architectName&&e.jsxs("span",{children:[j.architectName,e.jsx("br",{})]}),j.completedYear>0&&`${j.completedYear}年 | `,j.city||""]})})}),e.jsx(Ue,{component:"li"})]},j.id))})]})]}),e.jsx(ct,{anchor:"right",open:_,onClose:()=>T(!1),children:p&&e.jsxs(s,{sx:{width:350,p:3},children:[e.jsx(i,{variant:"h5",gutterBottom:!0,children:p.name}),e.jsxs(s,{sx:{mb:3},children:[p.architectName&&e.jsx(i,{variant:"subtitle1",color:"text.secondary",children:p.architectName}),e.jsxs(i,{variant:"body2",children:[p.completedYear>0&&`${p.completedYear}年`,p.city&&` | ${p.city}`]}),p.location&&e.jsx(i,{variant:"body2",sx:{mt:1},children:p.location})]}),e.jsx(s,{sx:{mb:3,height:200},children:e.jsx(Pe,{singleMarker:p,height:"200px",zoom:15,center:[p.latitude,p.longitude]})}),e.jsxs(s,{sx:{display:"flex",justifyContent:"space-between",mt:4},children:[e.jsx(k,{variant:"outlined",onClick:()=>T(!1),children:"閉じる"}),e.jsx(k,{variant:"contained",component:B,to:`/architecture/${p.id}`,children:"詳細を見る"})]})]})})]})};class kt extends x.Component{constructor(t){super(t),this.state={hasError:!1,error:null,errorInfo:null}}static getDerivedStateFromError(t){return{hasError:!0,error:t,errorInfo:null}}componentDidCatch(t,o){console.error("Uncaught error:",t,o),this.setState({error:t,errorInfo:o})}handleRetry=()=>{window.location.reload()};render(){return this.state.hasError?this.props.fallback?this.props.fallback:e.jsx(s,{sx:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",padding:4,height:"100vh"},children:e.jsxs(le,{elevation:3,sx:{padding:4,maxWidth:600,width:"100%",borderRadius:2,textAlign:"center"},children:[e.jsx(i,{variant:"h5",color:"error",gutterBottom:!0,children:"問題が発生しました"}),e.jsx(i,{variant:"body1",paragraph:!0,children:"アプリケーションで予期しないエラーが発生しました。 お手数ですが、再読み込みをお試しください。"}),!1,e.jsxs(s,{sx:{mt:3},children:[e.jsx(k,{variant:"contained",color:"primary",onClick:this.handleRetry,sx:{mr:2},children:"ページを再読み込み"}),e.jsx(k,{variant:"outlined",onClick:()=>window.location.href="/",children:"ホームに戻る"})]})]})}):this.props.children}}const Nr=()=>{try{const n=window?.location?.hostname||"";return/github\.io$/.test(n)}catch(n){return console.error("環境チェックエラー:",n),!1}},Yr=async()=>{try{const t=Nr();console.log("アプリケーション環境: 本番"),console.log(`GitHub Pages環境: ${t?"はい":"いいえ"}`);try{const g=await fetch(t?"./db/database-info.json":"/db/database-info.json");if(g.ok){const l=await g.json();console.log("データベース情報:"),console.log(`- ファイル: ${l.database}`),console.log(`- 更新日時: ${l.date}`),console.log(`- サイズ: ${(l.size/1024/1024).toFixed(2)} MB`),console.log(`- チャンク: ${l.chunks} (${l.chunkSize/1024}KB)のチャンク`),console.log(`- テーブル数: ${l.tables.length}`),console.log(`- インデックス数: ${l.indexes.length}`)}else console.warn("データベースメタデータが見つかりません:",g.status)}catch(o){console.warn("データベースメタデータ読み込みエラー:",o)}}catch(n){console.error("データベース設定ログエラー:",n)}},Fr=({children:n})=>{const[t,o]=x.useState(Tr()),[g,l]=x.useState(null),[m,d]=x.useState(0);return x.useEffect(()=>{let c=!0,a;return(async()=>{t!==Le.READY&&setTimeout(async()=>{a=setInterval(()=>{c&&d(p=>{const A=(95-p)*.1;return Math.min(p+A,95)})},300);try{await vt(),c&&(d(100),o(Le.READY))}catch(p){c&&(l(`データベースの初期化に失敗しました: ${p instanceof Error?p.message:"不明なエラー"}`),o(Le.ERROR))}finally{clearInterval(a)}},100)})(),()=>{c=!1,clearInterval(a)}},[t]),e.jsx(e.Fragment,{children:n})},et={primary:{main:"#2E3440",light:"#4C566A",dark:"#1B1F2B",contrastText:"#FFFFFF"},secondary:{main:"#88C0D0",light:"#B3D4E0",dark:"#5E81AC",contrastText:"#2E3440"},accent:{main:"#D08770",light:"#E5A088",dark:"#BF616A"},background:{default:"#ECEFF4",paper:"#FFFFFF",elevated:"#F8F9FA"},text:{primary:"#2E3440",secondary:"#4C566A",disabled:"#D8DEE9"},divider:"#E5E9F0",success:{main:"#A3BE8C",light:"#B8CCA3",dark:"#8CAF69"},warning:{main:"#EBCB8B",light:"#F0D5A3",dark:"#D4B571"},error:{main:"#BF616A",light:"#CC8088",dark:"#A54A56"},info:{main:"#88C0D0",light:"#B3D4E0",dark:"#5E81AC"}},Or={fontFamily:'"Inter", "Roboto", "Helvetica Neue", "Arial", sans-serif',h1:{fontSize:"3rem",fontWeight:700,lineHeight:1.2,letterSpacing:"-0.02em"},h2:{fontSize:"2.25rem",fontWeight:600,lineHeight:1.3,letterSpacing:"-0.01em"},h3:{fontSize:"1.875rem",fontWeight:600,lineHeight:1.3,letterSpacing:"-0.01em"},h4:{fontSize:"1.5rem",fontWeight:600,lineHeight:1.4},h5:{fontSize:"1.25rem",fontWeight:600,lineHeight:1.4},h6:{fontSize:"1.125rem",fontWeight:600,lineHeight:1.4},subtitle1:{fontSize:"1rem",fontWeight:500,lineHeight:1.5},subtitle2:{fontSize:"0.875rem",fontWeight:500,lineHeight:1.5},body1:{fontSize:"1rem",fontWeight:400,lineHeight:1.6},body2:{fontSize:"0.875rem",fontWeight:400,lineHeight:1.6},caption:{fontSize:"0.75rem",fontWeight:400,lineHeight:1.5},button:{fontSize:"0.875rem",fontWeight:600,textTransform:"none",letterSpacing:"0.02em"}},Zr={MuiButton:{styleOverrides:{root:{borderRadius:8,padding:"10px 24px",transition:"all 0.2s ease-in-out","&:hover":{transform:"translateY(-1px)",boxShadow:"0 4px 12px rgba(0, 0, 0, 0.15)"}},contained:{boxShadow:"0 2px 8px rgba(0, 0, 0, 0.1)"}}},MuiCard:{styleOverrides:{root:{borderRadius:12,boxShadow:"0 2px 12px rgba(0, 0, 0, 0.08)",transition:"all 0.3s ease-in-out","&:hover":{transform:"translateY(-2px)",boxShadow:"0 8px 24px rgba(0, 0, 0, 0.15)"}}}},MuiTextField:{styleOverrides:{root:{"& .MuiOutlinedInput-root":{borderRadius:8,transition:"all 0.2s ease-in-out","&:hover":{"& .MuiOutlinedInput-notchedOutline":{borderColor:et.secondary.main}},"&.Mui-focused":{"& .MuiOutlinedInput-notchedOutline":{borderColor:et.primary.main,borderWidth:2}}}}}},MuiAppBar:{styleOverrides:{root:{boxShadow:"0 2px 12px rgba(0, 0, 0, 0.1)",backdropFilter:"blur(10px)",backgroundColor:"rgba(46, 52, 64, 0.95)"}}},MuiChip:{styleOverrides:{root:{borderRadius:8,fontWeight:500}}},MuiPaper:{styleOverrides:{root:{borderRadius:12,boxShadow:"0 2px 12px rgba(0, 0, 0, 0.08)"},elevation1:{boxShadow:"0 2px 8px rgba(0, 0, 0, 0.06)"},elevation2:{boxShadow:"0 4px 12px rgba(0, 0, 0, 0.1)"},elevation3:{boxShadow:"0 8px 24px rgba(0, 0, 0, 0.15)"}}}},Lr=ar({palette:et,typography:Or,components:Zr,spacing:8,shape:{borderRadius:8},breakpoints:{values:{xs:0,sm:600,md:960,lg:1280,xl:1920}},transitions:{easing:{easeInOut:"cubic-bezier(0.4, 0, 0.2, 1)",easeOut:"cubic-bezier(0.0, 0, 0.2, 1)",easeIn:"cubic-bezier(0.4, 0, 1, 1)",sharp:"cubic-bezier(0.4, 0, 0.6, 1)"}}}),Br=()=>{const{pathname:n}=Ge();return x.useEffect(()=>{window.scrollTo(0,0)},[n]),null},Hr=()=>(x.useEffect(()=>{console.log("App running in production mode");try{Yr()}catch(n){console.warn("Failed to log database details:",n)}},[]),e.jsxs(e.Fragment,{children:[e.jsx(Br,{}),e.jsx(mr,{}),e.jsx("main",{className:"container",role:"main",children:e.jsx(kt,{children:e.jsxs(dr,{children:[e.jsx(Ee,{path:"/",element:e.jsx(yr,{})}),e.jsx(Ee,{path:"/architecture",element:e.jsx(Ir,{})}),e.jsx(Ee,{path:"/architecture/:id",element:e.jsx(vr,{})}),e.jsx(Ee,{path:"/architects",element:e.jsx(Dr,{})}),e.jsx(Ee,{path:"/architects/:id",element:e.jsx(_r,{})}),e.jsx(Ee,{path:"/map",element:e.jsx($r,{})})]})})}),e.jsx(gr,{})]})),Pr=()=>e.jsx(kt,{children:e.jsxs(or,{theme:Lr,children:[e.jsx(ir,{}),e.jsx(cr,{children:e.jsx(Fr,{children:e.jsx(Hr,{})})})]})});console.log("React アプリケーションを初期化中...","production");console.log("DOM root element:",document.getElementById("root"));const _t=document.getElementById("root");if(!_t)throw console.error('root要素が見つかりません。HTMLに<div id="root"></div>が存在するか確認してください。'),new Error("Failed to find the root element");const zr=It(_t);console.log("Using HashRouter for GitHub Pages compatibility");try{zr.render(e.jsx(Tt.StrictMode,{children:e.jsx(Pr,{})})),console.log("React アプリケーションのレンダリングが成功しました")}catch(n){console.error("React アプリケーションのレンダリング中にエラーが発生しました:",n)}
//# sourceMappingURL=index-B6gdsuRW.js.map
