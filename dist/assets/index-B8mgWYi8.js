import{u as Wt,a as kt,j as e,A as _t,T as $t,b as n,I as Je,M as Yt,D as lt,B as s,C as Nt,L as ct,c as dt,d as ht,e as W,H as Ft,f as Le,P as $e,g as ve,S as Ot,h as ee,G as z,i as ae,k as fe,l as je,F as Ce,m as rt,n as O,o as Te,p as Me,q as Zt,r as Ae,R as Lt,s as Pe,t as Ue,v as le,w as Ge,x as Ve,y as xt,z as ut,E as mt,J as gt,K as pt,N as X,O as Ht,Q as ft,U as He,V as Re,W as jt,X as Be,Y as yt,Z as Ye,_ as Xe,$ as bt,a0 as Bt,a1 as zt,a2 as Mt,a3 as Pt,a4 as Ut,a5 as Gt,a6 as Kt,a7 as qt,a8 as Qt,a9 as Jt,aa as Vt,ab as me,ac as P,ad as Xt,ae as er,af as tr,ag as rr,ah as sr,ai as nr}from"./ui-CyZ5RW7z.js";import{a as ar,u as Ke,r as d,L as H,e as qe,f as Ct,R as At,H as Tt,h as or,i as Ie}from"./vendor-C30vB44U.js";import{d as ir}from"./database-C3TWL7Qm.js";import{L as Et,M as lr,T as cr,a as st,P as nt}from"./map-C0JyOu4T.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const l of document.querySelectorAll('link[rel="modulepreload"]'))g(l);new MutationObserver(l=>{for(const m of l)if(m.type==="childList")for(const h of m.addedNodes)h.tagName==="LINK"&&h.rel==="modulepreload"&&g(h)}).observe(document,{childList:!0,subtree:!0});function i(l){const m={};return l.integrity&&(m.integrity=l.integrity),l.referrerPolicy&&(m.referrerPolicy=l.referrerPolicy),l.crossOrigin==="use-credentials"?m.credentials="include":l.crossOrigin==="anonymous"?m.credentials="omit":m.credentials="same-origin",m}function g(l){if(l.ep)return;l.ep=!0;const m=i(l);fetch(l.href,m)}})();var It,at=ar;It=at.createRoot,at.hydrateRoot;const ot=[{title:"ホーム",path:"/",icon:e.jsx(Ft,{})},{title:"建築作品",path:"/architecture",icon:e.jsx(Le,{})},{title:"建築家",path:"/architects",icon:e.jsx($e,{})},{title:"マップ",path:"/map",icon:e.jsx(ve,{})},{title:"DBエクスプローラー",path:"/db-explorer",icon:e.jsx(Ot,{})}],dr=()=>{const t=Ke().pathname,i=Wt(),g=kt(i.breakpoints.down("sm")),[l,m]=d.useState(!1),h=x=>a=>{a.type==="keydown"&&(a.key==="Tab"||a.key==="Shift")||m(x)};return e.jsx(_t,{position:"static",color:"primary",children:e.jsxs($t,{children:[e.jsx(n,{variant:"h6",component:H,to:"/",sx:{flexGrow:1,color:"white",textDecoration:"none",fontWeight:"bold"},children:"建築データベース"}),g?e.jsxs(e.Fragment,{children:[e.jsx(Je,{edge:"end",color:"inherit","aria-label":"menu",onClick:h(!0),children:e.jsx(Yt,{})}),e.jsx(lt,{anchor:"right",open:l,onClose:h(!1),children:e.jsxs(s,{sx:{width:250},role:"presentation",onClick:h(!1),onKeyDown:h(!1),children:[e.jsx(s,{sx:{display:"flex",justifyContent:"flex-end",p:1},children:e.jsx(Je,{onClick:h(!1),children:e.jsx(Nt,{})})}),e.jsx(ct,{children:ot.map(({title:x,path:a,icon:b})=>e.jsxs(dt,{component:H,to:a,sx:{color:t===a?"primary.main":"text.primary",backgroundColor:t===a?"rgba(0, 0, 0, 0.08)":"transparent",fontWeight:t===a?"bold":"normal","&:hover":{backgroundColor:"rgba(0, 0, 0, 0.04)"}},children:[b,e.jsx(ht,{primary:x,sx:{ml:2}})]},x))})]})})]}):e.jsx(s,{sx:{display:"flex"},children:ot.map(({title:x,path:a})=>e.jsx(W,{component:H,to:a,color:"inherit",sx:{mx:1,fontWeight:t===a?"bold":"normal",borderBottom:t===a?"2px solid white":"none"},children:x},x))})]})})},hr=()=>e.jsx(s,{component:"footer",sx:{py:3,px:2,mt:"auto",backgroundColor:"primary.main",color:"white"},children:e.jsx(ee,{maxWidth:"sm",children:e.jsxs(n,{variant:"body1",align:"center",children:["建築データベース © ",new Date().getFullYear()]})})}),xr={from:"cdn",config:{serverMode:"full",requestChunkSize:4096,url:"./db/archimap.sqlite"}},ur="./sql-wasm.js",mr="./sql-wasm.wasm";let pe=null,et=!1,_e=null;var ge=(o=>(o.NOT_INITIALIZED="not_initialized",o.INITIALIZING="initializing",o.READY="ready",o.ERROR="error",o))(ge||{});const gr=()=>pe?"ready":et?"initializing":"not_initialized",vt=async()=>{if(pe)return pe;if(_e)return _e;et=!0;try{_e=ir.createDbWorker([xr],ur,mr,()=>console.log("データベースワーカーの準備完了")),pe=await _e,console.log("データベース接続を確立しました");const o=await pe.db.exec("SELECT sqlite_version()");return console.log(`SQLite バージョン: ${o[0]?.values[0][0]}`),pe}catch(o){throw console.error("データベース初期化エラー:",o),o}finally{et=!1,_e=null}},Rt=async(o,t=[])=>{try{return pe||await vt(),await pe.db.exec(o,t)}catch(i){throw console.error("クエリ実行エラー:",i),i}},St=o=>{if(!o||o.length===0)return[];const{columns:t,values:i}=o[0];return i.map(g=>{const l={};return t.forEach((m,h)=>{l[m]=g[h]}),l})},Qe=async(o,t=[])=>{const i=await Rt(o,t);return St(i)[0]},Ne=async(o,t=[])=>{const i=await Rt(o,t);return St(i)},pr=async o=>Qe("SELECT * FROM ZCDARCHITECTURE WHERE ZAW_ID = ?",[o]),Dt=async(o=1,t=12,i="",g="ZAW_NAME",l="asc",m={})=>{const h=(o-1)*t;let x="1=1";const a=[];i&&(x+=" AND (ZAW_NAME LIKE ? OR ZAW_ADDRESS LIKE ? OR ZAW_DETAIL LIKE ?)",a.push(`%${i}%`,`%${i}%`,`%${i}%`)),m.architect&&(x+=" AND (ZAW_ARCHITECT LIKE ? OR a.ZAR_NAME LIKE ? OR a.ZAR_NAMEENG LIKE ?)",a.push(`%${m.architect}%`,`%${m.architect}%`,`%${m.architect}%`)),m.location&&(x+=" AND ZAW_ADDRESS LIKE ?",a.push(`%${m.location}%`)),m.prefecture&&(x+=" AND ZAW_PREFECTURE = ?",a.push(m.prefecture)),m.yearFrom&&(x+=" AND ZAW_YEAR >= ?",a.push(m.yearFrom)),m.yearTo&&(x+=" AND ZAW_YEAR <= ?",a.push(m.yearTo));let b="LEFT JOIN ZCDARCHITECT a ON ZCDARCHITECTURE.ZAW_ARCHITECT_ID = a.ZAR_ID";m.tags&&m.tags.length>0&&(b+=`
      INNER JOIN ZCDARCHITECTURE_TAG ON ZCDARCHITECTURE.ZAW_ID = ZCDARCHITECTURE_TAG.ARCHITECTURE_ID
      INNER JOIN ZCDTAG ON ZCDARCHITECTURE_TAG.TAG_ID = ZCDTAG.TAG_ID
    `,x+=" AND ZCDTAG.TAG_NAME IN (",x+=m.tags.map(()=>"?").join(","),x+=")",a.push(...m.tags));const f=`
    SELECT COUNT(DISTINCT ZCDARCHITECTURE.ZAW_ID) as total
    FROM ZCDARCHITECTURE
    ${b}
    WHERE ${x}
  `,v=`
    SELECT DISTINCT ZCDARCHITECTURE.*
    FROM ZCDARCHITECTURE
    ${b}
    WHERE ${x}
    ORDER BY ${g} ${l==="desc"?"DESC":"ASC"}
    LIMIT ? OFFSET ?
  `,D=[...a,t,h];try{const R=(await Qe(f,a))?.total||0;return{results:await Ne(v,D),total:R,page:o,limit:t,totalPages:Math.ceil(R/t)}}catch(Y){throw console.error("建築作品データ取得エラー:",Y),Y}},fr=async(o,t={})=>{let i=`
    ZAW_LAT BETWEEN ? AND ?
    AND ZAW_LNG BETWEEN ? AND ?
    AND ZAW_LAT IS NOT NULL
    AND ZAW_LNG IS NOT NULL
  `;const g=[o.south,o.north,o.west,o.east];t.searchTerm&&(i+=" AND (ZAW_NAME LIKE ? OR ZAW_ADDRESS LIKE ? OR ZAW_ARCHITECT LIKE ?)",g.push(`%${t.searchTerm}%`,`%${t.searchTerm}%`,`%${t.searchTerm}%`)),t.architect&&(i+=" AND (ZAW_ARCHITECT LIKE ? OR a.ZAR_NAME LIKE ? OR a.ZAR_NAMEENG LIKE ?)",g.push(`%${t.architect}%`,`%${t.architect}%`,`%${t.architect}%`)),t.yearFrom&&(i+=" AND ZAW_YEAR >= ?",g.push(t.yearFrom)),t.yearTo&&(i+=" AND ZAW_YEAR <= ?",g.push(t.yearTo));let l="LEFT JOIN ZCDARCHITECT a ON ZCDARCHITECTURE.ZAW_ARCHITECT_ID = a.ZAR_ID";t.tags&&t.tags.length>0&&(l+=`
      INNER JOIN ZCDARCHITECTURE_TAG ON ZCDARCHITECTURE.ZAW_ID = ZCDARCHITECTURE_TAG.ARCHITECTURE_ID
      INNER JOIN ZCDTAG ON ZCDARCHITECTURE_TAG.TAG_ID = ZCDTAG.TAG_ID
    `,i+=" AND ZCDTAG.TAG_NAME IN (",i+=t.tags.map(()=>"?").join(","),i+=")",g.push(...t.tags));const m=`
    SELECT DISTINCT ZCDARCHITECTURE.*
    FROM ZCDARCHITECTURE
    ${l}
    WHERE ${i}
    LIMIT 500
  `;return Ne(m,g)},it=({variant:o="card",count:t=6})=>{const i=()=>e.jsx(fe,{sx:{height:"100%"},children:e.jsxs(je,{children:[e.jsx(ae,{variant:"text",height:40,sx:{mb:1}}),e.jsx(ae,{variant:"text",height:20,sx:{mb:1}}),e.jsx(ae,{variant:"text",height:20,width:"60%"})]})}),g=()=>e.jsxs(s,{sx:{p:2},children:[e.jsx(ae,{variant:"text",height:32,sx:{mb:1}}),e.jsx(ae,{variant:"text",height:24,sx:{mb:1}}),e.jsx(ae,{variant:"text",height:20,width:"40%"})]}),l=()=>e.jsx(ee,{maxWidth:"lg",children:e.jsxs(s,{sx:{textAlign:"center",py:8},children:[e.jsx(ae,{variant:"text",height:60,sx:{mb:2}}),e.jsx(ae,{variant:"text",height:30,sx:{mb:4}}),e.jsx(s,{sx:{display:"flex",justifyContent:"center",mb:4},children:e.jsx(ae,{variant:"rectangular",width:500,height:56,sx:{borderRadius:1}})})]})}),m=()=>e.jsx(ae,{variant:"rectangular",width:"100%",height:400,sx:{borderRadius:2}});return o==="hero"?l():o==="map"?m():o==="list"?e.jsx(s,{children:Array.from({length:t}).map((h,x)=>e.jsx(s,{sx:{borderBottom:"1px solid #e0e0e0"},children:g()},x))}):e.jsx(z,{container:!0,spacing:4,children:Array.from({length:t}).map((h,x)=>e.jsx(z,{item:!0,xs:12,sm:6,md:4,children:i()},x))})},jr=()=>{const[o,t]=d.useState(""),[i,g]=d.useState([]),[l,m]=d.useState(!0),[h,x]=d.useState(null),[a,b]=d.useState(!1);d.useEffect(()=>{(async()=>{try{m(!0),x(null),console.log("最近の建築作品を取得中...");const D=await Dt(1,6);g(D.items),b(!0),console.log("建築作品の取得に成功しました",D)}catch(D){console.error("建築作品の取得に失敗:",D),x(D.message||"データベースからの読み込みに失敗しました")}finally{m(!1)}})()},[]);const f=v=>{v.preventDefault(),o.trim()&&(window.location.href=`/architecture?search=${encodeURIComponent(o)}`)};return e.jsxs(ee,{maxWidth:"lg",children:[e.jsx(Ce,{in:!0,timeout:1e3,children:e.jsxs(s,{sx:{pt:8,pb:6,textAlign:"center",background:"linear-gradient(135deg, #ECEFF4 0%, #D8DEE9 100%)",borderRadius:3,mb:6,position:"relative",overflow:"hidden"},children:[e.jsx(s,{sx:{position:"absolute",top:0,left:0,right:0,bottom:0,opacity:.1,background:"repeating-linear-gradient(45deg, transparent, transparent 10px, rgba(46, 52, 64, 0.1) 10px, rgba(46, 52, 64, 0.1) 20px)"}}),e.jsxs(s,{sx:{position:"relative",zIndex:1},children:[e.jsx(n,{component:"h1",variant:"h1",align:"center",color:"text.primary",gutterBottom:!0,sx:{background:"linear-gradient(135deg, #2E3440 0%, #4C566A 100%)",backgroundClip:"text",WebkitBackgroundClip:"text",color:"transparent",mb:2},children:"建築データベース"}),e.jsxs(n,{variant:"h5",align:"center",color:"text.secondary",paragraph:!0,sx:{mb:4,maxWidth:600,mx:"auto"},children:["日本の建築作品と建築家を検索・閲覧できる",e.jsx("br",{}),"包括的なデータベース"]}),e.jsxs(rt,{direction:"row",spacing:3,justifyContent:"center",sx:{mb:4},children:[e.jsx(O,{icon:e.jsx(Le,{}),label:"14,000+ 建築作品",color:"primary",variant:"outlined"}),e.jsx(O,{icon:e.jsx($e,{}),label:"2,900+ 建築家",color:"secondary",variant:"outlined"}),e.jsx(O,{icon:e.jsx(ve,{}),label:"全国対応",color:"info",variant:"outlined"})]}),a?e.jsx(Ce,{in:!0,timeout:1500,children:e.jsxs(s,{component:"form",onSubmit:f,sx:{mt:4,display:"flex",justifyContent:"center",alignItems:"center",maxWidth:600,mx:"auto",gap:2},children:[e.jsx(Te,{fullWidth:!0,variant:"outlined",placeholder:"建築作品、建築家、住所などで検索",value:o,onChange:v=>t(v.target.value),sx:{"& .MuiOutlinedInput-root":{backgroundColor:"white",boxShadow:"0 4px 12px rgba(0, 0, 0, 0.1)"}}}),e.jsx(W,{type:"submit",variant:"contained",color:"primary",startIcon:e.jsx(Me,{}),size:"large",sx:{px:3,py:1.5,minWidth:120},children:"検索"})]})}):e.jsx(it,{variant:"hero"})]})]})}),e.jsxs(s,{sx:{py:4},children:[e.jsxs(s,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:3},children:[e.jsxs(s,{sx:{display:"flex",alignItems:"center",gap:2},children:[e.jsx(Zt,{color:"primary"}),e.jsx(n,{variant:"h4",fontWeight:"bold",children:"最近の建築作品"})]}),a&&e.jsx(Ae,{title:"リフレッシュ",children:e.jsx(Je,{onClick:()=>window.location.reload(),color:"primary",children:e.jsx(Lt,{})})})]}),h&&e.jsx(Ce,{in:!0,children:e.jsx(Pe,{severity:"error",sx:{mb:3,borderRadius:2,"& .MuiAlert-message":{display:"flex",alignItems:"center",gap:2}},children:e.jsxs(s,{children:[h,e.jsx(W,{size:"small",variant:"outlined",sx:{ml:2},component:H,to:"/db-explorer",children:"診断ツールを開く"})]})})}),l?e.jsx(it,{variant:"card",count:6}):i.length>0?e.jsx(Ce,{in:!0,timeout:800,children:e.jsx(z,{container:!0,spacing:4,children:i.map((v,D)=>e.jsx(z,{item:!0,xs:12,sm:6,md:4,children:e.jsx(Ce,{in:!0,timeout:1e3+D*200,children:e.jsx(fe,{sx:{height:"100%",display:"flex",flexDirection:"column",background:"linear-gradient(135deg, #FFFFFF 0%, #F8F9FA 100%)",border:"1px solid #E5E9F0","&:hover":{"& .card-content":{transform:"translateY(-2px)"}}},children:e.jsx(Ue,{component:H,to:`/architecture/${v.ZAW_ID}`,sx:{height:"100%"},children:e.jsxs(je,{className:"card-content",sx:{flexGrow:1,transition:"transform 0.3s ease-in-out",p:3},children:[e.jsx(n,{gutterBottom:!0,variant:"h6",component:"h3",sx:{fontWeight:600,color:"text.primary",mb:2,lineHeight:1.3},children:v.ZAW_NAME}),e.jsxs(rt,{spacing:1,children:[e.jsxs(s,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx($e,{fontSize:"small",color:"secondary"}),e.jsx(n,{variant:"body2",color:"text.secondary",children:v.ZAW_ARCHITECT||"建築家不明"})]}),e.jsxs(s,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(ve,{fontSize:"small",color:"secondary"}),e.jsxs(n,{variant:"body2",color:"text.secondary",children:[v.ZAW_ADDRESS||"場所不明"," • ",v.ZAW_YEAR&&v.ZAW_YEAR!==0?v.ZAW_YEAR+"年":"年代不明"]})]})]})]})})})})},v.ZAW_ID))})}):e.jsxs(le,{sx:{p:6,textAlign:"center",background:"linear-gradient(135deg, #F8F9FA 0%, #ECEFF4 100%)"},children:[e.jsx(n,{variant:"h6",color:"text.secondary",gutterBottom:!0,children:"建築作品が見つかりませんでした"}),e.jsx(n,{variant:"body2",color:"text.secondary",children:"データベースの接続を確認してください"})]}),a&&e.jsx(Ce,{in:!0,timeout:1200,children:e.jsx(s,{sx:{display:"flex",justifyContent:"center",mt:4},children:e.jsx(W,{variant:"outlined",color:"primary",component:H,to:"/architecture",size:"large",sx:{px:4,py:1.5,borderWidth:2,"&:hover":{borderWidth:2}},children:"すべての作品を見る"})})})]}),e.jsx(Ge,{sx:{my:6}}),e.jsx(Ce,{in:!0,timeout:1400,children:e.jsxs(s,{sx:{mb:6},children:[e.jsx(n,{variant:"h4",align:"center",gutterBottom:!0,sx:{mb:4,fontWeight:"bold"},children:"データベースの特徴"}),e.jsxs(z,{container:!0,spacing:4,children:[e.jsx(z,{item:!0,xs:12,md:4,children:e.jsxs(fe,{sx:{height:"100%",display:"flex",flexDirection:"column",background:"linear-gradient(135deg, #88C0D0 0%, #5E81AC 100%)",color:"white",position:"relative",overflow:"hidden"},children:[e.jsx(s,{sx:{position:"absolute",top:-20,right:-20,opacity:.2},children:e.jsx(Le,{sx:{fontSize:100}})}),e.jsxs(je,{sx:{position:"relative",zIndex:1,p:3},children:[e.jsxs(s,{sx:{display:"flex",alignItems:"center",mb:2},children:[e.jsx(Le,{sx:{mr:2,fontSize:32}}),e.jsx(n,{variant:"h5",fontWeight:"bold",children:"建築作品"})]}),e.jsx(n,{paragraph:!0,sx:{mb:3,opacity:.9},children:"日本全国から14,000件以上の建築作品情報を閲覧できます。地域、年代、カテゴリーなどで詳細検索が可能です。"}),e.jsx(W,{variant:"contained",component:H,to:"/architecture",sx:{mt:"auto",backgroundColor:"rgba(255, 255, 255, 0.2)",color:"white","&:hover":{backgroundColor:"rgba(255, 255, 255, 0.3)"}},children:"作品を探す"})]})]})}),e.jsx(z,{item:!0,xs:12,md:4,children:e.jsxs(fe,{sx:{height:"100%",display:"flex",flexDirection:"column",background:"linear-gradient(135deg, #D08770 0%, #BF616A 100%)",color:"white",position:"relative",overflow:"hidden"},children:[e.jsx(s,{sx:{position:"absolute",top:-20,right:-20,opacity:.2},children:e.jsx($e,{sx:{fontSize:100}})}),e.jsxs(je,{sx:{position:"relative",zIndex:1,p:3},children:[e.jsxs(s,{sx:{display:"flex",alignItems:"center",mb:2},children:[e.jsx($e,{sx:{mr:2,fontSize:32}}),e.jsx(n,{variant:"h5",fontWeight:"bold",children:"建築家"})]}),e.jsx(n,{paragraph:!0,sx:{mb:3,opacity:.9},children:"2,900人以上の建築家情報を収録。経歴、作品リスト、所属事務所などの詳細情報を確認できます。"}),e.jsx(W,{variant:"contained",component:H,to:"/architects",sx:{mt:"auto",backgroundColor:"rgba(255, 255, 255, 0.2)",color:"white","&:hover":{backgroundColor:"rgba(255, 255, 255, 0.3)"}},children:"建築家を探す"})]})]})}),e.jsx(z,{item:!0,xs:12,md:4,children:e.jsxs(fe,{sx:{height:"100%",display:"flex",flexDirection:"column",background:"linear-gradient(135deg, #A3BE8C 0%, #8CAF69 100%)",color:"white",position:"relative",overflow:"hidden"},children:[e.jsx(s,{sx:{position:"absolute",top:-20,right:-20,opacity:.2},children:e.jsx(ve,{sx:{fontSize:100}})}),e.jsxs(je,{sx:{position:"relative",zIndex:1,p:3},children:[e.jsxs(s,{sx:{display:"flex",alignItems:"center",mb:2},children:[e.jsx(ve,{sx:{mr:2,fontSize:32}}),e.jsx(n,{variant:"h5",fontWeight:"bold",children:"マップ表示"})]}),e.jsx(n,{paragraph:!0,sx:{mb:3,opacity:.9},children:"建築作品を地図上で視覚的に探索できます。位置情報をもとに周辺の建築作品を発見できます。"}),e.jsx(W,{variant:"contained",component:H,to:"/map",sx:{mt:"auto",backgroundColor:"rgba(255, 255, 255, 0.2)",color:"white","&:hover":{backgroundColor:"rgba(255, 255, 255, 0.3)"}},children:"マップを開く"})]})]})})]})]})})]})},yr=()=>{const[o,t]=d.useState([]),[i,g]=d.useState(!0),[l,m]=d.useState(0),[h,x]=d.useState(1),[a,b]=d.useState(""),[f,v]=d.useState(""),[D,Y]=d.useState([]),[R,F]=d.useState([]),[J,te]=d.useState([]),[u,C]=d.useState("year_desc"),[p,I]=d.useState({}),[k,ne]=d.useState(null),[E,ye]=d.useState(""),[V,ce]=d.useState({}),re=12,U=Ke(),K=qe();d.useEffect(()=>{(async()=>{try{te([])}catch(j){console.error("タグ取得エラー:",j)}})()},[]),d.useEffect(()=>{const c=new URLSearchParams(U.search),j=c.get("tag"),T=c.get("search"),_=c.get("year"),G=c.get("prefecture"),$=c.get("category"),N=c.get("architect"),w=c.get("sort");if(w&&C(w),j){const A=j.split(",").map(r=>r.trim()).filter(r=>r),L=new Set,q=[];A.forEach(r=>{const y=r.match(/\d{4}年\d{1,2}月号?/);if(y){const S=r.replace(y[0],"").trim();S&&(L.add(S),q.push(r))}else L.add(r)}),Y(Array.from(L)),F(q),v(j),b(`tag:${j}`),B(1,`tag:${j}`,w||u)}else _?(b(`year:${_}`),B(1,`year:${_}`,w||u)):G?(b(`prefecture:${G}`),B(1,`prefecture:${G}`,w||u)):$?(b(`category:${$}`),B(1,`category:${$}`,w||u)):N?(b(`architect:${N}`),B(1,`architect:${N}`,w||u)):T?(b(T),B(1,T,w||u)):B(1,a,w||u)},[U.search]);const B=async(c,j=a,T=u)=>{g(!0);try{const _=await Dt(c,re,j,T);t(_.items),m(_.total),x(c)}catch(_){console.error("Error fetching architectures:",_)}finally{g(!1)}},oe=(c,j)=>{x(j),B(j,a,u),window.scrollTo(0,0)},be=c=>{b(c.target.value)},de=async(c,j)=>{ne(c.currentTarget),ye(j);try{const T=[];ce(_=>({..._,[j]:T}))}catch(T){console.error(`Failed to get years for tag ${j}:`,T)}},he=()=>{ne(null),ye("")},Se=c=>{const j=c?`${E}${c}`:E;let T=[...R];const _=T.findIndex(A=>A.startsWith(E)&&(A===E||A.match(new RegExp(`^${E}\\d{4}年\\d{1,2}月号?`))||A.match(new RegExp(`^${E}\\d{4}年度?`))||A.match(new RegExp(`^${E}第\\d+回`))||A.match(new RegExp(`^${E}\\(\\d{4}\\)`))));_>=0?c?T[_]=j:T.splice(_,1):c&&T.push(j),F(T),he();const G=[...D];G.includes(E)||G.push(E);const $=[...G,...T].filter((A,L,q)=>q.indexOf(A)===L&&!T.some(r=>r!==A&&r.startsWith(A))).join(",");v($);const N=`tag:${$}`;b(N),B(1,N,u);const w=new URLSearchParams;w.set("tag",$),u!=="year_desc"&&w.set("sort",u),K({search:w.toString()})},De=(c,j)=>{const T=D.filter($=>!j.includes($));let _=[...R].filter($=>!T.some(N=>$.startsWith(N)));const G=j.filter($=>!D.includes($));if(G.length>0&&G.forEach(async $=>{if(!V[$])try{const N=[];if(ce(w=>({...w,[$]:N})),N&&N.length===1){const w=`${$}${N[0]}`;_.push(w)}}catch(N){console.error(`Failed to get years for tag ${$}:`,N)}}),Y(j),F(_),j.length>0||_.length>0){const $=[...j,..._].filter((A,L,q)=>q.indexOf(A)===L&&!_.some(r=>r!==A&&r.startsWith(A))).join(",");v($);const N=`tag:${$}`;b(N),B(1,N,u);const w=new URLSearchParams;w.set("tag",$),u!=="year_desc"&&w.set("sort",u),K({search:w.toString()})}else Ee()},xe=c=>{const j=c.target.value;C(j),B(h,a,j);const T=new URLSearchParams(U.search);T.set("sort",j),K({search:T.toString()})},ue=()=>{x(1),B(1,a,u);const c=new URLSearchParams;if(u!=="year_desc"&&c.set("sort",u),a.startsWith("tag:")){const j=a.substring(4).trim();c.set("tag",j)}else if(a.startsWith("year:")){const j=a.substring(5).trim();c.set("year",j)}else if(a.startsWith("prefecture:")){const j=a.substring(11).trim();c.set("prefecture",j)}else if(a.startsWith("category:")){const j=a.substring(9).trim();c.set("category",j)}else if(a.startsWith("architect:")){const j=a.substring(10).trim();c.set("architect",j)}else a&&c.set("search",a);K({search:c.toString()})},Ee=()=>{v(""),b(""),Y([]),F([]),x(1),B(1,"",u);const c=new URLSearchParams;u!=="year_desc"&&c.set("sort",u),K({search:c.toString()})},ie=Math.ceil(l/re);return e.jsxs(ee,{maxWidth:"lg",sx:{py:4},children:[e.jsx(n,{variant:"h4",component:"h1",gutterBottom:!0,children:"建築作品一覧"}),e.jsxs(le,{sx:{p:3,mb:4},children:[e.jsxs(s,{sx:{display:"flex",flexDirection:{xs:"column",sm:"row"},gap:2,mb:3},children:[e.jsx(Te,{fullWidth:!0,label:"建築作品名、住所、建築家で検索",value:a,onChange:be,onKeyPress:c=>c.key==="Enter"&&ue(),InputProps:{startAdornment:e.jsx(Ve,{position:"start",children:e.jsx(Me,{})})}}),e.jsx(W,{variant:"contained",onClick:ue,sx:{minWidth:"120px"},children:"検索"})]}),e.jsxs(s,{sx:{display:"flex",flexDirection:{xs:"column",md:"row"},gap:2,mb:3,alignItems:"flex-start"},children:[e.jsx(xt,{multiple:!0,id:"tags-selector",options:J,value:D,onChange:De,renderInput:c=>e.jsx(Te,{...c,variant:"outlined",label:"タグで絞り込み",placeholder:"タグを選択"}),renderTags:(c,j)=>c.map((T,_)=>{const G=R.some(A=>A.startsWith(T)&&A!==T),$=!!(V[T]&&V[T].length>0),N=R.find(A=>A.startsWith(T)&&A!==T);let w="";if(N){const A=N.substring(T.length);A.match(/\d{4}年\d{1,2}月号?/)?w=A.replace(/^(\d{4})/,(L,q)=>`'${q.substring(2)}`):A.match(/\d{4}年度?/)?w=A.replace(/^(\d{4})/,(L,q)=>`'${q.substring(2)}`):A.match(/第\d+回/)?w=A:A.match(/\(\d{4}\)/)?w=A.replace(/\((\d{4})\)/,(L,q)=>`'${q.substring(2)}`):w=A}return e.jsx(O,{label:e.jsxs(s,{sx:{display:"flex",alignItems:"center"},children:[T,N&&e.jsx(n,{variant:"caption",sx:{ml:.5,fontWeight:"bold",backgroundColor:"rgba(0, 0, 0, 0.08)",borderRadius:"4px",px:.5,py:.2},children:w}),$&&e.jsx(ut,{fontSize:"small"})]}),...j({index:_}),color:G?"primary":"default",variant:"outlined",onClick:A=>{A.stopPropagation(),de(A,T)},onDelete:A=>{j({index:_}).onDelete(A)},sx:{maxWidth:"100%","& .MuiChip-label":{overflow:"hidden",whiteSpace:"nowrap",textOverflow:"ellipsis"}}},T)}),sx:{flex:2}}),e.jsxs(mt,{sx:{minWidth:200,flex:1},children:[e.jsx(gt,{id:"sort-select-label",children:"並び替え"}),e.jsxs(pt,{labelId:"sort-select-label",id:"sort-select",value:u,label:"並び替え",onChange:xe,startAdornment:e.jsx(Ve,{position:"start",children:e.jsx(Ht,{})}),children:[e.jsx(X,{value:"year_desc",children:"年代（新しい順）"}),e.jsx(X,{value:"year_asc",children:"年代（古い順）"}),e.jsx(X,{value:"name_asc",children:"名前（昇順）"}),e.jsx(X,{value:"name_desc",children:"名前（降順）"}),e.jsx(X,{value:"architect_asc",children:"建築家（昇順）"}),e.jsx(X,{value:"architect_desc",children:"建築家（降順）"})]})]})]}),e.jsx(ft,{open:!!k,anchorEl:k,onClose:he,anchorOrigin:{vertical:"bottom",horizontal:"left"},children:e.jsxs(s,{sx:{p:2,maxHeight:300,width:"250px",overflowY:"auto"},children:[e.jsxs(n,{variant:"subtitle2",sx:{mb:1},children:[E," の選択:"]}),e.jsxs(s,{sx:{display:"flex",flexDirection:"column",gap:1},children:[e.jsx(O,{label:"指定なし",onClick:()=>Se(""),variant:"outlined",size:"small",color:D.includes(E)&&!R.some(c=>c.startsWith(E)&&c!==E)?"primary":"default"}),V[E]?.map(c=>{let j=c,T="default";return R.some(_=>_===`${E}${c}`)&&(T="primary"),e.jsx(O,{label:j,onClick:()=>Se(c),variant:"outlined",size:"small",color:T,sx:{overflow:"hidden",textOverflow:"ellipsis",maxWidth:"100%"}},c)})]})]})}),(f||a)&&e.jsx(s,{sx:{mb:3},children:e.jsx(Pe,{severity:"info",action:e.jsx(W,{color:"inherit",size:"small",onClick:Ee,children:"クリア"}),children:f?`タグ「${f}」で絞り込み中`:`「${a}」で検索中`})}),e.jsxs(s,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:2},children:[e.jsxs(n,{variant:"body2",color:"text.secondary",children:[l," 件の建築作品"]}),ie>1&&e.jsx(He,{count:ie,page:h,onChange:oe,color:"primary",size:"small"})]})]}),i?e.jsx(s,{sx:{display:"flex",justifyContent:"center",py:4},children:e.jsx(Re,{})}):e.jsxs(e.Fragment,{children:[o.length===0?e.jsxs(s,{sx:{textAlign:"center",py:4},children:[e.jsx(n,{variant:"h6",children:"建築作品が見つかりませんでした"}),e.jsx(n,{variant:"body2",color:"text.secondary",sx:{mt:1},children:"検索条件を変更してお試しください"})]}):e.jsx(z,{container:!0,spacing:3,children:o.map(c=>e.jsx(z,{item:!0,xs:12,sm:6,md:4,lg:3,children:e.jsx(fe,{sx:{height:"100%",display:"flex",flexDirection:"column",transition:"transform 0.2s","&:hover":{transform:"scale(1.02)"}},children:e.jsx(Ue,{component:H,to:`/architecture/${c.id}`,sx:{display:"flex",flexDirection:"column",alignItems:"flex-start",height:"100%"},children:e.jsxs(je,{sx:{width:"100%",flexGrow:1},children:[e.jsx(n,{gutterBottom:!0,variant:"h6",component:"h2",children:c.name}),e.jsxs(s,{sx:{display:"flex",flexDirection:"column",gap:1,mt:2},children:[c.architectName&&e.jsxs(s,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(jt,{fontSize:"small",color:"action"}),e.jsx(n,{variant:"body2",color:"text.secondary",children:c.architectName})]}),c.city&&e.jsxs(s,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(Be,{fontSize:"small",color:"action"}),e.jsx(n,{variant:"body2",color:"text.secondary",children:c.city})]}),c.completedYear>0&&e.jsxs(s,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(yt,{fontSize:"small",color:"action"}),e.jsxs(n,{variant:"body2",color:"text.secondary",children:[c.completedYear,"年"]})]})]})]})})})},c.id))}),ie>1&&e.jsx(s,{sx:{display:"flex",justifyContent:"center",mt:4},children:e.jsx(He,{count:ie,page:h,onChange:oe,color:"primary"})})]})]})};delete Et.Icon.Default.prototype._getIconUrl;Et.Icon.Default.mergeOptions({iconRetinaUrl:"https://unpkg.com/leaflet@1.7.1/dist/images/marker-icon-2x.png",iconUrl:"https://unpkg.com/leaflet@1.7.1/dist/images/marker-icon.png",shadowUrl:"https://unpkg.com/leaflet@1.7.1/dist/images/marker-shadow.png"});const ze=({markers:o=[],center:t,zoom:i=13,height:g="500px",singleMarker:l})=>{const[m,h]=d.useState(t);return d.useEffect(()=>{l&&l.latitude&&l.longitude?h([l.latitude,l.longitude]):t&&h(t)},[l,t]),e.jsx("div",{style:{height:g,width:"100%",marginBottom:"20px"},children:e.jsxs(lr,{center:m,zoom:i,style:{height:"100%",width:"100%"},children:[e.jsx(cr,{attribution:'© <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors',url:"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png"}),o.map((x,a)=>x.latitude&&x.longitude?e.jsx(st,{position:[x.latitude,x.longitude],children:e.jsxs(nt,{children:[e.jsx(n,{variant:"h6",children:x.name}),e.jsx(n,{variant:"body2",children:x.location}),e.jsx(W,{component:H,to:`/architecture/${x.id}`,size:"small",variant:"outlined",sx:{mt:1},children:"詳細を見る"})]})},`marker-${x.id||a}`):null),l&&l.latitude&&l.longitude&&e.jsx(st,{position:[l.latitude,l.longitude],children:e.jsxs(nt,{children:[e.jsx(n,{variant:"h6",children:l.name}),e.jsx(n,{variant:"body2",children:l.location})]})})]})})},br=()=>{const{id:o}=Ct(),[t,i]=d.useState(null),[g,l]=d.useState(!0),[m,h]=d.useState(null),x=qe();if(d.useEffect(()=>{(async()=>{l(!0);try{const F=await pr(o);if(!F)throw new Error("建築作品の取得に失敗しました");i(F)}catch(F){console.error("Error fetching work:",F),h(F.message)}finally{l(!1)}})()},[o]),g)return e.jsx(s,{sx:{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"60vh"},children:e.jsx(Re,{})});if(m)return e.jsxs(ee,{children:[e.jsxs(n,{variant:"h5",color:"error",sx:{textAlign:"center",my:4},children:["エラーが発生しました: ",m]}),e.jsx(W,{variant:"contained",component:H,to:"/architecture",startIcon:e.jsx(Ye,{}),children:"建築作品一覧に戻る"})]});if(!t)return e.jsxs(ee,{children:[e.jsx(n,{variant:"h5",sx:{textAlign:"center",my:4},children:"建築作品が見つかりませんでした"}),e.jsx(W,{variant:"contained",component:H,to:"/architecture",startIcon:e.jsx(Ye,{}),children:"建築作品一覧に戻る"})]});const a=t.tag?t.tag.split(",").filter(R=>R.trim()!==""&&!R.includes("の追加建築")):[],b=a.find(R=>R.includes("新建築")),f=b?b.replace("新建築",""):"",v=R=>{console.log(`タグがクリックされました: ${R}`),x(`/architecture?tag=${encodeURIComponent(R)}`)},D=(R,F)=>{const J=`${R} ${F?.name||""} 建築`;return`https://www.google.com/search?q=${encodeURIComponent(J)}&tbm=isch`},Y=R=>`https://ja.wikipedia.org/wiki/Special:Search?search=${encodeURIComponent(R)}`;return e.jsxs(ee,{maxWidth:"lg",sx:{py:4},children:[e.jsx(W,{variant:"outlined",component:H,to:"/architecture",startIcon:e.jsx(Ye,{}),sx:{mb:3},children:"建築作品一覧に戻る"}),e.jsxs(le,{sx:{p:3,mb:4},children:[e.jsxs(s,{sx:{mb:2},children:[e.jsx(n,{variant:"h4",component:"h1",gutterBottom:!0,children:t.name||"無題"}),t.location&&e.jsxs(n,{variant:"subtitle1",color:"text.secondary",gutterBottom:!0,children:[e.jsx(Be,{fontSize:"small",sx:{verticalAlign:"middle",mr:.5}}),t.location]}),e.jsxs(s,{sx:{display:"flex",flexWrap:"wrap",gap:1,mb:2},children:[t.completedYear!==0&&e.jsx(O,{icon:e.jsx(yt,{}),label:`${t.completedYear}年`,variant:"outlined",size:"small",onClick:()=>x(`/architecture?year=${t.completedYear}`),clickable:!0}),t.city&&e.jsx(O,{icon:e.jsx(Be,{}),label:t.city,variant:"outlined",size:"small",onClick:()=>x(`/architecture?prefecture=${encodeURIComponent(t.city)}`),clickable:!0}),t.architect&&t.architect.name&&e.jsx(O,{icon:e.jsx(jt,{}),label:t.architect.name,component:H,to:`/architects/${t.architect.id}`,clickable:!0,color:"primary",size:"small"}),t.bigCategory&&e.jsx(O,{icon:e.jsx(Xe,{}),label:t.bigCategory,variant:"outlined",size:"small",onClick:()=>x(`/architecture?category=${encodeURIComponent(t.bigCategory)}`),clickable:!0}),t.category&&t.category!==t.bigCategory&&e.jsx(O,{icon:e.jsx(Xe,{}),label:t.category,variant:"outlined",size:"small",onClick:()=>x(`/architecture?category=${encodeURIComponent(t.category)}`),clickable:!0})]}),a.length>0&&e.jsx(s,{sx:{display:"flex",flexWrap:"wrap",gap:1,mb:2},children:a.map((R,F)=>e.jsx(O,{icon:e.jsx(bt,{}),label:R,onClick:()=>v(R),clickable:!0,color:"secondary",variant:"outlined",size:"small"},F))})]}),e.jsx(Ge,{sx:{my:3}}),e.jsxs(s,{sx:{mb:3,display:"flex",flexDirection:"row",gap:1},children:[t.shinkenchikuUrl&&e.jsx(Ae,{title:"新建築データで見る",children:e.jsxs(W,{variant:"contained",href:t.shinkenchikuUrl,target:"_blank",rel:"noopener noreferrer",size:"small",sx:{backgroundColor:"#003366",color:"#ffffff","&:hover":{backgroundColor:"#002244"}},children:[e.jsx(s,{sx:{display:"flex",alignItems:"center",justifyContent:"center",mr:.5},children:e.jsx("img",{src:"https://data.shinkenchiku.online/favicon.ico",alt:"新建築データ",style:{height:"16px",width:"auto",marginRight:"4px"}})}),f&&e.jsx(n,{variant:"caption",children:f})]})}),e.jsx(Ae,{title:"Google画像検索",children:e.jsx(W,{href:D(t.name,t.architect),target:"_blank",rel:"noopener noreferrer",startIcon:e.jsx(Bt,{}),variant:"contained",size:"small",sx:{backgroundColor:"#4285F4",color:"#ffffff","&:hover":{backgroundColor:"#3367D6"}},children:"画像"})}),e.jsx(Ae,{title:"Wikipediaで検索",children:e.jsx(W,{href:Y(t.name),target:"_blank",rel:"noopener noreferrer",startIcon:e.jsx(zt,{}),variant:"contained",size:"small",sx:{backgroundColor:"#333333",color:"#ffffff","&:hover":{backgroundColor:"#222222"}},children:"Wikipedia"})})]}),t.description&&e.jsxs(s,{sx:{mt:3},children:[e.jsx(n,{variant:"h6",gutterBottom:!0,children:"概要"}),e.jsx(n,{variant:"body1",paragraph:!0,sx:{whiteSpace:"pre-line"},children:t.description})]}),t.latitude&&t.longitude&&e.jsxs(s,{sx:{mt:3},children:[e.jsx(n,{variant:"h6",gutterBottom:!0,children:"位置情報"}),e.jsx(s,{sx:{height:"400px",width:"100%",mt:2,border:"1px solid #eee",borderRadius:"4px",overflow:"hidden"},children:e.jsx(ze,{singleMarker:{id:t.id||0,latitude:t.latitude,longitude:t.longitude,name:t.name,location:t.location},center:[t.latitude,t.longitude],zoom:15})})]})]})]})},Cr=async o=>Qe("SELECT * FROM ZCDARCHITECT WHERE ZAR_ID = ?",[o]),Ar=async(o=1,t=12,i="",g=[],l="ZAR_NAME",m="asc",h={})=>{const x=(o-1)*t;let a="1=1";const b=[];i&&(a+=" AND (ZAR_NAME LIKE ? OR ZAR_KANA LIKE ? OR ZAR_NAMEENG LIKE ?)",b.push(`%${i}%`,`%${i}%`,`%${i}%`)),h.nationality&&(a+=" AND ZAR_NATIONALITY = ?",b.push(h.nationality)),h.category&&(a+=" AND ZAR_CATEGORY = ?",b.push(h.category)),h.school&&(a+=" AND ZAR_SCHOOL = ?",b.push(h.school)),h.birthYearFrom&&(a+=" AND ZAR_BIRTHYEAR >= ?",b.push(h.birthYearFrom)),h.birthYearTo&&(a+=" AND ZAR_BIRTHYEAR <= ?",b.push(h.birthYearTo)),h.deathYear&&(a+=" AND ZAR_DEATHYEAR = ?",b.push(h.deathYear));let f="";g&&g.length>0&&(f=`
      INNER JOIN ZCDARCHITECT_TAG ON ZCDARCHITECT.ZAR_ID = ZCDARCHITECT_TAG.ARCHITECT_ID
      INNER JOIN ZCDTAG ON ZCDARCHITECT_TAG.TAG_ID = ZCDTAG.TAG_ID
    `,a+=" AND ZCDTAG.TAG_NAME IN (",a+=g.map(()=>"?").join(","),a+=")",b.push(...g));const v=`
    SELECT COUNT(DISTINCT ZCDARCHITECT.ZAR_ID) as total
    FROM ZCDARCHITECT
    ${f}
    WHERE ${a}
  `,D=`
    SELECT DISTINCT ZCDARCHITECT.*
    FROM ZCDARCHITECT
    ${f}
    WHERE ${a}
    ORDER BY ${l} ${m==="desc"?"DESC":"ASC"}
    LIMIT ? OFFSET ?
  `,Y=[...b,t,x];try{const F=(await Qe(v,b))?.total||0;return{results:await Ne(D,Y),total:F,page:o,limit:t,totalPages:Math.ceil(F/t)}}catch(R){throw console.error("建築家データ取得エラー:",R),R}},Tr=async()=>Ne(`
    SELECT TAG_ID, TAG_NAME, COUNT(ARCHITECT_ID) as TAG_COUNT
    FROM ZCDTAG
    LEFT JOIN ZCDARCHITECT_TAG ON ZCDTAG.TAG_ID = ZCDARCHITECT_TAG.TAG_ID
    GROUP BY ZCDTAG.TAG_ID, ZCDTAG.TAG_NAME
    ORDER BY TAG_COUNT DESC, TAG_NAME
  `),Er=()=>{console.log("ArchitectsPage コンポーネントがレンダリングされました");const[o,t]=d.useState([]),[i,g]=d.useState(!0),[l,m]=d.useState(0),[h,x]=d.useState(0),[a,b]=d.useState(1),[f,v]=d.useState(""),[D,Y]=d.useState([]),[R,F]=d.useState([]),[J,te]=d.useState([]),[u,C]=d.useState("name"),[p,I]=d.useState("asc"),[k,ne]=d.useState(null),[E,ye]=d.useState(""),[V,ce]=d.useState({}),[re,U]=d.useState(""),[K,B]=d.useState(""),[oe,be]=d.useState(""),[de,he]=d.useState(""),[Se,De]=d.useState(""),[xe,ue]=d.useState(""),Ee=qe(),ie=Ke(),c=new URLSearchParams(ie.search);d.useEffect(()=>{console.log("tagMenuAnchorEl 状態変更:",!!k)},[k]),d.useEffect(()=>{console.log("タグ読み込みのuseEffectが実行されました"),(async()=>{try{console.log("建築家タグ取得開始");const y=await Tr();console.log("取得した建築家タグ:",y),te(["国籍","カテゴリー","学校","生年","没年"])}catch(y){console.error("タグ取得エラー:",y)}})()},[]),d.useEffect(()=>{console.log("建築家データ読み込みのuseEffectが実行されました",ie.search),(async()=>{g(!0);try{const y=parseInt(c.get("page")||"1"),S=c.get("search")||"",Q=c.get("tags")?c.get("tags").split(","):[],Z=c.get("sortBy")||"name",M=c.get("sortOrder")||"asc",se=c.get("nationality")||"",Fe=c.get("category")||"",Oe=c.get("school")||"",we=c.get("birthYearFrom")||"",We=c.get("birthYearTo")||"",ke=c.get("deathYear")||"";console.log("URLから読み取ったパラメータ:",{page:y,search:S,tags:Q,sort:Z,order:M,nat:se,cat:Fe,sch:Oe,birthFrom:we,birthTo:We,death:ke}),b(y),v(S),Y(Q),C(Z),I(M),U(se),B(Fe),be(Oe),he(we),De(We),ue(ke),console.log("建築家データ取得開始:",{page:y,search:S,tags:Q,sort:Z,order:M,nat:se,cat:Fe,sch:Oe,birthFrom:we,birthTo:We,death:ke});const Ze=await Ar(y,10,S,Q,Z,M,se,Fe,Oe,we?parseInt(we):0,We?parseInt(We):0,ke?parseInt(ke):0);console.log("取得した建築家データ:",Ze),t(Ze.items),m(Ze.totalPages),x(Ze.total)}catch(y){console.error("建築家データ取得エラー:",y)}finally{g(!1)}})()},[ie.search]);const j=async r=>{console.log(`${r}の年度取得開始`);let y="";if(r==="国籍"?y="SELECT DISTINCT ZAT_NATIONALITY as value FROM ZCDARCHITECT WHERE ZAT_NATIONALITY != '' ORDER BY ZAT_NATIONALITY":r==="カテゴリー"?y="SELECT DISTINCT ZAT_CATEGORY as value FROM ZCDARCHITECT WHERE ZAT_CATEGORY != '' ORDER BY ZAT_CATEGORY":r==="学校"?y="SELECT DISTINCT ZAT_SCHOOL as value FROM ZCDARCHITECT WHERE ZAT_SCHOOL != '' ORDER BY ZAT_SCHOOL":r==="生年"?y="SELECT DISTINCT ZAT_BIRTHYEAR as value FROM ZCDARCHITECT WHERE ZAT_BIRTHYEAR > 0 ORDER BY ZAT_BIRTHYEAR DESC":r==="没年"&&(y="SELECT DISTINCT ZAT_DEATHYEAR as value FROM ZCDARCHITECT WHERE ZAT_DEATHYEAR > 0 ORDER BY ZAT_DEATHYEAR DESC"),!y)return[];try{return(await Ne(y)).map(Q=>String(Q.value)).filter(Boolean)}catch(S){return console.error(`${r}の値取得エラー:`,S),[]}},T=async(r,y)=>{if(console.log(`${y}の年度メニューを開く`,r.currentTarget),ne(r.currentTarget),ye(y),!V[y])try{const S=await j(y);console.log(`取得した${y}の年度:`,S),ce(Q=>({...Q,[y]:S}))}catch(S){console.error(`${y}の年度取得エラー:`,S)}},_=()=>{console.log("年度メニューを閉じる"),ne(null),ye("")},G=r=>{console.log(`年度選択: ${r} (タグ: ${E})`),E==="国籍"?U(r):E==="カテゴリー"?B(r):E==="学校"?be(r):E==="生年"?he(r):E==="没年"&&ue(r),_(),L()},$=(r,y)=>{console.log("タグ選択変更:",y),Y(y);const S=D.filter(Z=>!y.includes(Z));for(const Z of S)Z==="国籍"?U(""):Z==="カテゴリー"?B(""):Z==="学校"?be(""):Z==="生年"?(he(""),De("")):Z==="没年"&&ue("");const Q=y.filter(Z=>!D.includes(Z));Q.length>0&&Q.forEach(async Z=>{if(!V[Z])try{const M=await j(Z);ce(se=>({...se,[Z]:M}))}catch(M){console.error(`${Z}の年度取得エラー:`,M)}}),L()},N=(r,y)=>{console.log(`ページ変更: ${y}`),b(y);const S=new URLSearchParams(ie.search);S.set("page",y.toString()),Ee({search:S.toString()})},w=()=>{console.log(`検索実行: ${f}`),L()},A=()=>{console.log("検索条件をクリア"),v(""),Y([]),F([]),U(""),B(""),be(""),he(""),De(""),ue(""),b(1);const r=new URLSearchParams;u!=="name"&&r.set("sortBy",u),p!=="asc"&&r.set("sortOrder",p),Ee({search:r.toString()})},L=()=>{console.log("URLと検索を更新");const r=new URLSearchParams;a>1&&r.set("page",a.toString()),f&&r.set("search",f),D.length>0&&r.set("tags",D.join(",")),u!=="name"&&r.set("sortBy",u),p!=="asc"&&r.set("sortOrder",p),re&&r.set("nationality",re),K&&r.set("category",K),oe&&r.set("school",oe),de&&r.set("birthYearFrom",de),Se&&r.set("birthYearTo",Se),xe&&r.set("deathYear",xe),console.log("新しいURLパラメータ:",r.toString()),Ee({search:r.toString()})},q=()=>{const r=[];return re&&r.push({label:`国籍: ${re}`,onDelete:()=>{U(""),L()}}),de&&r.push({label:`生年: ${de}`,onDelete:()=>{he(""),L()}}),xe&&r.push({label:`没年: ${xe}`,onDelete:()=>{ue(""),L()}}),K&&r.push({label:`カテゴリー: ${K}`,onDelete:()=>{B(""),L()}}),oe&&r.push({label:`学校: ${oe}`,onDelete:()=>{be(""),L()}}),r.length===0&&!f&&D.length===0?null:e.jsx(s,{sx:{mb:3},children:e.jsx(Pe,{severity:"info",action:e.jsx(W,{color:"inherit",size:"small",onClick:A,children:"クリア"}),children:r.length>0?`フィルター: ${r.map(y=>y.label).join(", ")}`:f?`「${f}」で検索中`:D.length>0?`タグ「${D.join(", ")}」で絞り込み中`:""})})};return e.jsxs(ee,{maxWidth:"lg",sx:{py:4},children:[e.jsx(n,{variant:"h4",component:"h1",gutterBottom:!0,children:"建築家一覧"}),e.jsxs(le,{sx:{p:3,mb:4},children:[e.jsxs(s,{sx:{display:"flex",flexDirection:{xs:"column",sm:"row"},gap:2,mb:3},children:[e.jsx(Te,{fullWidth:!0,label:"建築家名、国籍、カテゴリーで検索",value:f,onChange:r=>v(r.target.value),onKeyPress:r=>r.key==="Enter"&&w(),InputProps:{startAdornment:e.jsx(Ve,{position:"start",children:e.jsx(Me,{})})}}),e.jsx(W,{variant:"contained",onClick:w,sx:{minWidth:"120px"},children:"検索"})]}),e.jsxs(s,{sx:{display:"flex",flexDirection:{xs:"column",md:"row"},gap:2,mb:3,alignItems:"flex-start"},children:[e.jsx(xt,{multiple:!0,id:"tags-selector",options:J,value:D,onChange:$,fullWidth:!0,renderInput:r=>e.jsx(Te,{...r,variant:"outlined",label:"タグで絞り込み",placeholder:"タグを選択"}),renderTags:(r,y)=>r.map((S,Q)=>{const Z=!!(V[S]&&V[S].length>0);let M="";return S==="国籍"?M=re:S==="カテゴリー"?M=K:S==="学校"?M=oe:S==="生年"?M=de:S==="没年"&&(M=xe),e.jsx(O,{label:e.jsxs(s,{sx:{display:"flex",alignItems:"center"},children:[S,M&&e.jsx(n,{variant:"caption",sx:{ml:.5,fontWeight:"bold",backgroundColor:"rgba(0, 0, 0, 0.08)",borderRadius:"4px",px:.5,py:.2},children:M}),Z&&e.jsx(ut,{fontSize:"small"})]}),...y({index:Q}),color:M?"primary":"default",variant:"outlined",onClick:se=>{se.stopPropagation(),T(se,S)},onDelete:se=>{y({index:Q}).onDelete(se)},sx:{maxWidth:"100%","& .MuiChip-label":{overflow:"hidden",whiteSpace:"nowrap"}}},S)})}),e.jsxs(mt,{sx:{minWidth:200},children:[e.jsx(gt,{id:"sort-select-label",children:"並び替え"}),e.jsxs(pt,{labelId:"sort-select-label",value:`${u}_${p}`,label:"並び替え",onChange:r=>{const[y,S]=r.target.value.split("_");C(y),I(S),L()},children:[e.jsx(X,{value:"name_asc",children:"名前 (昇順)"}),e.jsx(X,{value:"name_desc",children:"名前 (降順)"}),e.jsx(X,{value:"birthYear_asc",children:"生年 (昇順)"}),e.jsx(X,{value:"birthYear_desc",children:"生年 (降順)"}),e.jsx(X,{value:"nationality_asc",children:"国籍 (昇順)"}),e.jsx(X,{value:"nationality_desc",children:"国籍 (降順)"})]})]})]}),e.jsx(ft,{open:!!k,anchorEl:k,onClose:_,anchorOrigin:{vertical:"bottom",horizontal:"left"},transformOrigin:{vertical:"top",horizontal:"left"},children:e.jsxs(s,{sx:{p:2,width:300,maxHeight:400,overflow:"auto"},children:[e.jsx(n,{variant:"subtitle1",gutterBottom:!0,children:E==="国籍"?"国籍を選択":E==="カテゴリー"?"カテゴリーを選択":E==="学校"?"学校を選択":E==="生年"?"生年を選択":E==="没年"?"没年を選択":"タグ値を選択"}),e.jsxs(s,{sx:{display:"flex",flexWrap:"wrap",gap:1,mt:1},children:[e.jsx(O,{label:"指定なし",onClick:()=>G(""),variant:"outlined",size:"small",sx:{mb:1}}),V[E]?.map(r=>e.jsx(O,{label:r,onClick:()=>G(r),variant:"outlined",size:"small",color:E==="国籍"&&r===re||E==="カテゴリー"&&r===K||E==="学校"&&r===oe||E==="生年"&&r===de||E==="没年"&&r===xe?"primary":"default",sx:{overflow:"hidden",textOverflow:"ellipsis",maxWidth:"100%"}},r))]})]})}),e.jsx(q,{}),e.jsxs(s,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:2},children:[e.jsxs(n,{variant:"body2",color:"text.secondary",children:[h,"人の建築家"]}),l>1&&e.jsx(He,{count:l,page:a,onChange:N,color:"primary",size:"small"})]})]}),i?e.jsx(s,{sx:{display:"flex",justifyContent:"center",py:4},children:e.jsx(Re,{})}):e.jsxs(e.Fragment,{children:[o.length===0?e.jsxs(s,{sx:{textAlign:"center",py:4},children:[e.jsx(n,{variant:"h6",children:"建築家が見つかりませんでした"}),e.jsx(n,{variant:"body2",color:"text.secondary",sx:{mt:1},children:"検索条件を変更してお試しください"})]}):e.jsx(z,{container:!0,spacing:3,children:o.map(r=>e.jsx(z,{item:!0,xs:12,sm:6,md:4,children:e.jsx(fe,{sx:{height:"100%",display:"flex",flexDirection:"column",transition:"transform 0.2s","&:hover":{transform:"scale(1.02)"}},children:e.jsx(Ue,{component:H,to:`/architects/${r.id}`,children:e.jsxs(je,{children:[e.jsx(n,{variant:"h6",component:"div",gutterBottom:!0,children:r.name}),e.jsxs(n,{variant:"body2",color:"text.secondary",gutterBottom:!0,children:[r.nationality," • ",r.birthYear||"?","-",r.deathYear||"現在"]}),e.jsx(s,{sx:{display:"flex",flexWrap:"wrap",gap:.5,mt:1},children:r.tags&&r.tags.map(y=>e.jsx(O,{label:y,size:"small",variant:"outlined",sx:{pointerEvents:"none"}},y))})]})})})},r.id))}),l>1&&e.jsx(s,{sx:{display:"flex",justifyContent:"center",mt:4},children:e.jsx(He,{count:l,page:a,onChange:N,color:"primary"})})]})]})},Ir=({architectures:o,compact:t=!1})=>!o||o.length===0?e.jsx(n,{variant:"body2",color:"text.secondary",children:"登録されている作品はありません。"}):e.jsx(z,{container:!0,spacing:t?2:3,children:o.map(i=>e.jsx(z,{item:!0,xs:12,sm:6,md:t?6:4,children:e.jsx(fe,{sx:{height:"100%",display:"flex",flexDirection:"column",transition:"transform 0.2s","&:hover":{transform:"scale(1.02)"}},children:e.jsx(Ue,{component:H,to:`/architecture/${i.id}`,sx:{flexGrow:1},children:e.jsxs(je,{children:[e.jsx(n,{gutterBottom:!0,variant:"h6",component:"h2",children:i.name}),i.completedYear>0&&e.jsxs(s,{sx:{display:"flex",alignItems:"center",mb:1},children:[e.jsx(Mt,{fontSize:"small",sx:{mr:1,color:"text.secondary"}}),e.jsxs(n,{variant:"body2",color:"text.secondary",children:[i.completedYear,"年"]})]}),(i.city||i.location)&&e.jsxs(s,{sx:{display:"flex",alignItems:"center",mb:1},children:[e.jsx(Be,{fontSize:"small",sx:{mr:1,color:"text.secondary"}}),e.jsxs(n,{variant:"body2",color:"text.secondary",children:[i.city?i.city:"",i.city&&i.location?" / ":"",i.location?i.location:""]})]}),i.tag&&e.jsx(s,{sx:{display:"flex",flexWrap:"wrap",gap:.5,mt:1},children:i.tag.split(",").filter(g=>g.trim()!==""&&!g.includes("の追加建築")).map((g,l)=>e.jsx(O,{label:g.trim(),size:"small",color:"secondary",variant:"outlined",sx:{height:"20px",fontSize:"0.65rem"}},l))})]})})})},i.id))}),vr=()=>e.jsx(s,{component:"span",sx:{display:"inline-flex",alignItems:"center",justifyContent:"center",width:24,height:24},children:e.jsx(n,{variant:"caption",component:"span",sx:{fontFamily:"serif",fontWeight:"bold",fontSize:"16px"},children:"W"})}),Rr=()=>{const{id:o}=Ct(),[t,i]=d.useState(null),[g,l]=d.useState(!0),[m,h]=d.useState(null),[x,a]=d.useState([]),b=qe();d.useEffect(()=>{o&&(async()=>{l(!0);try{const C=await Cr(parseInt(o));if(!C){h("建築家情報が見つかりませんでした。"),l(!1);return}i(C);const p=[];if(C.teacher1){const I={name:C.teacher1,id:null};try{I.id=await f(C.teacher1)}catch(k){console.error("教師情報の取得に失敗:",k)}p.push(I)}if(C.teacher2){const I={name:C.teacher2,id:null};try{I.id=await f(C.teacher2)}catch(k){console.error("教師情報の取得に失敗:",k)}p.push(I)}if(C.teacher3){const I={name:C.teacher3,id:null};try{I.id=await f(C.teacher3)}catch(k){console.error("教師情報の取得に失敗:",k)}p.push(I)}a(p)}catch(C){console.error("建築家データ取得エラー:",C),h("建築家情報の読み込み中にエラーが発生しました。")}finally{l(!1)}})()},[o]);const f=async u=>null,v=()=>{if(!t)return null;const u=[];if(t.school){let C=t.school;t.faculty&&(C+=` ${t.faculty}`),u.push(C)}return t.schoolAbroad&&u.push(t.schoolAbroad),u.length>0?u.join("、"):null},D=()=>!x||x.length===0?null:x.map((u,C)=>e.jsxs("span",{children:[C>0&&"、",u.id?e.jsx(er,{component:H,to:`/architects/${u.id}`,color:"inherit",underline:"hover",children:u.name}):u.name]},C)),Y=(u,C)=>{if(!C)return;let p="";switch(u){case"nationality":p=`nationality=${encodeURIComponent(C)}`;break;case"born":p=`birthyear_from=${encodeURIComponent(C)}&birthyear_to=${encodeURIComponent(C)}`;break;case"died":p=`deathyear=${encodeURIComponent(C)}`;break;case"category":p=`category=${encodeURIComponent(C)}`;break;default:return}b(`/architects?${p}`)},R=(u,C)=>{const p=`${u} ${C||""} 建築家`;return`https://www.google.com/search?q=${encodeURIComponent(p)}`},F=u=>`https://ja.wikipedia.org/wiki/Special:Search?search=${encodeURIComponent(u)}`;if(g)return e.jsx(ee,{maxWidth:"lg",sx:{py:4},children:e.jsx(s,{sx:{display:"flex",justifyContent:"center",py:8},children:e.jsx(Re,{})})});if(m||!t)return e.jsx(ee,{maxWidth:"lg",sx:{py:4},children:e.jsxs(le,{sx:{p:3},children:[e.jsx(n,{variant:"h5",color:"error",gutterBottom:!0,children:"エラー"}),e.jsx(n,{paragraph:!0,children:m||"建築家情報が見つかりませんでした。"}),e.jsx(W,{variant:"outlined",startIcon:e.jsx(Ye,{}),onClick:()=>b(-1),children:"戻る"})]})});const J=new Set;t.works&&t.works.forEach(u=>{u.tag&&u.tag.split(",").forEach(p=>{const I=p.trim();I&&!I.includes("の追加建築")&&J.add(I)})});const te=[];if(t.nationality&&te.push(`nationality:${t.nationality}`),t.birthYear>0){const u=Math.floor(t.birthYear/10)*10;te.push(`born:${u}s`)}return t.deathYear>0&&te.push(`died:${t.deathYear}`),t.category&&te.push(`category:${t.category}`),t.school&&te.push(`school:${t.school}`),e.jsxs(ee,{maxWidth:"lg",sx:{py:4},children:[e.jsx(W,{variant:"outlined",component:H,to:"/architects",startIcon:e.jsx(Ye,{}),sx:{mb:3},children:"建築家一覧に戻る"}),e.jsxs(le,{sx:{p:3,mb:4},children:[e.jsx(n,{variant:"h4",component:"h1",gutterBottom:!0,children:t.name||"不明"}),e.jsxs(s,{sx:{display:"flex",flexWrap:"wrap",gap:2,my:3},children:[t.nationality&&e.jsx(O,{icon:e.jsx(Pt,{}),label:`nationality:${t.nationality}`,variant:"outlined",onClick:()=>Y("nationality",t.nationality),clickable:!0}),t.birthYear>0&&e.jsx(O,{icon:e.jsx(Ut,{}),label:`born:${Math.floor(t.birthYear/10)*10}s`,variant:"outlined",onClick:()=>Y("born",Math.floor(t.birthYear/10)*10),clickable:!0}),t.deathYear>0&&e.jsx(O,{icon:e.jsx(Gt,{}),label:`died:${t.deathYear}`,variant:"outlined",onClick:()=>Y("died",t.deathYear),clickable:!0}),t.category&&e.jsx(O,{icon:e.jsx(Xe,{}),label:`category:${t.category}`,variant:"outlined",onClick:()=>Y("category",t.category),clickable:!0}),t.office&&e.jsx(O,{icon:e.jsx(Kt,{}),label:t.office,variant:"outlined"})]}),e.jsx(Ge,{sx:{my:3}}),e.jsxs(s,{sx:{mb:3,display:"flex",flexDirection:"row",gap:1},children:[t.website&&e.jsx(Ae,{title:"公式ホームページ",children:e.jsx(W,{href:t.website.startsWith("http")?t.website:`http://${t.website}`,target:"_blank",rel:"noopener noreferrer",startIcon:e.jsx(qt,{}),variant:"contained",size:"small",sx:{backgroundColor:"#4caf50",color:"#ffffff","&:hover":{backgroundColor:"#388e3c"}},children:"ホームページ"})}),e.jsx(Ae,{title:"Google検索",children:e.jsx(W,{href:R(t.name,t.nationality),target:"_blank",rel:"noopener noreferrer",startIcon:e.jsx(Me,{}),variant:"contained",size:"small",sx:{backgroundColor:"#4285F4",color:"#ffffff","&:hover":{backgroundColor:"#3367D6"}},children:"検索"})}),e.jsx(Ae,{title:"Wikipediaで検索",children:e.jsx(W,{href:F(t.name),target:"_blank",rel:"noopener noreferrer",startIcon:e.jsx(vr,{}),variant:"contained",size:"small",sx:{backgroundColor:"#333333",color:"#ffffff","&:hover":{backgroundColor:"#222222"}},children:"Wikipedia"})})]}),e.jsx(Qt,{component:le,variant:"outlined",sx:{mb:4},children:e.jsx(Jt,{children:e.jsxs(Vt,{children:[t.nationality&&e.jsxs(me,{children:[e.jsx(P,{component:"th",sx:{width:"30%",bgcolor:"rgba(0, 0, 0, 0.03)"},children:e.jsx(n,{variant:"subtitle2",children:"国籍"})}),e.jsx(P,{children:t.nationality})]}),(t.birthYear>0||t.deathYear>0)&&e.jsxs(me,{children:[e.jsx(P,{component:"th",sx:{width:"30%",bgcolor:"rgba(0, 0, 0, 0.03)"},children:e.jsx(n,{variant:"subtitle2",children:"生年 - 没年"})}),e.jsxs(P,{children:[t.birthYear>0?`${t.birthYear}年`:"不明",t.deathYear>0?` - ${t.deathYear}年`:""]})]}),t.office&&e.jsxs(me,{children:[e.jsx(P,{component:"th",sx:{width:"30%",bgcolor:"rgba(0, 0, 0, 0.03)"},children:e.jsx(n,{variant:"subtitle2",children:"事務所"})}),e.jsx(P,{children:t.office})]}),t.prefecture&&e.jsxs(me,{children:[e.jsx(P,{component:"th",sx:{width:"30%",bgcolor:"rgba(0, 0, 0, 0.03)"},children:e.jsx(n,{variant:"subtitle2",children:"拠点"})}),e.jsx(P,{children:t.prefecture})]}),t.nameEn&&e.jsxs(me,{children:[e.jsx(P,{component:"th",sx:{width:"30%",bgcolor:"rgba(0, 0, 0, 0.03)"},children:e.jsx(n,{variant:"subtitle2",children:"英語表記"})}),e.jsx(P,{children:t.nameEn})]}),(t.school||t.faculty||t.schoolAbroad)&&e.jsxs(me,{children:[e.jsx(P,{component:"th",sx:{width:"30%",bgcolor:"rgba(0, 0, 0, 0.03)"},children:e.jsx(n,{variant:"subtitle2",children:"教育背景"})}),e.jsx(P,{children:e.jsxs(s,{sx:{display:"flex",alignItems:"center"},children:[e.jsx(Xt,{sx:{mr:1,fontSize:"1rem",color:"text.secondary"}}),e.jsx(n,{variant:"body2",children:v()})]})})]}),(t.teacher1||t.teacher2||t.teacher3)&&e.jsxs(me,{children:[e.jsx(P,{component:"th",sx:{width:"30%",bgcolor:"rgba(0, 0, 0, 0.03)"},children:e.jsx(n,{variant:"subtitle2",children:"師事した建築家"})}),e.jsx(P,{children:e.jsx(s,{sx:{display:"flex",flexDirection:"column",gap:1},children:D()})})]}),t.category&&e.jsxs(me,{children:[e.jsx(P,{component:"th",sx:{width:"30%",bgcolor:"rgba(0, 0, 0, 0.03)"},children:e.jsx(n,{variant:"subtitle2",children:"カテゴリー"})}),e.jsx(P,{children:t.category})]})]})})}),J.size>0&&e.jsxs(s,{sx:{mb:4},children:[e.jsx(n,{variant:"h6",gutterBottom:!0,children:"受賞歴・選定"}),e.jsx(s,{sx:{display:"flex",flexWrap:"wrap",gap:1,mb:2},children:Array.from(J).map((u,C)=>e.jsx(O,{icon:e.jsx(bt,{}),label:String(u),onClick:()=>Y("category",u),clickable:!0,color:"secondary",variant:"outlined",size:"small"},C))})]}),t.bio&&e.jsxs(s,{sx:{mb:4},children:[e.jsx(n,{variant:"h6",gutterBottom:!0,children:"経歴"}),e.jsx(n,{variant:"body1",sx:{whiteSpace:"pre-line"},children:t.bio})]}),t.works&&t.works.length>0&&e.jsxs(e.Fragment,{children:[e.jsxs(s,{sx:{mb:4},children:[e.jsx(n,{variant:"h6",gutterBottom:!0,children:"作品マップ"}),t.works.some(u=>u.latitude&&u.longitude)?e.jsx(s,{sx:{height:"400px",width:"100%",mb:3,border:"1px solid #eee",borderRadius:"4px",overflow:"hidden"},children:e.jsx(ze,{markers:t.works.filter(u=>u.latitude&&u.longitude),zoom:5,center:[t.works[0].latitude||35.6762,t.works[0].longitude||139.6503]})}):e.jsx(n,{variant:"body2",color:"text.secondary",children:"位置情報が登録されている作品がありません。"})]}),e.jsxs(s,{sx:{mb:4},children:[e.jsx(n,{variant:"h6",gutterBottom:!0,children:"代表作品"}),e.jsx(Ir,{architectures:t.works})]})]})]})]})},Sr=()=>{const[o,t]=d.useState(!0),[i,g]=d.useState([]),[l,m]=d.useState([]),[h,x]=d.useState({yearFrom:"",yearTo:""}),[a,b]=d.useState(!1),[f,v]=d.useState(null),[D,Y]=d.useState(!1);d.useEffect(()=>{F()},[]);const R=p=>{if(!p||p.length===0)return{from:0,to:0};const I=p.filter(U=>U.completedYear>0);if(I.length===0)return{from:0,to:0};const k=I.map(U=>U.completedYear).sort((U,K)=>U-K),ne=k[0],E=k[k.length-1],ye=Math.min(100,Math.floor((E-ne)/2)),V=Math.floor(Math.random()*(k.length-Math.floor(k.length/4))),ce=k[V],re=Math.min(ce+ye,E);return{from:ce,to:re}},F=async()=>{t(!0);try{const p=await fr();if(m(p),!h.yearFrom&&!h.yearTo){const I=R(p);x({yearFrom:I.from.toString(),yearTo:I.to.toString()});const k=p.filter(ne=>ne.completedYear>=I.from&&ne.completedYear<=I.to);g(k)}else{let I=p;h.yearFrom&&(I=I.filter(k=>k.completedYear>=parseInt(h.yearFrom))),h.yearTo&&(I=I.filter(k=>k.completedYear<=parseInt(h.yearTo))),g(I)}}catch(p){console.error("Error fetching works:",p)}finally{t(!1)}},J=p=>{const{name:I,value:k}=p.target;x({...h,[I]:k})},te=()=>{t(!0);let p=l;h.yearFrom&&(p=p.filter(I=>I.completedYear>=parseInt(h.yearFrom))),h.yearTo&&(p=p.filter(I=>I.completedYear<=parseInt(h.yearTo))),g(p),t(!1)},u=()=>{x({yearFrom:"",yearTo:""}),g(l)},C=p=>{v(p),Y(!0)};return e.jsxs(ee,{maxWidth:"lg",sx:{py:4},children:[e.jsx(n,{variant:"h4",component:"h1",gutterBottom:!0,children:"建築地図"}),e.jsxs(le,{sx:{p:3,mb:4},children:[e.jsx(W,{startIcon:e.jsx(tr,{}),onClick:()=>b(!a),sx:{mb:2},children:a?"フィルターを閉じる":"フィルターを表示"}),a&&e.jsx(s,{sx:{mb:2},children:e.jsxs(z,{container:!0,spacing:2,children:[e.jsx(z,{item:!0,xs:12,sm:6,md:4,children:e.jsx(Te,{fullWidth:!0,label:"年代（から）",name:"yearFrom",type:"number",value:h.yearFrom,onChange:J})}),e.jsx(z,{item:!0,xs:12,sm:6,md:4,children:e.jsx(Te,{fullWidth:!0,label:"年代（まで）",name:"yearTo",type:"number",value:h.yearTo,onChange:J})}),e.jsx(z,{item:!0,xs:12,md:4,children:e.jsxs(s,{sx:{display:"flex",gap:1,height:"100%"},children:[e.jsx(W,{variant:"contained",color:"primary",onClick:te,sx:{flexGrow:1},children:"フィルター適用"}),e.jsx(W,{variant:"outlined",onClick:u,sx:{flexGrow:1},children:"クリア"})]})})]})}),e.jsxs(s,{sx:{display:"flex",alignItems:"center",mb:2},children:[e.jsx(ve,{sx:{mr:1}}),e.jsxs(n,{variant:"body2",color:"text.secondary",children:["マップ上に表示された作品: ",i.length,"件 ",h.yearFrom&&h.yearTo&&`(${h.yearFrom}年〜${h.yearTo}年)`]})]})]}),o?e.jsx(s,{sx:{display:"flex",justifyContent:"center",py:4},children:e.jsx(Re,{})}):e.jsxs(s,{sx:{height:600,bgcolor:"grey.200",position:"relative",borderRadius:1},children:[e.jsx(ze,{markers:i,height:"600px",zoom:5,center:[35.6762,139.6503]}),e.jsxs(s,{sx:{position:"absolute",top:16,right:16,width:320,maxHeight:568,overflow:"auto",bgcolor:"background.paper",borderRadius:1,boxShadow:3,p:2,zIndex:1e3},children:[e.jsx(n,{variant:"h6",gutterBottom:!0,children:"作品リスト"}),i.length===0?e.jsx(n,{variant:"body2",children:"条件に一致する作品はありません"}):e.jsx(ct,{dense:!0,children:i.map(p=>e.jsxs(At.Fragment,{children:[e.jsx(dt,{onClick:()=>C(p),sx:{cursor:"pointer",bgcolor:f&&f.id===p.id?"action.selected":"transparent","&:hover":{bgcolor:"action.hover"}},children:e.jsx(ht,{primary:p.name,secondary:e.jsxs(e.Fragment,{children:[p.architectName&&e.jsxs("span",{children:[p.architectName,e.jsx("br",{})]}),p.completedYear>0&&`${p.completedYear}年 | `,p.city||""]})})}),e.jsx(Ge,{component:"li"})]},p.id))})]})]}),e.jsx(lt,{anchor:"right",open:D,onClose:()=>Y(!1),children:f&&e.jsxs(s,{sx:{width:350,p:3},children:[e.jsx(n,{variant:"h5",gutterBottom:!0,children:f.name}),e.jsxs(s,{sx:{mb:3},children:[f.architectName&&e.jsx(n,{variant:"subtitle1",color:"text.secondary",children:f.architectName}),e.jsxs(n,{variant:"body2",children:[f.completedYear>0&&`${f.completedYear}年`,f.city&&` | ${f.city}`]}),f.location&&e.jsx(n,{variant:"body2",sx:{mt:1},children:f.location})]}),e.jsx(s,{sx:{mb:3,height:200},children:e.jsx(ze,{singleMarker:f,height:"200px",zoom:15,center:[f.latitude,f.longitude]})}),e.jsxs(s,{sx:{display:"flex",justifyContent:"space-between",mt:4},children:[e.jsx(W,{variant:"outlined",onClick:()=>Y(!1),children:"閉じる"}),e.jsx(W,{variant:"contained",component:H,to:`/architecture/${f.id}`,children:"詳細を見る"})]})]})})]})};class Dr extends d.Component{constructor(t){super(t),this.state={hasError:!1,error:null,errorInfo:null}}static getDerivedStateFromError(t){return{hasError:!0,error:t,errorInfo:null}}componentDidCatch(t,i){console.error("Uncaught error:",t,i),this.setState({error:t,errorInfo:i})}handleRetry=()=>{window.location.reload()};render(){return this.state.hasError?this.props.fallback?this.props.fallback:e.jsx(s,{sx:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",padding:4,height:"100vh"},children:e.jsxs(le,{elevation:3,sx:{padding:4,maxWidth:600,width:"100%",borderRadius:2,textAlign:"center"},children:[e.jsx(n,{variant:"h5",color:"error",gutterBottom:!0,children:"問題が発生しました"}),e.jsx(n,{variant:"body1",paragraph:!0,children:"アプリケーションで予期しないエラーが発生しました。 お手数ですが、再読み込みをお試しください。"}),!1,e.jsxs(s,{sx:{mt:3},children:[e.jsx(W,{variant:"contained",color:"primary",onClick:this.handleRetry,sx:{mr:2},children:"ページを再読み込み"}),e.jsx(W,{variant:"outlined",onClick:()=>window.location.href="/",children:"ホームに戻る"})]})]})}):this.props.children}}const wr=()=>{try{const o=window?.location?.hostname||"";return/github\.io$/.test(o)}catch(o){return console.error("環境チェックエラー:",o),!1}},Wr=async()=>{try{const t=wr();console.log("アプリケーション環境: 本番"),console.log(`GitHub Pages環境: ${t?"はい":"いいえ"}`);try{const g=await fetch(t?"./db/database-info.json":"/db/database-info.json");if(g.ok){const l=await g.json();console.log("データベース情報:"),console.log(`- ファイル: ${l.database}`),console.log(`- 更新日時: ${l.date}`),console.log(`- サイズ: ${(l.size/1024/1024).toFixed(2)} MB`),console.log(`- チャンク: ${l.chunks} (${l.chunkSize/1024}KB)のチャンク`),console.log(`- テーブル数: ${l.tables.length}`),console.log(`- インデックス数: ${l.indexes.length}`)}else console.warn("データベースメタデータが見つかりません:",g.status)}catch(i){console.warn("データベースメタデータ読み込みエラー:",i)}}catch(o){console.error("データベース設定ログエラー:",o)}},kr=({children:o})=>{const[t,i]=d.useState(gr()),[g,l]=d.useState(null),[m,h]=d.useState(0);return d.useEffect(()=>{let x=!0,a;return(async()=>{if(t!==ge.READY){a=setInterval(()=>{x&&h(f=>{const v=(95-f)*.1;return Math.min(f+v,95)})},300);try{await vt(),x&&(h(100),i(ge.READY))}catch(f){x&&(l(`データベースの初期化に失敗しました: ${f instanceof Error?f.message:"不明なエラー"}`),i(ge.ERROR))}finally{clearInterval(a)}}})(),()=>{x=!1,clearInterval(a)}},[t]),t!==ge.READY?e.jsx(s,{display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",height:"100vh",bgcolor:"#f5f5f5",children:e.jsxs(s,{textAlign:"center",maxWidth:"600px",p:3,children:[e.jsx(n,{variant:"h4",gutterBottom:!0,children:"日本の建築マップ"}),t===ge.ERROR?e.jsx(Pe,{severity:"error",sx:{mt:3,mb:3},children:g||"データベースの読み込み中にエラーが発生しました。再読み込みしてください。"}):e.jsxs(e.Fragment,{children:[e.jsx(n,{variant:"body1",sx:{mb:3},children:"データベースを読み込んでいます。しばらくお待ちください..."}),e.jsx(Re,{variant:"determinate",value:m,size:60,thickness:4}),e.jsxs(n,{variant:"body2",color:"text.secondary",sx:{mt:2},children:[m.toFixed(0),"% 完了"]})]}),t===ge.ERROR&&e.jsx(s,{mt:3,children:e.jsx("button",{onClick:()=>{l(null),i(ge.NOT_INITIALIZED)},style:{padding:"8px 16px",fontSize:"1rem",cursor:"pointer"},children:"再試行"})})]})}):e.jsx(e.Fragment,{children:o})},tt={primary:{main:"#2E3440",light:"#4C566A",dark:"#1B1F2B",contrastText:"#FFFFFF"},secondary:{main:"#88C0D0",light:"#B3D4E0",dark:"#5E81AC",contrastText:"#2E3440"},accent:{main:"#D08770",light:"#E5A088",dark:"#BF616A"},background:{default:"#ECEFF4",paper:"#FFFFFF",elevated:"#F8F9FA"},text:{primary:"#2E3440",secondary:"#4C566A",disabled:"#D8DEE9"},divider:"#E5E9F0",success:{main:"#A3BE8C",light:"#B8CCA3",dark:"#8CAF69"},warning:{main:"#EBCB8B",light:"#F0D5A3",dark:"#D4B571"},error:{main:"#BF616A",light:"#CC8088",dark:"#A54A56"},info:{main:"#88C0D0",light:"#B3D4E0",dark:"#5E81AC"}},_r={fontFamily:'"Inter", "Roboto", "Helvetica Neue", "Arial", sans-serif',h1:{fontSize:"3rem",fontWeight:700,lineHeight:1.2,letterSpacing:"-0.02em"},h2:{fontSize:"2.25rem",fontWeight:600,lineHeight:1.3,letterSpacing:"-0.01em"},h3:{fontSize:"1.875rem",fontWeight:600,lineHeight:1.3,letterSpacing:"-0.01em"},h4:{fontSize:"1.5rem",fontWeight:600,lineHeight:1.4},h5:{fontSize:"1.25rem",fontWeight:600,lineHeight:1.4},h6:{fontSize:"1.125rem",fontWeight:600,lineHeight:1.4},subtitle1:{fontSize:"1rem",fontWeight:500,lineHeight:1.5},subtitle2:{fontSize:"0.875rem",fontWeight:500,lineHeight:1.5},body1:{fontSize:"1rem",fontWeight:400,lineHeight:1.6},body2:{fontSize:"0.875rem",fontWeight:400,lineHeight:1.6},caption:{fontSize:"0.75rem",fontWeight:400,lineHeight:1.5},button:{fontSize:"0.875rem",fontWeight:600,textTransform:"none",letterSpacing:"0.02em"}},$r={MuiButton:{styleOverrides:{root:{borderRadius:8,padding:"10px 24px",transition:"all 0.2s ease-in-out","&:hover":{transform:"translateY(-1px)",boxShadow:"0 4px 12px rgba(0, 0, 0, 0.15)"}},contained:{boxShadow:"0 2px 8px rgba(0, 0, 0, 0.1)"}}},MuiCard:{styleOverrides:{root:{borderRadius:12,boxShadow:"0 2px 12px rgba(0, 0, 0, 0.08)",transition:"all 0.3s ease-in-out","&:hover":{transform:"translateY(-2px)",boxShadow:"0 8px 24px rgba(0, 0, 0, 0.15)"}}}},MuiTextField:{styleOverrides:{root:{"& .MuiOutlinedInput-root":{borderRadius:8,transition:"all 0.2s ease-in-out","&:hover":{"& .MuiOutlinedInput-notchedOutline":{borderColor:tt.secondary.main}},"&.Mui-focused":{"& .MuiOutlinedInput-notchedOutline":{borderColor:tt.primary.main,borderWidth:2}}}}}},MuiAppBar:{styleOverrides:{root:{boxShadow:"0 2px 12px rgba(0, 0, 0, 0.1)",backdropFilter:"blur(10px)",backgroundColor:"rgba(46, 52, 64, 0.95)"}}},MuiChip:{styleOverrides:{root:{borderRadius:8,fontWeight:500}}},MuiPaper:{styleOverrides:{root:{borderRadius:12,boxShadow:"0 2px 12px rgba(0, 0, 0, 0.08)"},elevation1:{boxShadow:"0 2px 8px rgba(0, 0, 0, 0.06)"},elevation2:{boxShadow:"0 4px 12px rgba(0, 0, 0, 0.1)"},elevation3:{boxShadow:"0 8px 24px rgba(0, 0, 0, 0.15)"}}}},Yr=rr({palette:tt,typography:_r,components:$r,spacing:8,shape:{borderRadius:8},breakpoints:{values:{xs:0,sm:600,md:960,lg:1280,xl:1920}},transitions:{easing:{easeInOut:"cubic-bezier(0.4, 0, 0.2, 1)",easeOut:"cubic-bezier(0.0, 0, 0.2, 1)",easeIn:"cubic-bezier(0.4, 0, 1, 1)",sharp:"cubic-bezier(0.4, 0, 0.6, 1)"}}}),Nr=()=>{const{pathname:o}=Ke();return d.useEffect(()=>{window.scrollTo(0,0)},[o]),null},Fr=()=>(d.useEffect(()=>{console.log("App running in production mode"),Wr()},[]),e.jsxs(e.Fragment,{children:[e.jsx(Nr,{}),e.jsx(dr,{}),e.jsx("main",{className:"container",children:e.jsxs(or,{children:[e.jsx(Ie,{path:"/",element:e.jsx(jr,{})}),e.jsx(Ie,{path:"/architecture",element:e.jsx(yr,{})}),e.jsx(Ie,{path:"/architecture/:id",element:e.jsx(br,{})}),e.jsx(Ie,{path:"/architects",element:e.jsx(Er,{})}),e.jsx(Ie,{path:"/architects/:id",element:e.jsx(Rr,{})}),e.jsx(Ie,{path:"/map",element:e.jsx(Sr,{})})]})}),e.jsx(hr,{})]})),Or=()=>e.jsx(Dr,{children:e.jsxs(sr,{theme:Yr,children:[e.jsx(nr,{}),e.jsx(kr,{children:e.jsx(Tt,{children:e.jsx(Fr,{})})})]})});console.log("React アプリケーションを初期化中...","production");console.log("DOM root element:",document.getElementById("root"));const wt=document.getElementById("root");if(!wt)throw console.error('root要素が見つかりません。HTMLに<div id="root"></div>が存在するか確認してください。'),new Error("Failed to find the root element");const Zr=It(wt);console.log("Using HashRouter for GitHub Pages compatibility");try{Zr.render(e.jsx(At.StrictMode,{children:e.jsx(Tt,{children:e.jsx(Or,{})})})),console.log("React アプリケーションのレンダリングが成功しました")}catch(o){console.error("React アプリケーションのレンダリング中にエラーが発生しました:",o)}
//# sourceMappingURL=index-B8mgWYi8.js.map
