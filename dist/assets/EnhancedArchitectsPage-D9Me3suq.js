import{br as at,bs as ze,bt as ct,bu as _e,u as oe,g as ee,j as e,t as je,G as Q,B as j,w as X,v as ue,W as Ze,x as ne,i as M,E as q,b as ge,bn as Ce,O as $e,bv as lt,I as Se,U as Qe,_ as dt,Y as ut,a0 as ht,Q as Oe,T as mt,aO as ft,n as we,o as N,d as xe,e as H,aP as pt,bw as gt,be as xt,ar as yt,as as St,at as vt,au as At,bd as wt,bx as It,bh as bt,V as jt,y as ye,N as Ct,ag as Tt,ak as Rt,by as Et,ay as Mt,az as zt,ai as _t,aA as Ot}from"./ui-dmFglhLv.js";import{r as l,L as Ye,f as Dt,u as Lt}from"./vendor-hK-MsNnn.js";import{g as De,s as kt,F as Pt}from"./index-BBFjSBii.js";import"./map-BtvNs8GB.js";import"./database-CPgyCjHm.js";var Le=Number.isNaN||function(t){return typeof t=="number"&&t!==t};function Bt(s,t){return!!(s===t||Le(s)&&Le(t))}function Ft(s,t){if(s.length!==t.length)return!1;for(var r=0;r<s.length;r++)if(!Bt(s[r],t[r]))return!1;return!0}function Ie(s,t){t===void 0&&(t=Ft);var r,n=[],a,i=!1;function d(){for(var c=[],h=0;h<arguments.length;h++)c[h]=arguments[h];return i&&r===this&&t(c,n)||(a=s.apply(this,c),i=!0,r=this,n=c),a}return d}var Nt=typeof performance=="object"&&typeof performance.now=="function",ke=Nt?function(){return performance.now()}:function(){return Date.now()};function Pe(s){cancelAnimationFrame(s.id)}function Ht(s,t){var r=ke();function n(){ke()-r>=t?s.call(null):a.id=requestAnimationFrame(n)}var a={id:requestAnimationFrame(n)};return a}var be=-1;function Be(s){if(s===void 0&&(s=!1),be===-1||s){var t=document.createElement("div"),r=t.style;r.width="50px",r.height="50px",r.overflow="scroll",document.body.appendChild(t),be=t.offsetWidth-t.clientWidth,document.body.removeChild(t)}return be}var re=null;function Fe(s){if(s===void 0&&(s=!1),re===null||s){var t=document.createElement("div"),r=t.style;r.width="50px",r.height="50px",r.overflow="scroll",r.direction="rtl";var n=document.createElement("div"),a=n.style;return a.width="100px",a.height="100px",t.appendChild(n),document.body.appendChild(t),t.scrollLeft>0?re="positive-descending":(t.scrollLeft=1,t.scrollLeft===0?re="negative":re="positive-ascending"),document.body.removeChild(t),re}return re}var Wt=150,Zt=function(t,r){return t};function $t(s){var t,r=s.getItemOffset,n=s.getEstimatedTotalSize,a=s.getItemSize,i=s.getOffsetForIndexAndAlignment,d=s.getStartIndexForOffset,c=s.getStopIndexForStartIndex,h=s.initInstanceProps,x=s.shouldResetStyleCacheOnItemSizeChange,I=s.validateProps;return t=function(T){at(f,T);function f(b){var o;return o=T.call(this,b)||this,o._instanceProps=h(o.props,ze(o)),o._outerRef=void 0,o._resetIsScrollingTimeoutId=null,o.state={instance:ze(o),isScrolling:!1,scrollDirection:"forward",scrollOffset:typeof o.props.initialScrollOffset=="number"?o.props.initialScrollOffset:0,scrollUpdateWasRequested:!1},o._callOnItemsRendered=void 0,o._callOnItemsRendered=Ie(function(u,m,g,A){return o.props.onItemsRendered({overscanStartIndex:u,overscanStopIndex:m,visibleStartIndex:g,visibleStopIndex:A})}),o._callOnScroll=void 0,o._callOnScroll=Ie(function(u,m,g){return o.props.onScroll({scrollDirection:u,scrollOffset:m,scrollUpdateWasRequested:g})}),o._getItemStyle=void 0,o._getItemStyle=function(u){var m=o.props,g=m.direction,A=m.itemSize,R=m.layout,y=o._getItemStyleCache(x&&A,x&&R,x&&g),S;if(y.hasOwnProperty(u))S=y[u];else{var C=r(o.props,u,o._instanceProps),O=a(o.props,u,o._instanceProps),k=g==="horizontal"||R==="horizontal",F=g==="rtl",K=k?C:0;y[u]=S={position:"absolute",left:F?void 0:K,right:F?K:void 0,top:k?0:C,height:k?"100%":O,width:k?O:"100%"}}return S},o._getItemStyleCache=void 0,o._getItemStyleCache=Ie(function(u,m,g){return{}}),o._onScrollHorizontal=function(u){var m=u.currentTarget,g=m.clientWidth,A=m.scrollLeft,R=m.scrollWidth;o.setState(function(y){if(y.scrollOffset===A)return null;var S=o.props.direction,C=A;if(S==="rtl")switch(Fe()){case"negative":C=-A;break;case"positive-descending":C=R-g-A;break}return C=Math.max(0,Math.min(C,R-g)),{isScrolling:!0,scrollDirection:y.scrollOffset<C?"forward":"backward",scrollOffset:C,scrollUpdateWasRequested:!1}},o._resetIsScrollingDebounced)},o._onScrollVertical=function(u){var m=u.currentTarget,g=m.clientHeight,A=m.scrollHeight,R=m.scrollTop;o.setState(function(y){if(y.scrollOffset===R)return null;var S=Math.max(0,Math.min(R,A-g));return{isScrolling:!0,scrollDirection:y.scrollOffset<S?"forward":"backward",scrollOffset:S,scrollUpdateWasRequested:!1}},o._resetIsScrollingDebounced)},o._outerRefSetter=function(u){var m=o.props.outerRef;o._outerRef=u,typeof m=="function"?m(u):m!=null&&typeof m=="object"&&m.hasOwnProperty("current")&&(m.current=u)},o._resetIsScrollingDebounced=function(){o._resetIsScrollingTimeoutId!==null&&Pe(o._resetIsScrollingTimeoutId),o._resetIsScrollingTimeoutId=Ht(o._resetIsScrolling,Wt)},o._resetIsScrolling=function(){o._resetIsScrollingTimeoutId=null,o.setState({isScrolling:!1},function(){o._getItemStyleCache(-1,null)})},o}f.getDerivedStateFromProps=function(o,u){return Qt(o,u),I(o),null};var v=f.prototype;return v.scrollTo=function(o){o=Math.max(0,o),this.setState(function(u){return u.scrollOffset===o?null:{scrollDirection:u.scrollOffset<o?"forward":"backward",scrollOffset:o,scrollUpdateWasRequested:!0}},this._resetIsScrollingDebounced)},v.scrollToItem=function(o,u){u===void 0&&(u="auto");var m=this.props,g=m.itemCount,A=m.layout,R=this.state.scrollOffset;o=Math.max(0,Math.min(o,g-1));var y=0;if(this._outerRef){var S=this._outerRef;A==="vertical"?y=S.scrollWidth>S.clientWidth?Be():0:y=S.scrollHeight>S.clientHeight?Be():0}this.scrollTo(i(this.props,o,u,R,this._instanceProps,y))},v.componentDidMount=function(){var o=this.props,u=o.direction,m=o.initialScrollOffset,g=o.layout;if(typeof m=="number"&&this._outerRef!=null){var A=this._outerRef;u==="horizontal"||g==="horizontal"?A.scrollLeft=m:A.scrollTop=m}this._callPropsCallbacks()},v.componentDidUpdate=function(){var o=this.props,u=o.direction,m=o.layout,g=this.state,A=g.scrollOffset,R=g.scrollUpdateWasRequested;if(R&&this._outerRef!=null){var y=this._outerRef;if(u==="horizontal"||m==="horizontal")if(u==="rtl")switch(Fe()){case"negative":y.scrollLeft=-A;break;case"positive-ascending":y.scrollLeft=A;break;default:var S=y.clientWidth,C=y.scrollWidth;y.scrollLeft=C-S-A;break}else y.scrollLeft=A;else y.scrollTop=A}this._callPropsCallbacks()},v.componentWillUnmount=function(){this._resetIsScrollingTimeoutId!==null&&Pe(this._resetIsScrollingTimeoutId)},v.render=function(){var o=this.props,u=o.children,m=o.className,g=o.direction,A=o.height,R=o.innerRef,y=o.innerElementType,S=o.innerTagName,C=o.itemCount,O=o.itemData,k=o.itemKey,F=k===void 0?Zt:k,K=o.layout,te=o.outerElementType,ie=o.outerTagName,V=o.style,p=o.useIsScrolling,w=o.width,z=this.state.isScrolling,E=g==="horizontal"||K==="horizontal",W=E?this._onScrollHorizontal:this._onScrollVertical,$=this._getRangeToRender(),D=$[0],Y=$[1],U=[];if(C>0)for(var P=D;P<=Y;P++)U.push(l.createElement(u,{data:O,key:F(P,O),index:P,isScrolling:p?z:void 0,style:this._getItemStyle(P)}));var G=n(this.props,this._instanceProps);return l.createElement(te||ie||"div",{className:m,onScroll:W,ref:this._outerRefSetter,style:ct({position:"relative",height:A,width:w,overflow:"auto",WebkitOverflowScrolling:"touch",willChange:"transform",direction:g},V)},l.createElement(y||S||"div",{children:U,ref:R,style:{height:E?"100%":G,pointerEvents:z?"none":void 0,width:E?G:"100%"}}))},v._callPropsCallbacks=function(){if(typeof this.props.onItemsRendered=="function"){var o=this.props.itemCount;if(o>0){var u=this._getRangeToRender(),m=u[0],g=u[1],A=u[2],R=u[3];this._callOnItemsRendered(m,g,A,R)}}if(typeof this.props.onScroll=="function"){var y=this.state,S=y.scrollDirection,C=y.scrollOffset,O=y.scrollUpdateWasRequested;this._callOnScroll(S,C,O)}},v._getRangeToRender=function(){var o=this.props,u=o.itemCount,m=o.overscanCount,g=this.state,A=g.isScrolling,R=g.scrollDirection,y=g.scrollOffset;if(u===0)return[0,0,0,0];var S=d(this.props,y,this._instanceProps),C=c(this.props,S,y,this._instanceProps),O=!A||R==="backward"?Math.max(1,m):1,k=!A||R==="forward"?Math.max(1,m):1;return[Math.max(0,S-O),Math.max(0,Math.min(u-1,C+k)),S,C]},f}(l.PureComponent),t.defaultProps={direction:"ltr",itemData:void 0,layout:"vertical",overscanCount:2,useIsScrolling:!1},t}var Qt=function(t,r){t.children,t.direction,t.height,t.layout,t.innerTagName,t.outerTagName,t.width,r.instance},Yt=$t({getItemOffset:function(t,r){var n=t.itemSize;return r*n},getItemSize:function(t,r){var n=t.itemSize;return n},getEstimatedTotalSize:function(t){var r=t.itemCount,n=t.itemSize;return n*r},getOffsetForIndexAndAlignment:function(t,r,n,a,i,d){var c=t.direction,h=t.height,x=t.itemCount,I=t.itemSize,T=t.layout,f=t.width,v=c==="horizontal"||T==="horizontal",b=v?f:h,o=Math.max(0,x*I-b),u=Math.min(o,r*I),m=Math.max(0,r*I-b+I+d);switch(n==="smart"&&(a>=m-b&&a<=u+b?n="auto":n="center"),n){case"start":return u;case"end":return m;case"center":{var g=Math.round(m+(u-m)/2);return g<Math.ceil(b/2)?0:g>o+Math.floor(b/2)?o:g}case"auto":default:return a>=m&&a<=u?a:a<m?m:u}},getStartIndexForOffset:function(t,r){var n=t.itemCount,a=t.itemSize;return Math.max(0,Math.min(n-1,Math.floor(r/a)))},getStopIndexForStartIndex:function(t,r,n){var a=t.direction,i=t.height,d=t.itemCount,c=t.itemSize,h=t.layout,x=t.width,I=a==="horizontal"||h==="horizontal",T=r*c,f=I?x:i,v=Math.ceil((f+n-T)/c);return Math.max(0,Math.min(d-1,r+v-1))},initInstanceProps:function(t){},shouldResetStyleCacheOnItemSizeChange:!0,validateProps:function(t){t.itemSize}});function Ne(s,t){for(var r in s)if(!(r in t))return!0;for(var n in t)if(s[n]!==t[n])return!0;return!1}var qt=["style"],Kt=["style"];function qe(s,t){var r=s.style,n=_e(s,qt),a=t.style,i=_e(t,Kt);return!Ne(r,a)&&!Ne(n,i)}const Ke=l.memo(({architect:s,style:t,onItemClick:r})=>{const n=oe(),a=ee(n.breakpoints.down("md")),i=l.useCallback(()=>{r?.(s)},[s,r]),d=l.useMemo(()=>{const h=s.ZAT_BIRTHYEAR||"?",x=s.ZAT_DEATHYEAR||"現在";return`${h}-${x}`},[s.ZAT_BIRTHYEAR,s.ZAT_DEATHYEAR]),c=l.useMemo(()=>{const h=[];return s.ZAT_NATIONALITY&&h.push(s.ZAT_NATIONALITY),s.ZAT_CATEGORY&&h.push(s.ZAT_CATEGORY),h.slice(0,3)},[s.ZAT_NATIONALITY,s.ZAT_CATEGORY]);return e.jsx("div",{style:t,children:e.jsx(j,{sx:{p:1},children:e.jsx(X,{sx:{height:a?140:160,display:"flex",flexDirection:"column",transition:"all 0.2s cubic-bezier(0.4, 0, 0.2, 1)",willChange:"transform, box-shadow","&:hover":{transform:"translateY(-2px)",boxShadow:n.shadows[8]}},elevation:2,children:e.jsx(Ze,{component:Ye,to:`/architects/${s.ZAT_ID||s.Z_PK}`,onClick:i,sx:{height:"100%",display:"flex",flexDirection:"column",alignItems:"stretch"},children:e.jsxs(ne,{sx:{flexGrow:1,p:a?1.5:2},children:[e.jsx(M,{variant:a?"subtitle1":"h6",component:"div",gutterBottom:!0,sx:{fontWeight:600,lineHeight:1.2,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:s.ZAT_ARCHITECT}),e.jsxs(M,{variant:"body2",color:"text.secondary",gutterBottom:!0,sx:{fontSize:a?"0.75rem":"0.875rem",lineHeight:1.3},children:[s.ZAT_NATIONALITY||"不明"," • ",d]}),c.length>0&&e.jsx(j,{sx:{display:"flex",flexWrap:"wrap",gap:.5,mt:1,minHeight:24},children:c.map((h,x)=>e.jsx(q,{label:h,size:"small",variant:"outlined",sx:{fontSize:"0.75rem",height:20,maxWidth:120,"& .MuiChip-label":{px:1,overflow:"hidden",textOverflow:"ellipsis"}}},`${h}-${x}`))})]})})})})})},qe);Ke.displayName="ArchitectCard";const Te=l.memo(({style:s})=>{const t=oe(),r=ee(t.breakpoints.down("md"));return e.jsx("div",{style:s,children:e.jsx(j,{sx:{p:1},children:e.jsxs(X,{sx:{height:r?140:160,p:r?1.5:2},children:[e.jsx(ue,{variant:"text",width:"80%",height:24}),e.jsx(ue,{variant:"text",width:"60%",height:20,sx:{mt:1}}),e.jsxs(j,{sx:{display:"flex",gap:.5,mt:1},children:[e.jsx(ue,{variant:"rounded",width:60,height:20}),e.jsx(ue,{variant:"rounded",width:80,height:20})]})]})})})});Te.displayName="ArchitectSkeleton";const Ue=l.memo(({index:s,style:t,data:r})=>{const{architects:n,columnsPerRow:a,onItemClick:i,loading:d,loadingCount:c}=r,h=s*a,x=l.useMemo(()=>{const I=[];for(let T=0;T<a;T++){const f=h+T;if(d&&f<c)I.push(e.jsx(Q,{item:!0,xs:12/a,children:e.jsx(Te,{style:{}})},`skeleton-${f}`));else if(f<n.length){const v=n[f];I.push(e.jsx(Q,{item:!0,xs:12/a,children:e.jsx(Ke,{architect:v,style:{},onItemClick:i})},v.ZAT_ID||v.Z_PK||f))}}return I},[n,a,h,i,d,c]);return e.jsx("div",{style:t,children:e.jsx(Q,{container:!0,spacing:0,children:x})})},qe);Ue.displayName="GridRow";const Ut=({architects:s,height:t,width:r,onItemClick:n,loading:a=!1,loadingCount:i=10})=>{const d=oe(),c=ee(d.breakpoints.down("md")),h=ee(d.breakpoints.down("lg")),x=l.useRef(null),I=l.useMemo(()=>c?1:h?2:3,[c,h]),T=l.useMemo(()=>c?150:170,[c]),f=l.useMemo(()=>{const o=a?i:s.length;return Math.ceil(o/I)},[s.length,I,a,i]),v=l.useMemo(()=>({architects:s,columnsPerRow:I,onItemClick:n,loading:a,loadingCount:i}),[s,I,n,a,i]),b=l.useMemo(()=>Math.max(2,Math.ceil(t/T/4)),[t,T]);return l.useEffect(()=>{x.current&&!a&&x.current.scrollToItem(0,"start")},[s,a]),a&&i===0?e.jsx(je,{maxWidth:"lg",children:e.jsx(Q,{container:!0,spacing:2,children:Array.from({length:6}).map((o,u)=>e.jsx(Q,{item:!0,xs:12,sm:6,md:4,children:e.jsx(Te,{style:{}})},u))})}):e.jsx(Yt,{ref:x,height:t,width:r||"100%",itemCount:f,itemSize:T,itemData:v,overscanCount:b,style:{outline:"none"},children:Ue})},Gt=l.memo(Ut),Vt=Ce(j)(({theme:s,borderRadius:t})=>({position:"relative",overflow:"hidden",borderRadius:t||0,"&:hover .image-controls":{opacity:1},"& img":{transition:"all 0.4s cubic-bezier(0.4, 0, 0.2, 1)"}})),He=Ce(j)(({blurDataUrl:s})=>({position:"absolute",top:0,left:0,width:"100%",height:"100%",backgroundImage:s?`url(${s})`:"none",backgroundSize:"cover",backgroundPosition:"center",filter:"blur(10px)",transform:"scale(1.1)",transition:"opacity 0.4s ease-out",zIndex:1})),Jt=Ce("img")(({isLoaded:s})=>({position:"relative",zIndex:2,opacity:s?1:0,transition:"opacity 0.4s ease-out",width:"100%",height:"100%"})),Xt=()=>{const s=document.createElement("canvas");return s.width=1,s.height=1,{webp:s.toDataURL("image/webp").indexOf("webp")>-1,avif:s.toDataURL("image/avif").indexOf("avif")>-1}},es=()=>{const s=navigator.connection||navigator.mozConnection||navigator.webkitConnection;if(!s)return"medium";const t=s.effectiveType,r=s.downlink||1;return t==="slow-2g"||t==="2g"||r<.5?"slow":t==="3g"||r<1.5?"medium":"fast"},de=(s,t,r,n,a)=>{const i=new URLSearchParams,d={low:30,medium:60,high:85};if(i.append("q",d[t].toString()),n)i.append("w",n.toString());else{const c=a?t==="low"?400:t==="medium"?800:1200:t==="low"?800:t==="medium"?1200:1920;i.append("w",c.toString())}return r!=="jpeg"&&i.append("f",r),s},ts=({src:s,alt:t,width:r="100%",height:n="auto",className:a,lowQualitySrc:i,blurDataUrl:d,loading:c="lazy",priority:h=!1,onLoad:x,onError:I,style:T,objectFit:f="cover",borderRadius:v=0,enableZoom:b=!1,enableFullscreen:o=!1,retryOnError:u=!0,maxRetries:m=3,lazyLoadOffset:g=100,enablePerformanceMonitoring:A=!0,optimizeForMobile:R=!0,sizes:y="(max-width: 768px) 100vw, (max-width: 1200px) 50vw, 33vw"})=>{const S=oe(),C=ee(S.breakpoints.down("md")),O=ee(S.breakpoints.between("md","lg")),[k,F]=l.useState("loading"),[K,te]=l.useState(""),[ie,V]=l.useState(!1),[p,w]=l.useState(!1),[z,E]=l.useState(h||c==="eager"),[W,$]=l.useState(0),[D,Y]=l.useState(!1),[U,P]=l.useState(!1),[G,ve]=l.useState({}),se=l.useRef(null),Ge=l.useRef(null),Ve=l.useRef(null),ae=l.useMemo(()=>Xt(),[]),ce=l.useMemo(()=>es(),[]),me=l.useMemo(()=>{const _=ae.avif?"avif":ae.webp?"webp":"jpeg",B=C?800:O?1200:1920;return{low:i||de(s,"low",_,void 0,C),medium:de(s,"medium",_,B,C),high:de(s,"high",_,B,C),fallback:de(s,"high","jpeg",B,C)}},[s,i,ae,C,O]),Ae=l.useCallback(()=>{const _=[320,480,768,1024,1200,1920],B=ae.webp?"webp":"jpeg";return _.map(le=>`${de(s,"high",B,le)} ${le}w`).join(", ")},[s,ae]);l.useEffect(()=>{if(c==="eager"||h){E(!0);return}const _=new IntersectionObserver(B=>{const[le]=B;le.isIntersecting&&(E(!0),_.disconnect())},{rootMargin:`${g}px`,threshold:.1});return se.current&&_.observe(se.current),Ve.current=_,()=>{_.disconnect()}},[c,h,g]),l.useEffect(()=>{if(!z)return;const _=Date.now();ve({startTime:_,connectionType:ce,imageSize:C?"mobile":O?"tablet":"desktop"});const B=(Z,Ee=!1)=>new Promise((nt,ot)=>{const J=new Image;J.loading=c,J.decoding="async",J.onload=()=>{const fe=Date.now();if(Ee)V(!0),te(Z),ve(pe=>({...pe,lowQualityLoadTime:fe-_}));else{w(!0),te(Z),F("loaded");const pe=fe-_,it=ie?Math.max(0,100-(fe-(G.lowQualityLoadTime||0))/pe*100):0,Me={startTime:_,lowQualityLoadTime:G.lowQualityLoadTime,highQualityLoadTime:fe-_,totalLoadTime:pe,perceivedImprovement:it,connectionType:ce,imageSize:C?"mobile":O?"tablet":"desktop"};ve(Me),x?.(Me)}nt()},J.onerror=()=>{ot(new Error(`Failed to load image: ${Z}`))},Ee||(J.srcset=Ae(),J.sizes=y),J.src=Z});(async()=>{try{if(F("loading"),ce==="slow"||R&&C)try{await B(me.low,!0),await new Promise(Z=>setTimeout(Z,100))}catch(Z){console.warn("Low quality image load failed:",Z)}try{await B(me.high)}catch{await B(me.fallback)}}catch(Z){console.error("Progressive image loading failed:",Z),Je()}})()},[z,me,ce,C,O,R,Ae,y,x,c]);const Je=l.useCallback(()=>{if(u&&W<m){$(B=>B+1);const _=Math.min(1e3*Math.pow(2,W),1e4);setTimeout(()=>{F("loading"),V(!1),w(!1),E(!1),setTimeout(()=>E(!0),100)},_)}else F("error"),I?.()},[u,W,m,I]),Re=l.useCallback(()=>{Y(!D)},[D]),Xe=l.useCallback(()=>{!U&&se.current?se.current.requestFullscreen&&(se.current.requestFullscreen(),P(!0)):document.exitFullscreen&&(document.exitFullscreen(),P(!1))},[U]),et=l.useCallback(()=>{$(0),F("loading"),V(!1),w(!1),E(!1),setTimeout(()=>E(!0),100)},[]),tt=()=>e.jsxs(j,{sx:{position:"relative",width:r,height:n,display:"flex",alignItems:"center",justifyContent:"center",backgroundColor:ge(S.palette.grey[300],.3),borderRadius:v,overflow:"hidden"},children:[d&&e.jsx(He,{blurDataUrl:d}),e.jsx(ue,{variant:"rectangular",width:"100%",height:"100%",sx:{borderRadius:v,position:"relative",zIndex:d?3:1,opacity:d?.6:1},animation:"wave"}),ce==="slow"&&e.jsxs(j,{sx:{position:"absolute",display:"flex",flexDirection:"column",alignItems:"center",gap:1,zIndex:4,backgroundColor:ge(S.palette.background.paper,.8),padding:2,borderRadius:1,backdropFilter:"blur(4px)"},children:[e.jsx($e,{size:24,thickness:4}),e.jsx(M,{variant:"caption",color:"text.secondary",children:"画像を最適化中..."})]})]}),st=()=>e.jsxs(j,{sx:{width:r,height:n,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",backgroundColor:ge(S.palette.error.main,.1),borderRadius:v,border:`1px dashed ${S.palette.error.main}`,gap:1,p:2},children:[e.jsx(lt,{color:"error"}),e.jsx(M,{variant:"caption",color:"error",align:"center",children:"画像を読み込めませんでした"}),u&&W<m&&e.jsx(Se,{size:"small",onClick:et,color:"error",children:e.jsx(Qe,{})})]}),rt=()=>e.jsxs(Vt,{borderRadius:v,sx:{width:r,height:n,cursor:b?"zoom-in":"default",transform:D?"scale(1.05)":"scale(1)",transition:"transform 0.3s cubic-bezier(0.4, 0, 0.2, 1)"},children:[d&&e.jsx(He,{blurDataUrl:d,sx:{opacity:p?0:1}}),e.jsx(Jt,{ref:Ge,src:K,srcSet:Ae(),sizes:y,alt:t,className:a,isLoaded:p,style:{objectFit:f,transform:D?"scale(1.1)":"scale(1)",...T},onClick:b?Re:void 0,loading:c,decoding:"async"}),(b||o)&&p&&e.jsxs(j,{className:"image-controls",sx:{position:"absolute",top:S.spacing(1),right:S.spacing(1),display:"flex",gap:.5,opacity:0,transition:"opacity 0.2s ease-in-out",backgroundColor:ge(S.palette.background.paper,.9),borderRadius:1,backdropFilter:"blur(8px)"},children:[b&&e.jsx(Se,{size:"small",onClick:Re,sx:{minWidth:"32px",minHeight:"32px"},children:D?e.jsx(dt,{}):e.jsx(ut,{})}),o&&e.jsx(Se,{size:"small",onClick:Xe,sx:{minWidth:"32px",minHeight:"32px"},children:e.jsx(ht,{})})]}),A&&!1]});return e.jsxs(j,{ref:se,children:[k==="loading"&&tt(),k==="error"&&st(),k==="loaded"&&rt()]})},L={fcp:{good:1800,poor:3e3},lcp:{good:2500,poor:4e3},fid:{good:100,poor:300},cls:{good:.1,poor:.25},ttfb:{good:800,poor:1800},cacheHitRatio:{good:.8,poor:.5}},ss=()=>{const[s,t]=l.useState(null),[r,n]=l.useState(!1),[a,i]=l.useState([]),d=l.useCallback(async()=>{n(!0);try{const f=performance.getEntriesByType("navigation")[0],b=performance.getEntriesByType("paint").find(S=>S.name==="first-contentful-paint")?.startTime||0,o=await rs(),u=await ns(),m=await os(),g=performance.memory,A=await is(),R=navigator.connection||{},y={fcp:b,lcp:o,fid:u,cls:m,ttfb:f.responseStart-f.requestStart,domContentLoaded:f.domContentLoadedEventEnd-f.navigationStart,loadComplete:f.loadEventEnd-f.navigationStart,usedHeapSize:g?.usedJSHeapSize||0,totalHeapSize:g?.totalJSHeapSize||0,heapSizeLimit:g?.jsHeapSizeLimit||0,cacheHitRatio:A.hitRatio,cacheSize:A.size,dbQueryTime:await as(),dbConnectionTime:0,connectionType:R.type||"unknown",effectiveType:R.effectiveType||"unknown",timestamp:Date.now()};t(y),i(S=>[...S.slice(-19),y])}catch(f){console.error("Failed to collect performance metrics:",f)}finally{n(!1)}},[]);l.useEffect(()=>{d();const f=setInterval(d,3e4);return()=>clearInterval(f)},[d]);const c=(f,v,b=!1)=>b?f>=v.good?"good":f>=v.poor?"needs-improvement":"poor":f<=v.good?"good":f<=v.poor?"needs-improvement":"poor",h=f=>{switch(f){case"good":return"success";case"needs-improvement":return"warning";case"poor":return"error";default:return"default"}},x=f=>{switch(f){case"good":return e.jsx(bt,{});case"needs-improvement":return e.jsx(It,{});case"poor":return e.jsx(wt,{});default:return null}},I=f=>{if(f===0)return"0 Bytes";const v=1024,b=["Bytes","KB","MB","GB"],o=Math.floor(Math.log(f)/Math.log(v));return parseFloat((f/Math.pow(v,o)).toFixed(2))+" "+b[o]},T=f=>`${f.toFixed(0)}ms`;return s?e.jsxs(j,{sx:{p:2},children:[e.jsxs(j,{sx:{display:"flex",alignItems:"center",mb:2},children:[e.jsx(M,{variant:"h5",sx:{flexGrow:1},children:"パフォーマンス監視"}),e.jsx(mt,{title:"更新",children:e.jsx(Se,{onClick:d,disabled:r,children:e.jsx(Qe,{})})})]}),e.jsxs(Q,{container:!0,spacing:2,children:[e.jsx(Q,{item:!0,xs:12,md:6,children:e.jsx(X,{children:e.jsxs(ne,{children:[e.jsxs(M,{variant:"h6",gutterBottom:!0,children:[e.jsx(ft,{sx:{mr:1,verticalAlign:"middle"}}),"Core Web Vitals"]}),e.jsxs(we,{children:[e.jsxs(N,{children:[e.jsx(xe,{children:x(c(s.fcp,L.fcp))}),e.jsx(H,{primary:"First Contentful Paint",secondary:T(s.fcp)}),e.jsx(q,{label:c(s.fcp,L.fcp),color:h(c(s.fcp,L.fcp)),size:"small"})]}),e.jsxs(N,{children:[e.jsx(xe,{children:x(c(s.lcp,L.lcp))}),e.jsx(H,{primary:"Largest Contentful Paint",secondary:T(s.lcp)}),e.jsx(q,{label:c(s.lcp,L.lcp),color:h(c(s.lcp,L.lcp)),size:"small"})]}),e.jsxs(N,{children:[e.jsx(xe,{children:x(c(s.fid,L.fid))}),e.jsx(H,{primary:"First Input Delay",secondary:T(s.fid)}),e.jsx(q,{label:c(s.fid,L.fid),color:h(c(s.fid,L.fid)),size:"small"})]}),e.jsxs(N,{children:[e.jsx(xe,{children:x(c(s.cls,L.cls))}),e.jsx(H,{primary:"Cumulative Layout Shift",secondary:s.cls.toFixed(3)}),e.jsx(q,{label:c(s.cls,L.cls),color:h(c(s.cls,L.cls)),size:"small"})]})]})]})})}),e.jsx(Q,{item:!0,xs:12,md:6,children:e.jsx(X,{children:e.jsxs(ne,{children:[e.jsxs(M,{variant:"h6",gutterBottom:!0,children:[e.jsx(pt,{sx:{mr:1,verticalAlign:"middle"}}),"メモリ使用量"]}),e.jsxs(j,{sx:{mb:2},children:[e.jsxs(M,{variant:"body2",gutterBottom:!0,children:["使用量: ",I(s.usedHeapSize)," / ",I(s.totalHeapSize)]}),e.jsx(Oe,{variant:"determinate",value:s.usedHeapSize/s.totalHeapSize*100,color:s.usedHeapSize/s.totalHeapSize>.8?"error":s.usedHeapSize/s.totalHeapSize>.6?"warning":"success"})]}),e.jsxs(M,{variant:"body2",color:"text.secondary",children:["限界: ",I(s.heapSizeLimit)]})]})})}),e.jsx(Q,{item:!0,xs:12,md:6,children:e.jsx(X,{children:e.jsxs(ne,{children:[e.jsxs(M,{variant:"h6",gutterBottom:!0,children:[e.jsx(gt,{sx:{mr:1,verticalAlign:"middle"}}),"ネットワーク & キャッシュ"]}),e.jsxs(we,{dense:!0,children:[e.jsx(N,{children:e.jsx(H,{primary:"接続タイプ",secondary:s.connectionType})}),e.jsx(N,{children:e.jsx(H,{primary:"実効タイプ",secondary:s.effectiveType})}),e.jsxs(N,{children:[e.jsx(H,{primary:"キャッシュヒット率",secondary:`${(s.cacheHitRatio*100).toFixed(1)}%`}),e.jsx(q,{label:c(s.cacheHitRatio,L.cacheHitRatio,!0),color:h(c(s.cacheHitRatio,L.cacheHitRatio,!0)),size:"small"})]}),e.jsx(N,{children:e.jsx(H,{primary:"キャッシュサイズ",secondary:I(s.cacheSize)})})]})]})})}),e.jsx(Q,{item:!0,xs:12,md:6,children:e.jsx(X,{children:e.jsxs(ne,{children:[e.jsxs(M,{variant:"h6",gutterBottom:!0,children:[e.jsx(xt,{sx:{mr:1,verticalAlign:"middle"}}),"データベースパフォーマンス"]}),e.jsxs(we,{dense:!0,children:[e.jsx(N,{children:e.jsx(H,{primary:"クエリ時間",secondary:T(s.dbQueryTime)})}),e.jsxs(N,{children:[e.jsx(H,{primary:"TTFB",secondary:T(s.ttfb)}),e.jsx(q,{label:c(s.ttfb,L.ttfb),color:h(c(s.ttfb,L.ttfb)),size:"small"})]}),e.jsx(N,{children:e.jsx(H,{primary:"DOM読み込み完了",secondary:T(s.domContentLoaded)})}),e.jsx(N,{children:e.jsx(H,{primary:"ページ読み込み完了",secondary:T(s.loadComplete)})})]})]})})})]}),e.jsxs(yt,{sx:{mt:2},children:[e.jsx(St,{expandIcon:e.jsx(vt,{}),children:e.jsxs(M,{children:["パフォーマンス履歴 (",a.length,"件)"]})}),e.jsx(At,{children:e.jsx(j,{sx:{maxHeight:300,overflow:"auto"},children:a.slice(-10).reverse().map((f,v)=>e.jsx(j,{sx:{mb:1,p:1,bgcolor:"grey.50",borderRadius:1},children:e.jsxs(M,{variant:"body2",children:[new Date(f.timestamp).toLocaleTimeString()," - FCP: ",T(f.fcp),", LCP: ",T(f.lcp),", Memory: ",(f.usedHeapSize/f.totalHeapSize*100).toFixed(1),"%"]})},f.timestamp))})})]})]}):e.jsx(j,{sx:{display:"flex",justifyContent:"center",p:2},children:e.jsx(Oe,{})})};async function rs(){return new Promise(s=>{if("PerformanceObserver"in window){const t=new PerformanceObserver(r=>{const n=r.getEntries(),a=n[n.length-1];s(a.startTime),t.disconnect()});t.observe({type:"largest-contentful-paint",buffered:!0}),setTimeout(()=>s(0),1e3)}else s(0)})}async function ns(){return new Promise(s=>{if("PerformanceObserver"in window){const t=new PerformanceObserver(r=>{const a=r.getEntries()[0];s(a.processingStart-a.startTime),t.disconnect()});t.observe({type:"first-input",buffered:!0}),setTimeout(()=>s(0),5e3)}else s(0)})}async function os(){return new Promise(s=>{if("PerformanceObserver"in window){let t=0;const r=new PerformanceObserver(n=>{for(const a of n.getEntries())a.hadRecentInput||(t+=a.value)});r.observe({type:"layout-shift",buffered:!0}),setTimeout(()=>{r.disconnect(),s(t)},5e3)}else s(0)})}async function is(){try{const s=window.cacheService;return s?s.getStats():{hitRatio:0,size:0}}catch{return{hitRatio:0,size:0}}}async function as(){const s=performance.now();try{return await new Promise(t=>setTimeout(t,Math.random()*50)),performance.now()-s}catch{return 0}}class he{static instance;memoryCache=new Map;DEFAULT_TTL=5*60*1e3;MEMORY_MAX_SIZE=50*1024*1024;MEMORY_MAX_ITEMS=1e3;INDEXEDDB_MAX_SIZE=200*1024*1024;stats={memorySize:0,memoryMaxSize:this.MEMORY_MAX_SIZE,indexedDbSize:0,hitRatio:0,hits:0,misses:0,totalQueries:0};dbPromise=null;DB_NAME="ArchiSiteCache";DB_VERSION=1;STORE_NAME="queryCache";constructor(){this.initIndexedDB(),this.startCleanupInterval(),this.startMetricsCollection()}static getInstance(){return he.instance||(he.instance=new he),EnhancedCacheService.instance}async initIndexedDB(){if(!("indexedDB"in window)){console.warn("[CacheService] IndexedDB not supported, using memory-only cache");return}this.dbPromise=new Promise((t,r)=>{const n=indexedDB.open(this.DB_NAME,this.DB_VERSION);n.onerror=()=>{console.error("[CacheService] Failed to open IndexedDB:",n.error),r(n.error)},n.onsuccess=()=>{t(n.result)},n.onupgradeneeded=a=>{const i=a.target.result;if(!i.objectStoreNames.contains(this.STORE_NAME)){const d=i.createObjectStore(this.STORE_NAME,{keyPath:"key"});d.createIndex("timestamp","timestamp",{unique:!1}),d.createIndex("lastAccessed","lastAccessed",{unique:!1})}}})}async getDB(){if(!this.dbPromise)return null;try{return await this.dbPromise}catch(t){return console.error("[CacheService] Failed to get DB:",t),null}}generateKey(t,r=[]){const n=r.length>0?JSON.stringify(r):"",a=`${t}:${n}`;return this.simpleHash(a)}simpleHash(t){let r=0;for(let n=0;n<t.length;n++){const a=t.charCodeAt(n);r=(r<<5)-r+a,r=r&r}return`cache_${Math.abs(r).toString(36)}`}estimateSize(t){const r=JSON.stringify(t);return new Blob([r]).size}isValid(t){return Date.now()-t.timestamp<t.ttl}async get(t,r=[]){const n=this.generateKey(t,r);this.stats.totalQueries++;const a=this.memoryCache.get(n);if(a&&this.isValid(a))return a.accessCount++,a.lastAccessed=Date.now(),this.stats.hits++,this.updateHitRatio(),a.data;a&&(this.memoryCache.delete(n),this.updateMemoryStats());const i=await this.getFromIndexedDB(n);return i&&this.isValid(i)?(this.setInMemory(n,i.data,i.ttl,i.accessCount+1),this.stats.hits++,this.updateHitRatio(),i.data):(this.stats.misses++,this.updateHitRatio(),null)}async set(t,r,n=[],a){const i=this.generateKey(t,n),d=a||this.DEFAULT_TTL;this.setInMemory(i,r,d),await this.setInIndexedDB(i,r,d)}setInMemory(t,r,n,a=1){const i=this.estimateSize(r);this.evictIfNecessary(i);const d={data:r,timestamp:Date.now(),ttl:n,accessCount:a,lastAccessed:Date.now(),size:i};this.memoryCache.set(t,d),this.updateMemoryStats()}evictIfNecessary(t){for(;this.memoryCache.size>=this.MEMORY_MAX_ITEMS;)this.evictLeastUsed();for(;this.stats.memorySize+t>this.MEMORY_MAX_SIZE&&this.memoryCache.size>0;)this.evictLeastUsed()}evictLeastUsed(){let t="",r=1/0;for(const[n,a]of this.memoryCache.entries()){const i=Date.now()-a.lastAccessed,d=1/(a.accessCount+1),c=i*d;c<r&&(r=c,t=n)}t&&(this.memoryCache.delete(t),this.updateMemoryStats())}async getFromIndexedDB(t){const r=await this.getDB();return r?new Promise(n=>{const d=r.transaction([this.STORE_NAME],"readonly").objectStore(this.STORE_NAME).get(t);d.onsuccess=()=>{const c=d.result;c?(this.updateIndexedDBAccess(t,c.accessCount+1),n({data:c.data,timestamp:c.timestamp,ttl:c.ttl,accessCount:c.accessCount,lastAccessed:Date.now()})):n(null)},d.onerror=()=>{console.error("[CacheService] IndexedDB get error:",d.error),n(null)}}):null}async setInIndexedDB(t,r,n){const a=await this.getDB();if(!a)return;const i={key:t,data:r,timestamp:Date.now(),ttl:n,accessCount:1,lastAccessed:Date.now()};return new Promise(d=>{const x=a.transaction([this.STORE_NAME],"readwrite").objectStore(this.STORE_NAME).put(i);x.onsuccess=()=>d(),x.onerror=()=>{console.error("[CacheService] IndexedDB set error:",x.error),d()}})}async updateIndexedDBAccess(t,r){const n=await this.getDB();if(!n)return;const i=n.transaction([this.STORE_NAME],"readwrite").objectStore(this.STORE_NAME),d=i.get(t);d.onsuccess=()=>{const c=d.result;c&&(c.accessCount=r,c.lastAccessed=Date.now(),i.put(c))}}updateMemoryStats(){let t=0;for(const r of this.memoryCache.values())t+=r.size||0;this.stats.memorySize=t}updateHitRatio(){this.stats.hitRatio=this.stats.totalQueries>0?this.stats.hits/this.stats.totalQueries:0}async clearExpired(){let t=0;const r=Date.now();for(const[a,i]of this.memoryCache.entries())r-i.timestamp>=i.ttl&&(this.memoryCache.delete(a),t++);const n=await this.getDB();if(n){const d=n.transaction([this.STORE_NAME],"readwrite").objectStore(this.STORE_NAME).index("timestamp"),c=IDBKeyRange.upperBound(r-this.DEFAULT_TTL),h=d.openCursor(c);h.onsuccess=x=>{const I=x.target.result;I&&(I.delete(),t++,I.continue())}}return this.updateMemoryStats(),t}async clear(){this.memoryCache.clear(),this.updateMemoryStats();const t=await this.getDB();t&&t.transaction([this.STORE_NAME],"readwrite").objectStore(this.STORE_NAME).clear(),this.stats.hits=0,this.stats.misses=0,this.stats.totalQueries=0,this.stats.hitRatio=0}getStats(){return{...this.stats}}async cachedQuery(t,r,n=[],a){const i=await this.get(t,n);if(i!==null)return console.log(`[CacheService] Cache hit for query: ${t.slice(0,50)}...`),i;console.log(`[CacheService] Cache miss for query: ${t.slice(0,50)}...`);const d=await r();return await this.set(t,d,n,a),d}startCleanupInterval(){setInterval(async()=>{const t=await this.clearExpired();t>0&&console.log(`[CacheService] Cleaned up ${t} expired cache entries`)},2*60*1e3)}startMetricsCollection(){setInterval(()=>{console.log("[CacheService] Stats:",{hitRatio:`${(this.stats.hitRatio*100).toFixed(1)}%`,memoryUsage:`${(this.stats.memorySize/1024/1024).toFixed(1)}MB`,totalQueries:this.stats.totalQueries,cacheSize:this.memoryCache.size})},5*60*1e3)}async warmUp(t){console.log("[CacheService] Starting cache warm-up...");for(const{query:r,params:n=[]}of t)try{await this.get(r,n)}catch(a){console.warn(`[CacheService] Failed to warm up query: ${r}`,a)}console.log("[CacheService] Cache warm-up completed")}}const cs=50,ls=300,ds=5*60*1e3,We=({architect:s,index:t})=>{const r=oe(),n=h=>h.ZAT_ARCHITECT||h.ZAR_NAME||"不明",a=h=>{const x=h.ZAT_BIRTHYEAR||"?",I=h.ZAT_DEATHYEAR||"現在";return`${x}-${I}`},i=h=>{const x=[];return h.ZAT_NATIONALITY&&x.push(h.ZAT_NATIONALITY),h.ZAT_CATEGORY&&x.push(h.ZAT_CATEGORY),h.ZAT_SCHOOL&&x.push(h.ZAT_SCHOOL),x},d=h=>`https://via.placeholder.com/300x200?text=${encodeURIComponent(n(h))}`,c=()=>"data:image/jpeg;base64,/9j/4AAQSkZJRgABAQAAAQABAAD/2wBDAAYEBQYFBAYGBQYHBwYIChAKCgkJChQODwwQFxQYGBcUFhYaHSUfGhsjHBYWICwgIyYnKSopGR8tMC0oMCUoKSj/2wBDAQcHBwoIChMKChMoGhYaKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCj/wAARCAAIAAoDASIAAhEBAxEB/8QAFQABAQAAAAAAAAAAAAAAAAAAAAb/xAAhEAACAQMDBQAAAAAAAAAAAAABAgMABAUGIWEREiMxUf/EABUBAQEAAAAAAAAAAAAAAAAAAAMF/8QAGhEAAgIDAAAAAAAAAAAAAAAAAAECEgMRkf/aAAwDAQACEQMRAD8AltJagyeH0AthI5xdrLcNM91BF5pX2HaH9bcfaSXWGaRmknyJckliyjqTzSlT54b6bk+h0R//2Q==";return e.jsx(Et,{in:!0,timeout:300+t*50,children:e.jsx(X,{sx:{height:"100%",display:"flex",flexDirection:"column",transition:"all 0.2s ease-in-out","&:hover":{transform:"translateY(-2px)",boxShadow:r.shadows[8]}},elevation:2,children:e.jsxs(Ze,{component:Ye,to:`/architects/${s.ZAT_ID||s.Z_PK}`,sx:{height:"100%",display:"flex",flexDirection:"column"},children:[e.jsx(j,{sx:{width:"100%",height:200,overflow:"hidden"},children:e.jsx(ts,{src:d(s),alt:n(s),width:"100%",height:200,blurDataUrl:c(),loading:"lazy",lazyLoadOffset:200,enablePerformanceMonitoring:!0,optimizeForMobile:!0,objectFit:"cover",enableZoom:!1,retryOnError:!0,maxRetries:2})}),e.jsxs(ne,{sx:{flexGrow:1,width:"100%"},children:[e.jsx(M,{variant:"h6",component:"div",gutterBottom:!0,sx:{fontWeight:600,lineHeight:1.3,minHeight:"2.6em",display:"-webkit-box",WebkitLineClamp:2,WebkitBoxOrient:"vertical",overflow:"hidden"},children:n(s)}),e.jsxs(j,{sx:{mb:2},children:[e.jsxs(j,{sx:{display:"flex",alignItems:"center",gap:1,mb:.5},children:[e.jsx(Mt,{sx:{fontSize:16,color:"text.secondary"}}),e.jsx(M,{variant:"body2",color:"text.secondary",children:s.ZAT_NATIONALITY||"不明"})]}),e.jsxs(j,{sx:{display:"flex",alignItems:"center",gap:1,mb:.5},children:[e.jsx(zt,{sx:{fontSize:16,color:"text.secondary"}}),e.jsx(M,{variant:"body2",color:"text.secondary",children:a(s)})]}),s.ZAT_CATEGORY&&e.jsxs(j,{sx:{display:"flex",alignItems:"center",gap:1,mb:.5},children:[e.jsx(_t,{sx:{fontSize:16,color:"text.secondary"}}),e.jsx(M,{variant:"body2",color:"text.secondary",children:s.ZAT_CATEGORY})]}),s.ZAT_SCHOOL&&e.jsxs(j,{sx:{display:"flex",alignItems:"center",gap:1,mb:.5},children:[e.jsx(Ot,{sx:{fontSize:16,color:"text.secondary"}}),e.jsx(M,{variant:"body2",color:"text.secondary",sx:{display:"-webkit-box",WebkitLineClamp:1,WebkitBoxOrient:"vertical",overflow:"hidden"},children:s.ZAT_SCHOOL})]})]}),e.jsxs(j,{sx:{display:"flex",flexWrap:"wrap",gap:.5,mt:"auto"},children:[i(s).slice(0,3).map((h,x)=>e.jsx(q,{label:h,size:"small",variant:"outlined",sx:{fontSize:"0.75rem",height:24,pointerEvents:"none"}},x)),i(s).length>3&&e.jsx(q,{label:`+${i(s).length-3}`,size:"small",variant:"outlined",sx:{fontSize:"0.75rem",height:24,pointerEvents:"none",color:"text.secondary"}})]})]})]})})})},gs=()=>{const s=oe(),t=ee(s.breakpoints.down("md")),r=Dt(),n=Lt(),a=l.useRef(new he("architects",ds)),[i,d]=l.useState({query:"",facets:{},page:1,loading:!0}),[c,h]=l.useState([]),[x,I]=l.useState({prefectures:[],architects:[],decades:[],categories:[],materials:[],styles:[],yearRange:{min:1800,max:new Date().getFullYear(),selectedMin:1800,selectedMax:new Date().getFullYear(),step:1,unit:"年"},popular:[]}),[T,f]=l.useState(0),[v,b]=l.useState(0),[o,u]=l.useState(null),m=l.useRef(),g=l.useRef(""),A=l.useRef({}),[R,y]=l.useState({searchTime:0,renderTime:0,cacheHitRate:0,imageLoadTime:0});l.useEffect(()=>{S()},[]),l.useEffect(()=>{const p=new URLSearchParams(n.search),w=p.get("search")||"",z=parseInt(p.get("page")||"1"),E={},W=p.get("prefectures");W&&(E.prefectures=W.split(","));const $=p.get("architects");$&&(E.architects=$.split(","));const D=p.get("categories");D&&(E.categories=D.split(","));const Y=p.get("styles");Y&&(E.styles=Y.split(","));const U=p.get("yearRange");if(U){const[P,G]=U.split("-").map(Number);!isNaN(P)&&!isNaN(G)&&(E.yearRange=[P,G])}d(P=>({...P,query:w,facets:E,page:z}))},[n.search]),l.useEffect(()=>{C()&&O()},[i.query,i.facets,i.page]);const S=async()=>{try{const p=await a.current.get("initial-facets");if(p){I(p),u(null);return}const w=await De();I(w),await a.current.set("initial-facets",w),u(null)}catch(p){console.error("Failed to load initial facets:",p),u("検索フィルターの読み込みに失敗しました")}},C=()=>{const p=JSON.stringify({query:i.query,facets:i.facets,page:i.page}),w=JSON.stringify({query:g.current,facets:A.current,page:i.page});return p!==w},O=l.useCallback(async()=>{m.current&&clearTimeout(m.current),m.current=setTimeout(async()=>{const p=performance.now();try{d(D=>({...D,loading:!0})),u(null);const w=JSON.stringify({query:i.query,facets:i.facets,page:i.page}),z=await a.current.get(w);if(z){h(z.results),f(z.total),b(z.totalPages);const D=performance.now();y(Y=>({...Y,searchTime:D-p,cacheHitRate:Y.cacheHitRate+1}));return}const E=await kt(i.query,i.facets,i.page,cs),W=await De(i.facets);h(E.results),f(E.total),b(E.totalPages),I(W),await a.current.set(w,E),g.current=i.query,A.current={...i.facets},k();const $=performance.now();y(D=>({...D,searchTime:$-p}))}catch(w){console.error("Search failed:",w),u("検索に失敗しました。もう一度お試しください。"),h([]),f(0),b(0)}finally{d(w=>({...w,loading:!1}))}},ls)},[i.query,i.facets,i.page]),k=()=>{const p=new URLSearchParams;if(i.query&&p.set("search",i.query),i.page>1&&p.set("page",i.page.toString()),i.facets.prefectures?.length&&p.set("prefectures",i.facets.prefectures.join(",")),i.facets.architects?.length&&p.set("architects",i.facets.architects.join(",")),i.facets.categories?.length&&p.set("categories",i.facets.categories.join(",")),i.facets.styles?.length&&p.set("styles",i.facets.styles.join(",")),i.facets.yearRange){const[z,E]=i.facets.yearRange;p.set("yearRange",`${z}-${E}`)}const w=p.toString()?`?${p.toString()}`:"";w!==n.search&&r(w,{replace:!0})},F=l.useCallback((p,w)=>{d(z=>({...z,query:p,facets:w,page:1}))},[]),K=l.useCallback(p=>{d(w=>({...w,facets:p,page:1}))},[]),te=(p,w)=>{d(z=>({...z,page:w})),window.scrollTo({top:0,behavior:"smooth"})},ie=l.useCallback(p=>{y(w=>({...w,imageLoadTime:(w.imageLoadTime+p.totalLoadTime)/2}))},[]),V=l.useCallback((p,w)=>e.jsx(j,{sx:{p:1,width:t?"100%":"50%",height:"auto"},children:e.jsx(We,{architect:p,index:w})}),[t]);return l.useEffect(()=>()=>{m.current&&clearTimeout(m.current)},[]),o?e.jsx(je,{maxWidth:"lg",sx:{py:4},children:e.jsx(jt,{severity:"error",sx:{mb:3},children:o})}):e.jsxs(je,{maxWidth:"xl",sx:{py:4},children:[e.jsx(ss,{metrics:R,position:"bottom-right"}),e.jsx(ye,{in:!0,timeout:500,children:e.jsxs(j,{sx:{mb:4},children:[e.jsx(M,{variant:"h4",component:"h1",gutterBottom:!0,children:"建築家一覧"}),e.jsx(M,{variant:"body1",color:"text.secondary",children:"世界の著名な建築家を検索・絞り込みできます"})]})}),e.jsx(ye,{in:!0,timeout:700,children:e.jsx(j,{sx:{mb:4},children:e.jsx(Pt,{onSearch:F,onFacetsChange:K,facets:x,loading:i.loading,resultCount:T,placeholder:"建築家名、国籍、カテゴリー、学校で検索...",showResultCount:!0,mobileBreakpoint:960,maxVisibleFacets:6})})}),e.jsx(j,{children:i.loading?e.jsx(j,{sx:{display:"flex",justifyContent:"center",py:8},children:e.jsx($e,{size:48})}):e.jsxs(e.Fragment,{children:[c.length===0?e.jsx(ye,{in:!0,timeout:500,children:e.jsxs(Ct,{elevation:1,sx:{p:6,textAlign:"center"},children:[e.jsx(Tt,{sx:{fontSize:64,color:"text.secondary",mb:2}}),e.jsx(M,{variant:"h6",gutterBottom:!0,children:"建築家が見つかりませんでした"}),e.jsx(M,{variant:"body2",color:"text.secondary",children:"検索条件を変更してもう一度お試しください"})]})}):e.jsx(e.Fragment,{children:c.length>20?e.jsx(Gt,{architects:c,renderItem:V,itemHeight:t?400:350,overscan:5,onImageLoad:ie}):e.jsx(j,{sx:{display:"flex",flexWrap:"wrap",mx:-1},children:c.map((p,w)=>e.jsx(j,{sx:{width:t?"100%":{xs:"100%",sm:"50%",md:"33.333%",lg:"25%"},p:1},children:e.jsx(We,{architect:p,index:w})},p.ZAT_ID||p.Z_PK||w))})}),v>1&&e.jsx(ye,{in:!0,timeout:900,children:e.jsx(j,{sx:{display:"flex",justifyContent:"center",mt:6,py:2},children:e.jsx(Rt,{count:v,page:i.page,onChange:te,color:"primary",size:t?"medium":"large",showFirstButton:!0,showLastButton:!0,sx:{"& .MuiPaginationItem-root":{minWidth:t?32:40,height:t?32:40}}})})})]})})]})};export{gs as default};
//# sourceMappingURL=EnhancedArchitectsPage-D9Me3suq.js.map
