import{u as Lt,a as Ot,j as e,A as Bt,T as Pt,b as i,I as Xe,M as Nt,D as xt,B as r,C as zt,L as ut,c as mt,d as gt,e as $,H as Mt,f as ze,P as We,g as Ie,S as Ht,h as se,G as H,i as ie,k as fe,l as pe,F as be,m as Ne,n as B,o as Te,p as Ge,q as ae,r as Ee,s as Zt,t as Ut,v as Ce,R as ot,w as nt,x as Ke,y as qe,z as et,E as ft,J as pt,K as jt,N as yt,O as bt,Q as re,U as Gt,V as Ct,W as He,X as Tt,Y as Ze,Z as Et,_ as Ye,$ as tt,a0 as At,a1 as Kt,a2 as qt,a3 as Qt,a4 as Vt,a5 as Jt,a6 as Xt,a7 as er,a8 as tr,a9 as rr,aa as sr,ab as nr,ac as ge,ad as G,ae as or,af as ar,ag as ir,ah as lr,ai as cr,aj as dr}from"./ui-Dt_CYN3Z.js";import{a as hr,u as Qe,r as x,L as z,e as Ve,f as vt,R as It,H as xr,h as ur,i as ve}from"./vendor-C30vB44U.js";import{d as mr}from"./database-C3TWL7Qm.js";import{L as St,M as gr,T as fr,a as at,P as it}from"./map-C0JyOu4T.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const l of document.querySelectorAll('link[rel="modulepreload"]'))f(l);new MutationObserver(l=>{for(const j of l)if(j.type==="childList")for(const d of j.addedNodes)d.tagName==="LINK"&&d.rel==="modulepreload"&&f(d)}).observe(document,{childList:!0,subtree:!0});function o(l){const j={};return l.integrity&&(j.integrity=l.integrity),l.referrerPolicy&&(j.referrerPolicy=l.referrerPolicy),l.crossOrigin==="use-credentials"?j.credentials="include":l.crossOrigin==="anonymous"?j.credentials="omit":j.credentials="same-origin",j}function f(l){if(l.ep)return;l.ep=!0;const j=o(l);fetch(l.href,j)}})();var wt,lt=hr;wt=lt.createRoot,lt.hydrateRoot;const ct=[{title:"ホーム",path:"/",icon:e.jsx(Mt,{})},{title:"建築作品",path:"/architecture",icon:e.jsx(ze,{})},{title:"建築家",path:"/architects",icon:e.jsx(We,{})},{title:"マップ",path:"/map",icon:e.jsx(Ie,{})},{title:"DBエクスプローラー",path:"/db-explorer",icon:e.jsx(Ht,{})}],pr=()=>{const t=Qe().pathname,o=Lt(),f=Ot(o.breakpoints.down("sm")),[l,j]=x.useState(!1),d=c=>n=>{n.type==="keydown"&&(n.key==="Tab"||n.key==="Shift")||j(c)};return e.jsx(Bt,{position:"static",color:"primary",component:"nav",role:"navigation","aria-label":"メインナビゲーション",children:e.jsxs(Pt,{children:[e.jsx(i,{variant:"h6",component:z,to:"/","data-testid":"site-title",sx:{flexGrow:1,color:"white",textDecoration:"none",fontWeight:"bold"},children:"建築データベース"}),f?e.jsxs(e.Fragment,{children:[e.jsx(Xe,{edge:"end",color:"inherit","aria-label":"menu","data-testid":"mobile-menu-button",onClick:d(!0),children:e.jsx(Nt,{})}),e.jsx(xt,{anchor:"right",open:l,onClose:d(!1),children:e.jsxs(r,{sx:{width:250},role:"presentation",onClick:d(!1),onKeyDown:d(!1),children:[e.jsx(r,{sx:{display:"flex",justifyContent:"flex-end",p:1},children:e.jsx(Xe,{onClick:d(!1),children:e.jsx(zt,{})})}),e.jsx(ut,{role:"menu","aria-label":"ナビゲーションメニュー",children:ct.map(({title:c,path:n,icon:u})=>e.jsxs(mt,{component:z,to:n,role:"menuitem","data-testid":`nav-link-${c.toLowerCase()}`,sx:{color:t===n?"primary.main":"text.primary",backgroundColor:t===n?"rgba(0, 0, 0, 0.08)":"transparent",fontWeight:t===n?"bold":"normal","&:hover":{backgroundColor:"rgba(0, 0, 0, 0.04)"}},children:[u,e.jsx(gt,{primary:c,sx:{ml:2}})]},c))})]})})]}):e.jsx(r,{sx:{display:"flex"},role:"menubar","aria-label":"デスクトップナビゲーション",children:ct.map(({title:c,path:n})=>e.jsx($,{component:z,to:n,color:"inherit",role:"menuitem","data-testid":`nav-link-${c.toLowerCase()}`,sx:{mx:1,fontWeight:t===n?"bold":"normal",borderBottom:t===n?"2px solid white":"none"},children:c},c))})]})})},jr=()=>e.jsx(r,{component:"footer",role:"contentinfo","data-testid":"footer",sx:{py:3,px:2,mt:"auto",backgroundColor:"primary.main",color:"white"},children:e.jsx(se,{maxWidth:"sm",children:e.jsxs(i,{variant:"body1",align:"center",children:["建築データベース © ",new Date().getFullYear()]})})}),yr="modulepreload",br=function(s){return"/archi-site/"+s},dt={},Cr=function(t,o,f){let l=Promise.resolve();if(o&&o.length>0){document.getElementsByTagName("link");const d=document.querySelector("meta[property=csp-nonce]"),c=d?.nonce||d?.getAttribute("nonce");l=Promise.allSettled(o.map(n=>{if(n=br(n),n in dt)return;dt[n]=!0;const u=n.endsWith(".css"),m=u?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${n}"]${m}`))return;const S=document.createElement("link");if(S.rel=u?"stylesheet":yr,u||(S.as="script"),S.crossOrigin="",S.href=n,c&&S.setAttribute("nonce",c),document.head.appendChild(S),u)return new Promise((W,_)=>{S.addEventListener("load",W),S.addEventListener("error",()=>_(new Error(`Unable to preload CSS for ${n}`)))})}))}function j(d){const c=new Event("vite:preloadError",{cancelable:!0});if(c.payload=d,window.dispatchEvent(c),!c.defaultPrevented)throw d}return l.then(d=>{for(const c of d||[])c.status==="rejected"&&j(c.reason);return t().catch(j)})},Tr=({variant:s="card",count:t=6})=>{const o=()=>e.jsx(fe,{sx:{height:"100%"},children:e.jsxs(pe,{children:[e.jsx(ie,{variant:"text",height:40,sx:{mb:1}}),e.jsx(ie,{variant:"text",height:20,sx:{mb:1}}),e.jsx(ie,{variant:"text",height:20,width:"60%"})]})}),f=()=>e.jsxs(r,{sx:{p:2},children:[e.jsx(ie,{variant:"text",height:32,sx:{mb:1}}),e.jsx(ie,{variant:"text",height:24,sx:{mb:1}}),e.jsx(ie,{variant:"text",height:20,width:"40%"})]}),l=()=>e.jsx(se,{maxWidth:"lg",children:e.jsxs(r,{sx:{textAlign:"center",py:8},children:[e.jsx(ie,{variant:"text",height:60,sx:{mb:2}}),e.jsx(ie,{variant:"text",height:30,sx:{mb:4}}),e.jsx(r,{sx:{display:"flex",justifyContent:"center",mb:4},children:e.jsx(ie,{variant:"rectangular",width:500,height:56,sx:{borderRadius:1}})})]})}),j=()=>e.jsx(ie,{variant:"rectangular",width:"100%",height:400,sx:{borderRadius:2}});return s==="hero"?l():s==="map"?j():s==="list"?e.jsx(r,{children:Array.from({length:t}).map((d,c)=>e.jsx(r,{sx:{borderBottom:"1px solid #e0e0e0"},children:f()},c))}):e.jsx(H,{container:!0,spacing:4,children:Array.from({length:t}).map((d,c)=>e.jsx(H,{item:!0,xs:12,sm:6,md:4,children:o()},c))})},Er=()=>{const[s,t]=x.useState(""),[o,f]=x.useState([]),[l,j]=x.useState(!0),[d,c]=x.useState(null),[n,u]=x.useState(!1),[m,S]=x.useState(null);x.useEffect(()=>{const T=y=>{const{progress:p,speed:A,eta:D,receivedLength:K,totalLength:E}=y.detail;S({progress:p,speed:A,eta:D,receivedLength:K,totalLength:E})};window.addEventListener("database-download-progress",T);const Z=setTimeout(()=>{console.warn("Emergency timeout: forcing app to render without database after 3 minutes"),j(!1),u(!1),c("データベースの初期化がタイムアウトしました（大きなファイルの読み込みに時間がかかっています）。接続が遅い場合は、しばらくお待ちください。")},18e4);return(async()=>{try{j(!0),c(null),console.log("最近の建築作品を取得中...");const{getAllArchitectures:y}=await Cr(async()=>{const{getAllArchitectures:K}=await Promise.resolve().then(()=>vr);return{getAllArchitectures:K}},void 0),p=new Promise((K,E)=>{setTimeout(()=>E(new Error("データベース接続がタイムアウトしました（90秒）。大きなファイルの読み込みに時間がかかっています。")),9e4)}),A=y(1,6),D=await Promise.race([A,p]);clearTimeout(Z),f(D.items),u(!0),console.log("建築作品の取得に成功しました",D)}catch(y){console.error("建築作品の取得に失敗:",y),clearTimeout(Z);let p=y.message||"データベースからの読み込みに失敗しました";y.message?.includes("timeout")?p+=" インターネット接続が遅い可能性があります。しばらく待ってからページを再読み込みしてください。":y.message?.includes("fetch")&&(p+=" ネットワーク接続を確認してください。"),c(p),u(!1)}finally{j(!1)}})(),()=>{clearTimeout(Z),window.removeEventListener("database-download-progress",T)}},[]);const W=T=>{T.preventDefault(),s.trim()&&(window.location.href=`/architecture?search=${encodeURIComponent(s)}`)},_=()=>{c(null),j(!0),S(null),window.location.reload()},w=T=>T<1024?`${Math.round(T)} B/s`:T<1024*1024?`${Math.round(T/1024)} KB/s`:`${Math.round(T/1024/1024)} MB/s`,L=T=>T<60?`${Math.round(T)}s`:T<3600?`${Math.round(T/60)}m ${Math.round(T%60)}s`:`${Math.round(T/3600)}h ${Math.round(T%3600/60)}m`;return e.jsxs(se,{maxWidth:"lg","data-testid":"homepage-container",children:[e.jsx(be,{in:!0,timeout:1e3,children:e.jsxs(r,{component:"section",role:"banner","aria-labelledby":"main-heading",sx:{pt:8,pb:6,textAlign:"center",background:"linear-gradient(135deg, #ECEFF4 0%, #D8DEE9 100%)",borderRadius:3,mb:6,position:"relative",overflow:"hidden"},children:[e.jsx(r,{sx:{position:"absolute",top:0,left:0,right:0,bottom:0,opacity:.1,background:"repeating-linear-gradient(45deg, transparent, transparent 10px, rgba(46, 52, 64, 0.1) 10px, rgba(46, 52, 64, 0.1) 20px)"}}),e.jsxs(r,{sx:{position:"relative",zIndex:1},children:[e.jsx(i,{component:"h1",variant:"h1",align:"center",color:"text.primary",gutterBottom:!0,id:"main-heading",sx:{background:"linear-gradient(135deg, #2E3440 0%, #4C566A 100%)",backgroundClip:"text",WebkitBackgroundClip:"text",color:"transparent",mb:2},children:"建築データベース"}),e.jsxs(i,{variant:"h5",align:"center",color:"text.secondary",paragraph:!0,sx:{mb:4,maxWidth:600,mx:"auto"},children:["日本の建築作品と建築家を検索・閲覧できる",e.jsx("br",{}),"包括的なデータベース"]}),e.jsxs(Ne,{direction:"row",spacing:3,justifyContent:"center",sx:{mb:4},children:[e.jsx(B,{icon:e.jsx(ze,{}),label:"14,000+ 建築作品",color:"primary",variant:"outlined"}),e.jsx(B,{icon:e.jsx(We,{}),label:"2,900+ 建築家",color:"secondary",variant:"outlined"}),e.jsx(B,{icon:e.jsx(Ie,{}),label:"全国対応",color:"info",variant:"outlined"})]}),e.jsx(be,{in:!0,timeout:1500,children:e.jsxs(r,{component:"form",onSubmit:W,role:"search","aria-label":"建築作品検索",sx:{mt:4,display:"flex",justifyContent:"center",alignItems:"center",maxWidth:600,mx:"auto",gap:2},children:[e.jsx(Te,{fullWidth:!0,variant:"outlined",placeholder:"建築作品、建築家、住所などで検索",value:s,onChange:T=>t(T.target.value),inputProps:{"aria-label":"建築作品検索","data-testid":"search-input",role:"searchbox"},sx:{"& .MuiOutlinedInput-root":{backgroundColor:"white",boxShadow:"0 4px 12px rgba(0, 0, 0, 0.1)"}}}),e.jsx($,{type:"submit",variant:"contained",color:"primary",startIcon:e.jsx(Ge,{}),size:"large","data-testid":"search-button",sx:{px:3,py:1.5,minWidth:120},children:"検索"})]})}),!n&&l&&e.jsx(r,{sx:{mt:4,maxWidth:600,mx:"auto"},children:m?e.jsxs(ae,{sx:{p:3,background:"rgba(255, 255, 255, 0.9)",borderRadius:2},children:[e.jsx(i,{variant:"h6",gutterBottom:!0,sx:{color:"primary.main"},children:"📦 大きなデータベースを読み込み中..."}),e.jsxs(r,{sx:{mb:2},children:[e.jsxs(r,{sx:{display:"flex",alignItems:"center",mb:1},children:[e.jsx(Ee,{variant:"determinate",value:m.progress,size:24,sx:{mr:2}}),e.jsxs(i,{variant:"body2",color:"text.secondary",children:[m.progress,"% • ",Math.round(m.receivedLength/1024/1024)," MB / ",Math.round(m.totalLength/1024/1024)," MB"]})]}),e.jsx(Zt,{variant:"determinate",value:m.progress,sx:{height:8,borderRadius:4}})]}),e.jsxs(Ne,{direction:"row",spacing:2,sx:{fontSize:"0.875rem",color:"text.secondary"},children:[e.jsxs(r,{children:["📊 ",w(m.speed)]}),e.jsxs(r,{children:["⏱️ ETA: ",L(m.eta)]})]}),e.jsx(i,{variant:"body2",sx:{mt:1,fontStyle:"italic",color:"text.secondary"},children:"初回のアクセスでは、大きなファイルのダウンロードが必要です。しばらくお待ちください。"})]}):e.jsxs(ae,{sx:{p:3,background:"rgba(255, 255, 255, 0.9)",borderRadius:2},children:[e.jsxs(r,{sx:{display:"flex",alignItems:"center",justifyContent:"center",mb:2},children:[e.jsx(Ee,{size:24,sx:{mr:2}}),e.jsx(i,{variant:"h6",sx:{color:"primary.main"},children:"データベースを初期化中..."})]}),e.jsx(i,{variant:"body2",color:"text.secondary",align:"center",children:"14,000件の建築作品データを読み込み中です"})]})})]})]})}),e.jsxs(r,{component:"section","aria-labelledby":"recent-works-heading",sx:{py:4},children:[e.jsxs(r,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:3},children:[e.jsxs(r,{sx:{display:"flex",alignItems:"center",gap:2},children:[e.jsx(Ut,{color:"primary"}),e.jsx(i,{variant:"h4",fontWeight:"bold",id:"recent-works-heading",component:"h2",children:"最近の建築作品"})]}),n&&e.jsx(Ce,{title:"リフレッシュ",children:e.jsx(Xe,{onClick:()=>window.location.reload(),color:"primary",children:e.jsx(ot,{})})})]}),d&&e.jsx(be,{in:!0,children:e.jsx(nt,{severity:"error",sx:{mb:3,borderRadius:2,"& .MuiAlert-message":{display:"flex",alignItems:"center",gap:2}},children:e.jsxs(r,{children:[d,e.jsxs(Ne,{direction:"row",spacing:2,sx:{mt:2},children:[e.jsx($,{size:"small",variant:"contained",color:"primary",onClick:_,startIcon:e.jsx(ot,{}),children:"再試行"}),e.jsx($,{size:"small",variant:"outlined",component:z,to:"/db-explorer",children:"診断ツールを開く"})]})]})})}),l?e.jsx(Tr,{variant:"card",count:6}):o.length>0?e.jsx(be,{in:!0,timeout:800,children:e.jsx(H,{container:!0,spacing:4,children:o.map((T,Z)=>e.jsx(H,{item:!0,xs:12,sm:6,md:4,children:e.jsx(be,{in:!0,timeout:1e3+Z*200,children:e.jsx(fe,{sx:{height:"100%",display:"flex",flexDirection:"column",background:"linear-gradient(135deg, #FFFFFF 0%, #F8F9FA 100%)",border:"1px solid #E5E9F0","&:hover":{"& .card-content":{transform:"translateY(-2px)"}}},children:e.jsx(Ke,{component:z,to:`/architecture/${T.ZAW_ID}`,sx:{height:"100%"},children:e.jsxs(pe,{className:"card-content",sx:{flexGrow:1,transition:"transform 0.3s ease-in-out",p:3},children:[e.jsx(i,{gutterBottom:!0,variant:"h6",component:"h3",sx:{fontWeight:600,color:"text.primary",mb:2,lineHeight:1.3},children:T.ZAW_NAME}),e.jsxs(Ne,{spacing:1,children:[e.jsxs(r,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(We,{fontSize:"small",color:"secondary"}),e.jsx(i,{variant:"body2",color:"text.secondary",children:T.ZAW_ARCHITECT||"建築家不明"})]}),e.jsxs(r,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(Ie,{fontSize:"small",color:"secondary"}),e.jsxs(i,{variant:"body2",color:"text.secondary",children:[T.ZAW_ADDRESS||"場所不明"," • ",T.ZAW_YEAR&&T.ZAW_YEAR!==0?T.ZAW_YEAR+"年":"年代不明"]})]})]})]})})})})},T.ZAW_ID))})}):e.jsxs(ae,{sx:{p:6,textAlign:"center",background:"linear-gradient(135deg, #F8F9FA 0%, #ECEFF4 100%)"},children:[e.jsx(i,{variant:"h6",color:"text.secondary",gutterBottom:!0,children:"建築作品が見つかりませんでした"}),e.jsx(i,{variant:"body2",color:"text.secondary",children:"データベースの接続を確認してください"})]}),n&&e.jsx(be,{in:!0,timeout:1200,children:e.jsx(r,{sx:{display:"flex",justifyContent:"center",mt:4},children:e.jsx($,{variant:"outlined",color:"primary",component:z,to:"/architecture",size:"large",sx:{px:4,py:1.5,borderWidth:2,"&:hover":{borderWidth:2}},children:"すべての作品を見る"})})})]}),e.jsx(qe,{sx:{my:6}}),e.jsx(be,{in:!0,timeout:1400,children:e.jsxs(r,{component:"section","aria-labelledby":"features-heading",sx:{mb:6},children:[e.jsx(i,{variant:"h4",align:"center",gutterBottom:!0,id:"features-heading",component:"h2",sx:{mb:4,fontWeight:"bold"},children:"データベースの特徴"}),e.jsxs(H,{container:!0,spacing:4,children:[e.jsx(H,{item:!0,xs:12,md:4,children:e.jsxs(fe,{sx:{height:"100%",display:"flex",flexDirection:"column",background:"linear-gradient(135deg, #88C0D0 0%, #5E81AC 100%)",color:"white",position:"relative",overflow:"hidden"},children:[e.jsx(r,{sx:{position:"absolute",top:-20,right:-20,opacity:.2},children:e.jsx(ze,{sx:{fontSize:100}})}),e.jsxs(pe,{sx:{position:"relative",zIndex:1,p:3},children:[e.jsxs(r,{sx:{display:"flex",alignItems:"center",mb:2},children:[e.jsx(ze,{sx:{mr:2,fontSize:32}}),e.jsx(i,{variant:"h5",fontWeight:"bold",children:"建築作品"})]}),e.jsx(i,{paragraph:!0,sx:{mb:3,opacity:.9},children:"日本全国から14,000件以上の建築作品情報を閲覧できます。地域、年代、カテゴリーなどで詳細検索が可能です。"}),e.jsx($,{variant:"contained",component:z,to:"/architecture",sx:{mt:"auto",backgroundColor:"rgba(255, 255, 255, 0.2)",color:"white","&:hover":{backgroundColor:"rgba(255, 255, 255, 0.3)"}},children:"作品を探す"})]})]})}),e.jsx(H,{item:!0,xs:12,md:4,children:e.jsxs(fe,{sx:{height:"100%",display:"flex",flexDirection:"column",background:"linear-gradient(135deg, #D08770 0%, #BF616A 100%)",color:"white",position:"relative",overflow:"hidden"},children:[e.jsx(r,{sx:{position:"absolute",top:-20,right:-20,opacity:.2},children:e.jsx(We,{sx:{fontSize:100}})}),e.jsxs(pe,{sx:{position:"relative",zIndex:1,p:3},children:[e.jsxs(r,{sx:{display:"flex",alignItems:"center",mb:2},children:[e.jsx(We,{sx:{mr:2,fontSize:32}}),e.jsx(i,{variant:"h5",fontWeight:"bold",children:"建築家"})]}),e.jsx(i,{paragraph:!0,sx:{mb:3,opacity:.9},children:"2,900人以上の建築家情報を収録。経歴、作品リスト、所属事務所などの詳細情報を確認できます。"}),e.jsx($,{variant:"contained",component:z,to:"/architects",sx:{mt:"auto",backgroundColor:"rgba(255, 255, 255, 0.2)",color:"white","&:hover":{backgroundColor:"rgba(255, 255, 255, 0.3)"}},children:"建築家を探す"})]})]})}),e.jsx(H,{item:!0,xs:12,md:4,children:e.jsxs(fe,{sx:{height:"100%",display:"flex",flexDirection:"column",background:"linear-gradient(135deg, #A3BE8C 0%, #8CAF69 100%)",color:"white",position:"relative",overflow:"hidden"},children:[e.jsx(r,{sx:{position:"absolute",top:-20,right:-20,opacity:.2},children:e.jsx(Ie,{sx:{fontSize:100}})}),e.jsxs(pe,{sx:{position:"relative",zIndex:1,p:3},children:[e.jsxs(r,{sx:{display:"flex",alignItems:"center",mb:2},children:[e.jsx(Ie,{sx:{mr:2,fontSize:32}}),e.jsx(i,{variant:"h5",fontWeight:"bold",children:"マップ表示"})]}),e.jsx(i,{paragraph:!0,sx:{mb:3,opacity:.9},children:"建築作品を地図上で視覚的に探索できます。位置情報をもとに周辺の建築作品を発見できます。"}),e.jsx($,{variant:"contained",component:z,to:"/map",sx:{mt:"auto",backgroundColor:"rgba(255, 255, 255, 0.2)",color:"white","&:hover":{backgroundColor:"rgba(255, 255, 255, 0.3)"}},children:"マップを開く"})]})]})})]})]})})]})},Fe="/archi-site",_e=`${Fe}/db/archimap.sqlite`;console.log("🔧 Environment debug info:");console.log("  - import.meta.env.PROD:",!0);console.log("  - BASE_PATH:",Fe);console.log("  - DATABASE_URL:",_e);let te=null,rt=!1,$e=null;var Me=(s=>(s.NOT_INITIALIZED="not_initialized",s.INITIALIZING="initializing",s.READY="ready",s.ERROR="error",s))(Me||{});const Ar=()=>te?"ready":rt?"initializing":"not_initialized",ht=async()=>{try{const s=Date.now(),t=await fetch(`${Fe}/images/shinkenchiku-favicon.ico`,{method:"HEAD",cache:"no-cache"}),f=Date.now()-s;return f<100?"fast":f<500?"slow":"very-slow"}catch{return"very-slow"}},Rt=async()=>te||$e||(rt=!0,$e=(async()=>{try{console.log("🚀 データベース初期化を開始（sql.js-httpvfs使用）...");const s=await ht();console.log(`🌐 Connection speed detected: ${s}`),console.log("🗄️ Testing database file accessibility...");try{const u=await fetch(_e,{method:"HEAD"});if(console.log("  - Database file status:",u.status,u.statusText),!u.ok)throw new Error(`Database file not accessible: ${u.status} ${u.statusText} at ${_e}`);const m=u.headers.get("content-length");if(m){const S=parseInt(m)/1048576;console.log(`  - Database file size: ${S.toFixed(2)} MB`)}console.log("✅ Database file is accessible")}catch(u){throw console.error("❌ Database file accessibility check failed:",u),new Error(`Database file not accessible: ${u.message}`)}console.log("📦 sql.js-httpvfs worker を初期化中..."),console.log(`📍 Database URL: ${_e}`);const t=`${Fe}/sqlite.worker.js`,o=`${Fe}/sql-wasm.wasm`;console.log("🔧 Worker file URLs:"),console.log("  - workerUrl:",t),console.log("  - wasmUrl:",o),console.log("🔍 Testing worker file accessibility...");try{const u=await fetch(t,{method:"HEAD"}),m=await fetch(o,{method:"HEAD"});if(console.log("  - Worker file status:",u.status,u.statusText),console.log("  - WASM file status:",m.status,m.statusText),!u.ok)throw new Error(`Worker file not accessible: ${u.status} ${u.statusText} at ${t}`);if(!m.ok)throw new Error(`WASM file not accessible: ${m.status} ${m.statusText} at ${o}`);console.log("✅ All worker files are accessible")}catch(u){throw console.error("❌ Worker file accessibility check failed:",u),new Error(`Worker files not accessible: ${u.message}`)}const f={from:"inline",config:{serverMode:"full",url:_e,requestChunkSize:4096,cacheSizeKiB:2048,filename:"archimap.sqlite",debug:!1,size:12730368}};console.log("🔧 Worker config:",f),console.log("🔧 Worker URL:",t),console.log("🔧 WASM URL:",o);const l=new Promise((u,m)=>setTimeout(()=>m(new Error("Worker initialization timeout after 30 seconds")),3e4)),j=50*1024*1024,d=mr.createDbWorker([f],t,o,j);te=await Promise.race([d,l]),console.log("✅ sql.js-httpvfs worker 初期化完了");const c=await te.db.exec("SELECT sqlite_version()");console.log(`🔍 SQLite バージョン: ${c[0]?.values[0][0]}`);const n=await te.db.exec("SELECT name FROM sqlite_master WHERE type='table'");if(n.length>0){console.log(`📋 利用可能なテーブル数: ${n[0].values.length}`);try{const u=await te.db.exec("SELECT COUNT(*) FROM ZCDARCHITECTURE");u.length>0&&console.log(`🏢 建築データ件数: ${u[0].values[0][0]} 件`)}catch{console.log("📋 テーブル構造確認中...")}}return te}catch(s){if(console.error("❌ データベース初期化エラー:",s),te=null,s instanceof Error){const t=await ht().catch(()=>"unknown");let o=s.message;s.message.includes("timeout")?t==="very-slow"?o+=`

📡 接続速度が非常に遅いため、データベースの初期化に時間がかかっています。WiFiやより高速な接続をお試しください。`:t==="slow"&&(o+=`

📡 接続速度が遅いため、データベースの初期化に時間がかかっています。`):(s.message.includes("fetch")||s.message.includes("network"))&&(o+=`

🌐 ネットワーク接続に問題があります。接続状態を確認してください。`);const f=new Error(o);throw f.name=s.name,f}throw s}finally{rt=!1,$e=null}})(),$e),Dt=async(s,t=[])=>{try{if(te||await Rt(),!te)throw new Error("データベースが初期化されていません");return await te.db.exec(s,t)}catch(o){throw console.error("クエリ実行エラー:",o),o}},kt=s=>{if(!s||s.length===0)return[];const{columns:t,values:o}=s[0];return o.map(f=>{const l={};return t.forEach((j,d)=>{l[j]=f[d]}),l})},Je=async(s,t=[])=>{const o=await Dt(s,t);return kt(o)[0]},Le=async(s,t=[])=>{const o=await Dt(s,t);return kt(o)},$t=async s=>Je("SELECT * FROM ZCDARCHITECTURE WHERE Z_PK = ?",[s]),Wt=async(s=1,t=12,o="",f="ZAR_TITLE",l="asc",j={})=>{const d=(s-1)*t;let c="1=1";const n=[];o&&(c+=" AND (ZAR_TITLE LIKE ? OR ZAR_ADDRESS LIKE ? OR ZAR_DESCRIPTION LIKE ? OR ZAR_ARCHITECT LIKE ?)",n.push(`%${o}%`,`%${o}%`,`%${o}%`,`%${o}%`)),j.architect&&(c+=" AND (ZAR_ARCHITECT LIKE ? OR ZAR_ARCHITECT_ENG LIKE ?)",n.push(`%${j.architect}%`,`%${j.architect}%`)),j.location&&(c+=" AND ZAR_ADDRESS LIKE ?",n.push(`%${j.location}%`)),j.prefecture&&(c+=" AND ZAR_PREFECTURE = ?",n.push(j.prefecture)),j.yearFrom&&(c+=" AND ZAR_YEAR >= ?",n.push(j.yearFrom)),j.yearTo&&(c+=" AND ZAR_YEAR <= ?",n.push(j.yearTo)),j.tags&&j.tags.length>0&&(c+=" AND ZAR_TAG LIKE ?",n.push(`%${j.tags.join("%")}%`));const u=`
    SELECT COUNT(*) as total
    FROM ZCDARCHITECTURE
    WHERE ${c}
  `,m=`
    SELECT *
    FROM ZCDARCHITECTURE
    WHERE ${c}
    ORDER BY ${f} ${l==="desc"?"DESC":"ASC"}
    LIMIT ? OFFSET ?
  `,S=[...n,t,d];try{const _=(await Je(u,n))?.total||0;return{results:await Le(m,S),total:_,page:s,limit:t,totalPages:Math.ceil(_/t)}}catch(W){throw console.error("建築作品データ取得エラー:",W),W}},_t=async(s,t={})=>{let o=`
    ZAR_LATITUDE BETWEEN ? AND ?
    AND ZAR_LONGITUDE BETWEEN ? AND ?
    AND ZAR_LATITUDE IS NOT NULL
    AND ZAR_LONGITUDE IS NOT NULL
  `;const f=[s.south,s.north,s.west,s.east];t.searchTerm&&(o+=" AND (ZAR_TITLE LIKE ? OR ZAR_ADDRESS LIKE ? OR ZAR_ARCHITECT LIKE ?)",f.push(`%${t.searchTerm}%`,`%${t.searchTerm}%`,`%${t.searchTerm}%`)),t.architect&&(o+=" AND (ZAR_ARCHITECT LIKE ? OR ZAR_ARCHITECT_ENG LIKE ?)",f.push(`%${t.architect}%`,`%${t.architect}%`)),t.yearFrom&&(o+=" AND ZAR_YEAR >= ?",f.push(t.yearFrom)),t.yearTo&&(o+=" AND ZAR_YEAR <= ?",f.push(t.yearTo)),t.tags&&t.tags.length>0&&(o+=" AND ZAR_TAG LIKE ?",f.push(`%${t.tags.join("%")}%`));const l=`
    SELECT *
    FROM ZCDARCHITECTURE
    WHERE ${o}
    LIMIT 500
  `;return Le(l,f)},vr=Object.freeze(Object.defineProperty({__proto__:null,getAllArchitectures:Wt,getArchitectureById:$t,getArchitectureForMap:_t},Symbol.toStringTag,{value:"Module"})),Ir=()=>{const[s,t]=x.useState([]),[o,f]=x.useState(!0),[l,j]=x.useState(0),[d,c]=x.useState(1),[n,u]=x.useState(""),[m,S]=x.useState(""),[W,_]=x.useState([]),[w,L]=x.useState([]),[T,Z]=x.useState([]),[g,y]=x.useState("year_desc"),[p,A]=x.useState({}),[D,K]=x.useState(null),[E,je]=x.useState(""),[ee,de]=x.useState({}),ne=12,q=Qe(),V=Ve();x.useEffect(()=>{(async()=>{try{Z([])}catch(b){console.error("タグ取得エラー:",b)}})()},[]),x.useEffect(()=>{const h=new URLSearchParams(q.search),b=h.get("tag"),I=h.get("search"),Y=h.get("year"),Q=h.get("prefecture"),F=h.get("category"),O=h.get("architect"),k=h.get("sort");if(k&&y(k),b){const v=b.split(",").map(a=>a.trim()).filter(a=>a),N=new Set,J=[];v.forEach(a=>{const C=a.match(/\d{4}年\d{1,2}月号?/);if(C){const R=a.replace(C[0],"").trim();R&&(N.add(R),J.push(a))}else N.add(a)}),_(Array.from(N)),L(J),S(b),u(`tag:${b}`),M(1,`tag:${b}`,k||g)}else Y?(u(`year:${Y}`),M(1,`year:${Y}`,k||g)):Q?(u(`prefecture:${Q}`),M(1,`prefecture:${Q}`,k||g)):F?(u(`category:${F}`),M(1,`category:${F}`,k||g)):O?(u(`architect:${O}`),M(1,`architect:${O}`,k||g)):I?(u(I),M(1,I,k||g)):M(1,n,k||g)},[q.search]);const M=async(h,b=n,I=g)=>{f(!0);try{const Y=await Wt(h,ne,b,I);t(Y.items),j(Y.total),c(h)}catch(Y){console.error("Error fetching architectures:",Y)}finally{f(!1)}},le=(h,b)=>{c(b),M(b,n,g),window.scrollTo(0,0)},ye=h=>{u(h.target.value)},he=async(h,b)=>{K(h.currentTarget),je(b);try{const I=[];de(Y=>({...Y,[b]:I}))}catch(I){console.error(`Failed to get years for tag ${b}:`,I)}},xe=()=>{K(null),je("")},Se=h=>{const b=h?`${E}${h}`:E;let I=[...w];const Y=I.findIndex(v=>v.startsWith(E)&&(v===E||v.match(new RegExp(`^${E}\\d{4}年\\d{1,2}月号?`))||v.match(new RegExp(`^${E}\\d{4}年度?`))||v.match(new RegExp(`^${E}第\\d+回`))||v.match(new RegExp(`^${E}\\(\\d{4}\\)`))));Y>=0?h?I[Y]=b:I.splice(Y,1):h&&I.push(b),L(I),xe();const Q=[...W];Q.includes(E)||Q.push(E);const F=[...Q,...I].filter((v,N,J)=>J.indexOf(v)===N&&!I.some(a=>a!==v&&a.startsWith(v))).join(",");S(F);const O=`tag:${F}`;u(O),M(1,O,g);const k=new URLSearchParams;k.set("tag",F),g!=="year_desc"&&k.set("sort",g),V({search:k.toString()})},we=(h,b)=>{const I=W.filter(F=>!b.includes(F));let Y=[...w].filter(F=>!I.some(O=>F.startsWith(O)));const Q=b.filter(F=>!W.includes(F));if(Q.length>0&&Q.forEach(async F=>{if(!ee[F])try{const O=[];if(de(k=>({...k,[F]:O})),O&&O.length===1){const k=`${F}${O[0]}`;Y.push(k)}}catch(O){console.error(`Failed to get years for tag ${F}:`,O)}}),_(b),L(Y),b.length>0||Y.length>0){const F=[...b,...Y].filter((v,N,J)=>J.indexOf(v)===N&&!Y.some(a=>a!==v&&a.startsWith(v))).join(",");S(F);const O=`tag:${F}`;u(O),M(1,O,g);const k=new URLSearchParams;k.set("tag",F),g!=="year_desc"&&k.set("sort",g),V({search:k.toString()})}else Ae()},ue=h=>{const b=h.target.value;y(b),M(d,n,b);const I=new URLSearchParams(q.search);I.set("sort",b),V({search:I.toString()})},me=()=>{c(1),M(1,n,g);const h=new URLSearchParams;if(g!=="year_desc"&&h.set("sort",g),n.startsWith("tag:")){const b=n.substring(4).trim();h.set("tag",b)}else if(n.startsWith("year:")){const b=n.substring(5).trim();h.set("year",b)}else if(n.startsWith("prefecture:")){const b=n.substring(11).trim();h.set("prefecture",b)}else if(n.startsWith("category:")){const b=n.substring(9).trim();h.set("category",b)}else if(n.startsWith("architect:")){const b=n.substring(10).trim();h.set("architect",b)}else n&&h.set("search",n);V({search:h.toString()})},Ae=()=>{S(""),u(""),_([]),L([]),c(1),M(1,"",g);const h=new URLSearchParams;g!=="year_desc"&&h.set("sort",g),V({search:h.toString()})},ce=Math.ceil(l/ne);return e.jsxs(se,{maxWidth:"lg",sx:{py:4},children:[e.jsx(i,{variant:"h4",component:"h1",gutterBottom:!0,children:"建築作品一覧"}),e.jsxs(ae,{sx:{p:3,mb:4},children:[e.jsxs(r,{sx:{display:"flex",flexDirection:{xs:"column",sm:"row"},gap:2,mb:3},children:[e.jsx(Te,{fullWidth:!0,label:"建築作品名、住所、建築家で検索",value:n,onChange:ye,onKeyPress:h=>h.key==="Enter"&&me(),InputProps:{startAdornment:e.jsx(et,{position:"start",children:e.jsx(Ge,{})})}}),e.jsx($,{variant:"contained",onClick:me,sx:{minWidth:"120px"},children:"検索"})]}),e.jsxs(r,{sx:{display:"flex",flexDirection:{xs:"column",md:"row"},gap:2,mb:3,alignItems:"flex-start"},children:[e.jsx(ft,{multiple:!0,id:"tags-selector",options:T,value:W,onChange:we,renderInput:h=>e.jsx(Te,{...h,variant:"outlined",label:"タグで絞り込み",placeholder:"タグを選択"}),renderTags:(h,b)=>h.map((I,Y)=>{const Q=w.some(v=>v.startsWith(I)&&v!==I),F=!!(ee[I]&&ee[I].length>0),O=w.find(v=>v.startsWith(I)&&v!==I);let k="";if(O){const v=O.substring(I.length);v.match(/\d{4}年\d{1,2}月号?/)?k=v.replace(/^(\d{4})/,(N,J)=>`'${J.substring(2)}`):v.match(/\d{4}年度?/)?k=v.replace(/^(\d{4})/,(N,J)=>`'${J.substring(2)}`):v.match(/第\d+回/)?k=v:v.match(/\(\d{4}\)/)?k=v.replace(/\((\d{4})\)/,(N,J)=>`'${J.substring(2)}`):k=v}return e.jsx(B,{label:e.jsxs(r,{sx:{display:"flex",alignItems:"center"},children:[I,O&&e.jsx(i,{variant:"caption",sx:{ml:.5,fontWeight:"bold",backgroundColor:"rgba(0, 0, 0, 0.08)",borderRadius:"4px",px:.5,py:.2},children:k}),F&&e.jsx(pt,{fontSize:"small"})]}),...b({index:Y}),color:Q?"primary":"default",variant:"outlined",onClick:v=>{v.stopPropagation(),he(v,I)},onDelete:v=>{b({index:Y}).onDelete(v)},sx:{maxWidth:"100%","& .MuiChip-label":{overflow:"hidden",whiteSpace:"nowrap",textOverflow:"ellipsis"}}},I)}),sx:{flex:2}}),e.jsxs(jt,{sx:{minWidth:200,flex:1},children:[e.jsx(yt,{id:"sort-select-label",children:"並び替え"}),e.jsxs(bt,{labelId:"sort-select-label",id:"sort-select",value:g,label:"並び替え",onChange:ue,startAdornment:e.jsx(et,{position:"start",children:e.jsx(Gt,{})}),children:[e.jsx(re,{value:"year_desc",children:"年代（新しい順）"}),e.jsx(re,{value:"year_asc",children:"年代（古い順）"}),e.jsx(re,{value:"name_asc",children:"名前（昇順）"}),e.jsx(re,{value:"name_desc",children:"名前（降順）"}),e.jsx(re,{value:"architect_asc",children:"建築家（昇順）"}),e.jsx(re,{value:"architect_desc",children:"建築家（降順）"})]})]})]}),e.jsx(Ct,{open:!!D,anchorEl:D,onClose:xe,anchorOrigin:{vertical:"bottom",horizontal:"left"},children:e.jsxs(r,{sx:{p:2,maxHeight:300,width:"250px",overflowY:"auto"},children:[e.jsxs(i,{variant:"subtitle2",sx:{mb:1},children:[E," の選択:"]}),e.jsxs(r,{sx:{display:"flex",flexDirection:"column",gap:1},children:[e.jsx(B,{label:"指定なし",onClick:()=>Se(""),variant:"outlined",size:"small",color:W.includes(E)&&!w.some(h=>h.startsWith(E)&&h!==E)?"primary":"default"}),ee[E]?.map(h=>{let b=h,I="default";return w.some(Y=>Y===`${E}${h}`)&&(I="primary"),e.jsx(B,{label:b,onClick:()=>Se(h),variant:"outlined",size:"small",color:I,sx:{overflow:"hidden",textOverflow:"ellipsis",maxWidth:"100%"}},h)})]})]})}),(m||n)&&e.jsx(r,{sx:{mb:3},children:e.jsx(nt,{severity:"info",action:e.jsx($,{color:"inherit",size:"small",onClick:Ae,children:"クリア"}),children:m?`タグ「${m}」で絞り込み中`:`「${n}」で検索中`})}),e.jsxs(r,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:2},children:[e.jsxs(i,{variant:"body2",color:"text.secondary",children:[l," 件の建築作品"]}),ce>1&&e.jsx(He,{count:ce,page:d,onChange:le,color:"primary",size:"small"})]})]}),o?e.jsx(r,{sx:{display:"flex",justifyContent:"center",py:4},children:e.jsx(Ee,{})}):e.jsxs(e.Fragment,{children:[s.length===0?e.jsxs(r,{sx:{textAlign:"center",py:4},children:[e.jsx(i,{variant:"h6",children:"建築作品が見つかりませんでした"}),e.jsx(i,{variant:"body2",color:"text.secondary",sx:{mt:1},children:"検索条件を変更してお試しください"})]}):e.jsx(H,{container:!0,spacing:3,children:s.map(h=>e.jsx(H,{item:!0,xs:12,sm:6,md:4,lg:3,children:e.jsx(fe,{sx:{height:"100%",display:"flex",flexDirection:"column",transition:"transform 0.2s","&:hover":{transform:"scale(1.02)"}},children:e.jsx(Ke,{component:z,to:`/architecture/${h.id}`,sx:{display:"flex",flexDirection:"column",alignItems:"flex-start",height:"100%"},children:e.jsxs(pe,{sx:{width:"100%",flexGrow:1},children:[e.jsx(i,{gutterBottom:!0,variant:"h6",component:"h2",children:h.name}),e.jsxs(r,{sx:{display:"flex",flexDirection:"column",gap:1,mt:2},children:[h.architectName&&e.jsxs(r,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(Tt,{fontSize:"small",color:"action"}),e.jsx(i,{variant:"body2",color:"text.secondary",children:h.architectName})]}),h.city&&e.jsxs(r,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(Ze,{fontSize:"small",color:"action"}),e.jsx(i,{variant:"body2",color:"text.secondary",children:h.city})]}),h.completedYear>0&&e.jsxs(r,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(Et,{fontSize:"small",color:"action"}),e.jsxs(i,{variant:"body2",color:"text.secondary",children:[h.completedYear,"年"]})]})]})]})})})},h.id))}),ce>1&&e.jsx(r,{sx:{display:"flex",justifyContent:"center",mt:4},children:e.jsx(He,{count:ce,page:d,onChange:le,color:"primary"})})]})]})};delete St.Icon.Default.prototype._getIconUrl;St.Icon.Default.mergeOptions({iconRetinaUrl:"https://unpkg.com/leaflet@1.7.1/dist/images/marker-icon-2x.png",iconUrl:"https://unpkg.com/leaflet@1.7.1/dist/images/marker-icon.png",shadowUrl:"https://unpkg.com/leaflet@1.7.1/dist/images/marker-shadow.png"});const Ue=({markers:s=[],center:t,zoom:o=13,height:f="500px",singleMarker:l})=>{const[j,d]=x.useState(t);return x.useEffect(()=>{l&&l.latitude&&l.longitude?d([l.latitude,l.longitude]):t&&d(t)},[l,t]),e.jsx("div",{style:{height:f,width:"100%",marginBottom:"20px"},children:e.jsxs(gr,{center:j,zoom:o,style:{height:"100%",width:"100%"},children:[e.jsx(fr,{attribution:'© <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors',url:"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png"}),s.map((c,n)=>c.latitude&&c.longitude?e.jsx(at,{position:[c.latitude,c.longitude],children:e.jsxs(it,{children:[e.jsx(i,{variant:"h6",children:c.name}),e.jsx(i,{variant:"body2",children:c.location}),e.jsx($,{component:z,to:`/architecture/${c.id}`,size:"small",variant:"outlined",sx:{mt:1},children:"詳細を見る"})]})},`marker-${c.id||n}`):null),l&&l.latitude&&l.longitude&&e.jsx(at,{position:[l.latitude,l.longitude],children:e.jsxs(it,{children:[e.jsx(i,{variant:"h6",children:l.name}),e.jsx(i,{variant:"body2",children:l.location})]})})]})})},Sr=()=>{const{id:s}=vt(),[t,o]=x.useState(null),[f,l]=x.useState(!0),[j,d]=x.useState(null),c=Ve();if(x.useEffect(()=>{(async()=>{l(!0);try{const L=await $t(s);if(!L)throw new Error("建築作品の取得に失敗しました");o(L)}catch(L){console.error("Error fetching work:",L),d(L.message)}finally{l(!1)}})()},[s]),f)return e.jsx(r,{sx:{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"60vh"},children:e.jsx(Ee,{})});if(j)return e.jsxs(se,{children:[e.jsxs(i,{variant:"h5",color:"error",sx:{textAlign:"center",my:4},children:["エラーが発生しました: ",j]}),e.jsx($,{variant:"contained",component:z,to:"/architecture",startIcon:e.jsx(Ye,{}),children:"建築作品一覧に戻る"})]});if(!t)return e.jsxs(se,{children:[e.jsx(i,{variant:"h5",sx:{textAlign:"center",my:4},children:"建築作品が見つかりませんでした"}),e.jsx($,{variant:"contained",component:z,to:"/architecture",startIcon:e.jsx(Ye,{}),children:"建築作品一覧に戻る"})]});const n=t.tag?t.tag.split(",").filter(w=>w.trim()!==""&&!w.includes("の追加建築")):[],u=n.find(w=>w.includes("新建築")),m=u?u.replace("新建築",""):"",S=w=>{console.log(`タグがクリックされました: ${w}`),c(`/architecture?tag=${encodeURIComponent(w)}`)},W=(w,L)=>{const T=`${w} ${L?.name||""} 建築`;return`https://www.google.com/search?q=${encodeURIComponent(T)}&tbm=isch`},_=w=>`https://ja.wikipedia.org/wiki/Special:Search?search=${encodeURIComponent(w)}`;return e.jsxs(se,{maxWidth:"lg",sx:{py:4},children:[e.jsx($,{variant:"outlined",component:z,to:"/architecture",startIcon:e.jsx(Ye,{}),sx:{mb:3},children:"建築作品一覧に戻る"}),e.jsxs(ae,{sx:{p:3,mb:4},children:[e.jsxs(r,{sx:{mb:2},children:[e.jsx(i,{variant:"h4",component:"h1",gutterBottom:!0,children:t.name||"無題"}),t.location&&e.jsxs(i,{variant:"subtitle1",color:"text.secondary",gutterBottom:!0,children:[e.jsx(Ze,{fontSize:"small",sx:{verticalAlign:"middle",mr:.5}}),t.location]}),e.jsxs(r,{sx:{display:"flex",flexWrap:"wrap",gap:1,mb:2},children:[t.completedYear!==0&&e.jsx(B,{icon:e.jsx(Et,{}),label:`${t.completedYear}年`,variant:"outlined",size:"small",onClick:()=>c(`/architecture?year=${t.completedYear}`),clickable:!0}),t.city&&e.jsx(B,{icon:e.jsx(Ze,{}),label:t.city,variant:"outlined",size:"small",onClick:()=>c(`/architecture?prefecture=${encodeURIComponent(t.city)}`),clickable:!0}),t.architect&&t.architect.name&&e.jsx(B,{icon:e.jsx(Tt,{}),label:t.architect.name,component:z,to:`/architects/${t.architect.id}`,clickable:!0,color:"primary",size:"small"}),t.bigCategory&&e.jsx(B,{icon:e.jsx(tt,{}),label:t.bigCategory,variant:"outlined",size:"small",onClick:()=>c(`/architecture?category=${encodeURIComponent(t.bigCategory)}`),clickable:!0}),t.category&&t.category!==t.bigCategory&&e.jsx(B,{icon:e.jsx(tt,{}),label:t.category,variant:"outlined",size:"small",onClick:()=>c(`/architecture?category=${encodeURIComponent(t.category)}`),clickable:!0})]}),n.length>0&&e.jsx(r,{sx:{display:"flex",flexWrap:"wrap",gap:1,mb:2},children:n.map((w,L)=>e.jsx(B,{icon:e.jsx(At,{}),label:w,onClick:()=>S(w),clickable:!0,color:"secondary",variant:"outlined",size:"small"},L))})]}),e.jsx(qe,{sx:{my:3}}),e.jsxs(r,{sx:{mb:3,display:"flex",flexDirection:"row",gap:1},children:[t.shinkenchikuUrl&&e.jsx(Ce,{title:"新建築データで見る",children:e.jsxs($,{variant:"contained",href:t.shinkenchikuUrl,target:"_blank",rel:"noopener noreferrer",size:"small",sx:{backgroundColor:"#003366",color:"#ffffff","&:hover":{backgroundColor:"#002244"}},children:[e.jsx(r,{sx:{display:"flex",alignItems:"center",justifyContent:"center",mr:.5},children:e.jsx("img",{src:"https://data.shinkenchiku.online/favicon.ico",alt:"新建築データ",style:{height:"16px",width:"auto",marginRight:"4px"}})}),m&&e.jsx(i,{variant:"caption",children:m})]})}),e.jsx(Ce,{title:"Google画像検索",children:e.jsx($,{href:W(t.name,t.architect),target:"_blank",rel:"noopener noreferrer",startIcon:e.jsx(Kt,{}),variant:"contained",size:"small",sx:{backgroundColor:"#4285F4",color:"#ffffff","&:hover":{backgroundColor:"#3367D6"}},children:"画像"})}),e.jsx(Ce,{title:"Wikipediaで検索",children:e.jsx($,{href:_(t.name),target:"_blank",rel:"noopener noreferrer",startIcon:e.jsx(qt,{}),variant:"contained",size:"small",sx:{backgroundColor:"#333333",color:"#ffffff","&:hover":{backgroundColor:"#222222"}},children:"Wikipedia"})})]}),t.description&&e.jsxs(r,{sx:{mt:3},children:[e.jsx(i,{variant:"h6",gutterBottom:!0,children:"概要"}),e.jsx(i,{variant:"body1",paragraph:!0,sx:{whiteSpace:"pre-line"},children:t.description})]}),t.latitude&&t.longitude&&e.jsxs(r,{sx:{mt:3},children:[e.jsx(i,{variant:"h6",gutterBottom:!0,children:"位置情報"}),e.jsx(r,{sx:{height:"400px",width:"100%",mt:2,border:"1px solid #eee",borderRadius:"4px",overflow:"hidden"},children:e.jsx(Ue,{singleMarker:{id:t.id||0,latitude:t.latitude,longitude:t.longitude,name:t.name,location:t.location},center:[t.latitude,t.longitude],zoom:15})})]})]})]})},wr=async s=>Je("SELECT * FROM ZCDARCHITECT WHERE ZAR_ID = ?",[s]),Rr=async(s=1,t=12,o="",f=[],l="ZAR_NAME",j="asc",d={})=>{const c=(s-1)*t;let n="1=1";const u=[];o&&(n+=" AND (ZAR_NAME LIKE ? OR ZAR_KANA LIKE ? OR ZAR_NAMEENG LIKE ?)",u.push(`%${o}%`,`%${o}%`,`%${o}%`)),d.nationality&&(n+=" AND ZAR_NATIONALITY = ?",u.push(d.nationality)),d.category&&(n+=" AND ZAR_CATEGORY = ?",u.push(d.category)),d.school&&(n+=" AND ZAR_SCHOOL = ?",u.push(d.school)),d.birthYearFrom&&(n+=" AND ZAR_BIRTHYEAR >= ?",u.push(d.birthYearFrom)),d.birthYearTo&&(n+=" AND ZAR_BIRTHYEAR <= ?",u.push(d.birthYearTo)),d.deathYear&&(n+=" AND ZAR_DEATHYEAR = ?",u.push(d.deathYear));let m="";f&&f.length>0&&(m=`
      INNER JOIN ZCDARCHITECT_TAG ON ZCDARCHITECT.ZAR_ID = ZCDARCHITECT_TAG.ARCHITECT_ID
      INNER JOIN ZCDTAG ON ZCDARCHITECT_TAG.TAG_ID = ZCDTAG.TAG_ID
    `,n+=" AND ZCDTAG.TAG_NAME IN (",n+=f.map(()=>"?").join(","),n+=")",u.push(...f));const S=`
    SELECT COUNT(DISTINCT ZCDARCHITECT.ZAR_ID) as total
    FROM ZCDARCHITECT
    ${m}
    WHERE ${n}
  `,W=`
    SELECT DISTINCT ZCDARCHITECT.*
    FROM ZCDARCHITECT
    ${m}
    WHERE ${n}
    ORDER BY ${l} ${j==="desc"?"DESC":"ASC"}
    LIMIT ? OFFSET ?
  `,_=[...u,t,c];try{const L=(await Je(S,u))?.total||0;return{results:await Le(W,_),total:L,page:s,limit:t,totalPages:Math.ceil(L/t)}}catch(w){throw console.error("建築家データ取得エラー:",w),w}},Dr=async()=>Le(`
    SELECT TAG_ID, TAG_NAME, COUNT(ARCHITECT_ID) as TAG_COUNT
    FROM ZCDTAG
    LEFT JOIN ZCDARCHITECT_TAG ON ZCDTAG.TAG_ID = ZCDARCHITECT_TAG.TAG_ID
    GROUP BY ZCDTAG.TAG_ID, ZCDTAG.TAG_NAME
    ORDER BY TAG_COUNT DESC, TAG_NAME
  `),kr=()=>{console.log("ArchitectsPage コンポーネントがレンダリングされました");const[s,t]=x.useState([]),[o,f]=x.useState(!0),[l,j]=x.useState(0),[d,c]=x.useState(0),[n,u]=x.useState(1),[m,S]=x.useState(""),[W,_]=x.useState([]),[w,L]=x.useState([]),[T,Z]=x.useState([]),[g,y]=x.useState("name"),[p,A]=x.useState("asc"),[D,K]=x.useState(null),[E,je]=x.useState(""),[ee,de]=x.useState({}),[ne,q]=x.useState(""),[V,M]=x.useState(""),[le,ye]=x.useState(""),[he,xe]=x.useState(""),[Se,we]=x.useState(""),[ue,me]=x.useState(""),Ae=Ve(),ce=Qe(),h=new URLSearchParams(ce.search);x.useEffect(()=>{console.log("tagMenuAnchorEl 状態変更:",!!D)},[D]),x.useEffect(()=>{console.log("タグ読み込みのuseEffectが実行されました"),(async()=>{try{console.log("建築家タグ取得開始");const C=await Dr();console.log("取得した建築家タグ:",C),Z(["国籍","カテゴリー","学校","生年","没年"])}catch(C){console.error("タグ取得エラー:",C)}})()},[]),x.useEffect(()=>{console.log("建築家データ読み込みのuseEffectが実行されました",ce.search),(async()=>{f(!0);try{const C=parseInt(h.get("page")||"1"),R=h.get("search")||"",X=h.get("tags")?h.get("tags").split(","):[],P=h.get("sortBy")||"name",U=h.get("sortOrder")||"asc",oe=h.get("nationality")||"",Oe=h.get("category")||"",Be=h.get("school")||"",Re=h.get("birthYearFrom")||"",De=h.get("birthYearTo")||"",ke=h.get("deathYear")||"";console.log("URLから読み取ったパラメータ:",{page:C,search:R,tags:X,sort:P,order:U,nat:oe,cat:Oe,sch:Be,birthFrom:Re,birthTo:De,death:ke}),u(C),S(R),_(X),y(P),A(U),q(oe),M(Oe),ye(Be),xe(Re),we(De),me(ke),console.log("建築家データ取得開始:",{page:C,search:R,tags:X,sort:P,order:U,nat:oe,cat:Oe,sch:Be,birthFrom:Re,birthTo:De,death:ke});const Pe=await Rr(C,10,R,X,P,U,oe,Oe,Be,Re?parseInt(Re):0,De?parseInt(De):0,ke?parseInt(ke):0);console.log("取得した建築家データ:",Pe),t(Pe.items),j(Pe.totalPages),c(Pe.total)}catch(C){console.error("建築家データ取得エラー:",C)}finally{f(!1)}})()},[ce.search]);const b=async a=>{console.log(`${a}の年度取得開始`);let C="";if(a==="国籍"?C="SELECT DISTINCT ZAT_NATIONALITY as value FROM ZCDARCHITECT WHERE ZAT_NATIONALITY != '' ORDER BY ZAT_NATIONALITY":a==="カテゴリー"?C="SELECT DISTINCT ZAT_CATEGORY as value FROM ZCDARCHITECT WHERE ZAT_CATEGORY != '' ORDER BY ZAT_CATEGORY":a==="学校"?C="SELECT DISTINCT ZAT_SCHOOL as value FROM ZCDARCHITECT WHERE ZAT_SCHOOL != '' ORDER BY ZAT_SCHOOL":a==="生年"?C="SELECT DISTINCT ZAT_BIRTHYEAR as value FROM ZCDARCHITECT WHERE ZAT_BIRTHYEAR > 0 ORDER BY ZAT_BIRTHYEAR DESC":a==="没年"&&(C="SELECT DISTINCT ZAT_DEATHYEAR as value FROM ZCDARCHITECT WHERE ZAT_DEATHYEAR > 0 ORDER BY ZAT_DEATHYEAR DESC"),!C)return[];try{return(await Le(C)).map(X=>String(X.value)).filter(Boolean)}catch(R){return console.error(`${a}の値取得エラー:`,R),[]}},I=async(a,C)=>{if(console.log(`${C}の年度メニューを開く`,a.currentTarget),K(a.currentTarget),je(C),!ee[C])try{const R=await b(C);console.log(`取得した${C}の年度:`,R),de(X=>({...X,[C]:R}))}catch(R){console.error(`${C}の年度取得エラー:`,R)}},Y=()=>{console.log("年度メニューを閉じる"),K(null),je("")},Q=a=>{console.log(`年度選択: ${a} (タグ: ${E})`),E==="国籍"?q(a):E==="カテゴリー"?M(a):E==="学校"?ye(a):E==="生年"?xe(a):E==="没年"&&me(a),Y(),N()},F=(a,C)=>{console.log("タグ選択変更:",C),_(C);const R=W.filter(P=>!C.includes(P));for(const P of R)P==="国籍"?q(""):P==="カテゴリー"?M(""):P==="学校"?ye(""):P==="生年"?(xe(""),we("")):P==="没年"&&me("");const X=C.filter(P=>!W.includes(P));X.length>0&&X.forEach(async P=>{if(!ee[P])try{const U=await b(P);de(oe=>({...oe,[P]:U}))}catch(U){console.error(`${P}の年度取得エラー:`,U)}}),N()},O=(a,C)=>{console.log(`ページ変更: ${C}`),u(C);const R=new URLSearchParams(ce.search);R.set("page",C.toString()),Ae({search:R.toString()})},k=()=>{console.log(`検索実行: ${m}`),N()},v=()=>{console.log("検索条件をクリア"),S(""),_([]),L([]),q(""),M(""),ye(""),xe(""),we(""),me(""),u(1);const a=new URLSearchParams;g!=="name"&&a.set("sortBy",g),p!=="asc"&&a.set("sortOrder",p),Ae({search:a.toString()})},N=()=>{console.log("URLと検索を更新");const a=new URLSearchParams;n>1&&a.set("page",n.toString()),m&&a.set("search",m),W.length>0&&a.set("tags",W.join(",")),g!=="name"&&a.set("sortBy",g),p!=="asc"&&a.set("sortOrder",p),ne&&a.set("nationality",ne),V&&a.set("category",V),le&&a.set("school",le),he&&a.set("birthYearFrom",he),Se&&a.set("birthYearTo",Se),ue&&a.set("deathYear",ue),console.log("新しいURLパラメータ:",a.toString()),Ae({search:a.toString()})},J=()=>{const a=[];return ne&&a.push({label:`国籍: ${ne}`,onDelete:()=>{q(""),N()}}),he&&a.push({label:`生年: ${he}`,onDelete:()=>{xe(""),N()}}),ue&&a.push({label:`没年: ${ue}`,onDelete:()=>{me(""),N()}}),V&&a.push({label:`カテゴリー: ${V}`,onDelete:()=>{M(""),N()}}),le&&a.push({label:`学校: ${le}`,onDelete:()=>{ye(""),N()}}),a.length===0&&!m&&W.length===0?null:e.jsx(r,{sx:{mb:3},children:e.jsx(nt,{severity:"info",action:e.jsx($,{color:"inherit",size:"small",onClick:v,children:"クリア"}),children:a.length>0?`フィルター: ${a.map(C=>C.label).join(", ")}`:m?`「${m}」で検索中`:W.length>0?`タグ「${W.join(", ")}」で絞り込み中`:""})})};return e.jsxs(se,{maxWidth:"lg",sx:{py:4},children:[e.jsx(i,{variant:"h4",component:"h1",gutterBottom:!0,children:"建築家一覧"}),e.jsxs(ae,{sx:{p:3,mb:4},children:[e.jsxs(r,{sx:{display:"flex",flexDirection:{xs:"column",sm:"row"},gap:2,mb:3},children:[e.jsx(Te,{fullWidth:!0,label:"建築家名、国籍、カテゴリーで検索",value:m,onChange:a=>S(a.target.value),onKeyPress:a=>a.key==="Enter"&&k(),InputProps:{startAdornment:e.jsx(et,{position:"start",children:e.jsx(Ge,{})})}}),e.jsx($,{variant:"contained",onClick:k,sx:{minWidth:"120px"},children:"検索"})]}),e.jsxs(r,{sx:{display:"flex",flexDirection:{xs:"column",md:"row"},gap:2,mb:3,alignItems:"flex-start"},children:[e.jsx(ft,{multiple:!0,id:"tags-selector",options:T,value:W,onChange:F,fullWidth:!0,renderInput:a=>e.jsx(Te,{...a,variant:"outlined",label:"タグで絞り込み",placeholder:"タグを選択"}),renderTags:(a,C)=>a.map((R,X)=>{const P=!!(ee[R]&&ee[R].length>0);let U="";return R==="国籍"?U=ne:R==="カテゴリー"?U=V:R==="学校"?U=le:R==="生年"?U=he:R==="没年"&&(U=ue),e.jsx(B,{label:e.jsxs(r,{sx:{display:"flex",alignItems:"center"},children:[R,U&&e.jsx(i,{variant:"caption",sx:{ml:.5,fontWeight:"bold",backgroundColor:"rgba(0, 0, 0, 0.08)",borderRadius:"4px",px:.5,py:.2},children:U}),P&&e.jsx(pt,{fontSize:"small"})]}),...C({index:X}),color:U?"primary":"default",variant:"outlined",onClick:oe=>{oe.stopPropagation(),I(oe,R)},onDelete:oe=>{C({index:X}).onDelete(oe)},sx:{maxWidth:"100%","& .MuiChip-label":{overflow:"hidden",whiteSpace:"nowrap"}}},R)})}),e.jsxs(jt,{sx:{minWidth:200},children:[e.jsx(yt,{id:"sort-select-label",children:"並び替え"}),e.jsxs(bt,{labelId:"sort-select-label",value:`${g}_${p}`,label:"並び替え",onChange:a=>{const[C,R]=a.target.value.split("_");y(C),A(R),N()},children:[e.jsx(re,{value:"name_asc",children:"名前 (昇順)"}),e.jsx(re,{value:"name_desc",children:"名前 (降順)"}),e.jsx(re,{value:"birthYear_asc",children:"生年 (昇順)"}),e.jsx(re,{value:"birthYear_desc",children:"生年 (降順)"}),e.jsx(re,{value:"nationality_asc",children:"国籍 (昇順)"}),e.jsx(re,{value:"nationality_desc",children:"国籍 (降順)"})]})]})]}),e.jsx(Ct,{open:!!D,anchorEl:D,onClose:Y,anchorOrigin:{vertical:"bottom",horizontal:"left"},transformOrigin:{vertical:"top",horizontal:"left"},children:e.jsxs(r,{sx:{p:2,width:300,maxHeight:400,overflow:"auto"},children:[e.jsx(i,{variant:"subtitle1",gutterBottom:!0,children:E==="国籍"?"国籍を選択":E==="カテゴリー"?"カテゴリーを選択":E==="学校"?"学校を選択":E==="生年"?"生年を選択":E==="没年"?"没年を選択":"タグ値を選択"}),e.jsxs(r,{sx:{display:"flex",flexWrap:"wrap",gap:1,mt:1},children:[e.jsx(B,{label:"指定なし",onClick:()=>Q(""),variant:"outlined",size:"small",sx:{mb:1}}),ee[E]?.map(a=>e.jsx(B,{label:a,onClick:()=>Q(a),variant:"outlined",size:"small",color:E==="国籍"&&a===ne||E==="カテゴリー"&&a===V||E==="学校"&&a===le||E==="生年"&&a===he||E==="没年"&&a===ue?"primary":"default",sx:{overflow:"hidden",textOverflow:"ellipsis",maxWidth:"100%"}},a))]})]})}),e.jsx(J,{}),e.jsxs(r,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:2},children:[e.jsxs(i,{variant:"body2",color:"text.secondary",children:[d,"人の建築家"]}),l>1&&e.jsx(He,{count:l,page:n,onChange:O,color:"primary",size:"small"})]})]}),o?e.jsx(r,{sx:{display:"flex",justifyContent:"center",py:4},children:e.jsx(Ee,{})}):e.jsxs(e.Fragment,{children:[s.length===0?e.jsxs(r,{sx:{textAlign:"center",py:4},children:[e.jsx(i,{variant:"h6",children:"建築家が見つかりませんでした"}),e.jsx(i,{variant:"body2",color:"text.secondary",sx:{mt:1},children:"検索条件を変更してお試しください"})]}):e.jsx(H,{container:!0,spacing:3,children:s.map(a=>e.jsx(H,{item:!0,xs:12,sm:6,md:4,children:e.jsx(fe,{sx:{height:"100%",display:"flex",flexDirection:"column",transition:"transform 0.2s","&:hover":{transform:"scale(1.02)"}},children:e.jsx(Ke,{component:z,to:`/architects/${a.id}`,children:e.jsxs(pe,{children:[e.jsx(i,{variant:"h6",component:"div",gutterBottom:!0,children:a.name}),e.jsxs(i,{variant:"body2",color:"text.secondary",gutterBottom:!0,children:[a.nationality," • ",a.birthYear||"?","-",a.deathYear||"現在"]}),e.jsx(r,{sx:{display:"flex",flexWrap:"wrap",gap:.5,mt:1},children:a.tags&&a.tags.map(C=>e.jsx(B,{label:C,size:"small",variant:"outlined",sx:{pointerEvents:"none"}},C))})]})})})},a.id))}),l>1&&e.jsx(r,{sx:{display:"flex",justifyContent:"center",mt:4},children:e.jsx(He,{count:l,page:n,onChange:O,color:"primary"})})]})]})},$r=({architectures:s,compact:t=!1})=>!s||s.length===0?e.jsx(i,{variant:"body2",color:"text.secondary",children:"登録されている作品はありません。"}):e.jsx(H,{container:!0,spacing:t?2:3,children:s.map(o=>e.jsx(H,{item:!0,xs:12,sm:6,md:t?6:4,children:e.jsx(fe,{sx:{height:"100%",display:"flex",flexDirection:"column",transition:"transform 0.2s","&:hover":{transform:"scale(1.02)"}},children:e.jsx(Ke,{component:z,to:`/architecture/${o.id}`,sx:{flexGrow:1},children:e.jsxs(pe,{children:[e.jsx(i,{gutterBottom:!0,variant:"h6",component:"h2",children:o.name}),o.completedYear>0&&e.jsxs(r,{sx:{display:"flex",alignItems:"center",mb:1},children:[e.jsx(Qt,{fontSize:"small",sx:{mr:1,color:"text.secondary"}}),e.jsxs(i,{variant:"body2",color:"text.secondary",children:[o.completedYear,"年"]})]}),(o.city||o.location)&&e.jsxs(r,{sx:{display:"flex",alignItems:"center",mb:1},children:[e.jsx(Ze,{fontSize:"small",sx:{mr:1,color:"text.secondary"}}),e.jsxs(i,{variant:"body2",color:"text.secondary",children:[o.city?o.city:"",o.city&&o.location?" / ":"",o.location?o.location:""]})]}),o.tag&&e.jsx(r,{sx:{display:"flex",flexWrap:"wrap",gap:.5,mt:1},children:o.tag.split(",").filter(f=>f.trim()!==""&&!f.includes("の追加建築")).map((f,l)=>e.jsx(B,{label:f.trim(),size:"small",color:"secondary",variant:"outlined",sx:{height:"20px",fontSize:"0.65rem"}},l))})]})})})},o.id))}),Wr=()=>e.jsx(r,{component:"span",sx:{display:"inline-flex",alignItems:"center",justifyContent:"center",width:24,height:24},children:e.jsx(i,{variant:"caption",component:"span",sx:{fontFamily:"serif",fontWeight:"bold",fontSize:"16px"},children:"W"})}),_r=()=>{const{id:s}=vt(),[t,o]=x.useState(null),[f,l]=x.useState(!0),[j,d]=x.useState(null),[c,n]=x.useState([]),u=Ve();x.useEffect(()=>{s&&(async()=>{l(!0);try{const y=await wr(parseInt(s));if(!y){d("建築家情報が見つかりませんでした。"),l(!1);return}o(y);const p=[];if(y.teacher1){const A={name:y.teacher1,id:null};try{A.id=await m(y.teacher1)}catch(D){console.error("教師情報の取得に失敗:",D)}p.push(A)}if(y.teacher2){const A={name:y.teacher2,id:null};try{A.id=await m(y.teacher2)}catch(D){console.error("教師情報の取得に失敗:",D)}p.push(A)}if(y.teacher3){const A={name:y.teacher3,id:null};try{A.id=await m(y.teacher3)}catch(D){console.error("教師情報の取得に失敗:",D)}p.push(A)}n(p)}catch(y){console.error("建築家データ取得エラー:",y),d("建築家情報の読み込み中にエラーが発生しました。")}finally{l(!1)}})()},[s]);const m=async g=>null,S=()=>{if(!t)return null;const g=[];if(t.school){let y=t.school;t.faculty&&(y+=` ${t.faculty}`),g.push(y)}return t.schoolAbroad&&g.push(t.schoolAbroad),g.length>0?g.join("、"):null},W=()=>!c||c.length===0?null:c.map((g,y)=>e.jsxs("span",{children:[y>0&&"、",g.id?e.jsx(ar,{component:z,to:`/architects/${g.id}`,color:"inherit",underline:"hover",children:g.name}):g.name]},y)),_=(g,y)=>{if(!y)return;let p="";switch(g){case"nationality":p=`nationality=${encodeURIComponent(y)}`;break;case"born":p=`birthyear_from=${encodeURIComponent(y)}&birthyear_to=${encodeURIComponent(y)}`;break;case"died":p=`deathyear=${encodeURIComponent(y)}`;break;case"category":p=`category=${encodeURIComponent(y)}`;break;default:return}u(`/architects?${p}`)},w=(g,y)=>{const p=`${g} ${y||""} 建築家`;return`https://www.google.com/search?q=${encodeURIComponent(p)}`},L=g=>`https://ja.wikipedia.org/wiki/Special:Search?search=${encodeURIComponent(g)}`;if(f)return e.jsx(se,{maxWidth:"lg",sx:{py:4},children:e.jsx(r,{sx:{display:"flex",justifyContent:"center",py:8},children:e.jsx(Ee,{})})});if(j||!t)return e.jsx(se,{maxWidth:"lg",sx:{py:4},children:e.jsxs(ae,{sx:{p:3},children:[e.jsx(i,{variant:"h5",color:"error",gutterBottom:!0,children:"エラー"}),e.jsx(i,{paragraph:!0,children:j||"建築家情報が見つかりませんでした。"}),e.jsx($,{variant:"outlined",startIcon:e.jsx(Ye,{}),onClick:()=>u(-1),children:"戻る"})]})});const T=new Set;t.works&&t.works.forEach(g=>{g.tag&&g.tag.split(",").forEach(p=>{const A=p.trim();A&&!A.includes("の追加建築")&&T.add(A)})});const Z=[];if(t.nationality&&Z.push(`nationality:${t.nationality}`),t.birthYear>0){const g=Math.floor(t.birthYear/10)*10;Z.push(`born:${g}s`)}return t.deathYear>0&&Z.push(`died:${t.deathYear}`),t.category&&Z.push(`category:${t.category}`),t.school&&Z.push(`school:${t.school}`),e.jsxs(se,{maxWidth:"lg",sx:{py:4},children:[e.jsx($,{variant:"outlined",component:z,to:"/architects",startIcon:e.jsx(Ye,{}),sx:{mb:3},children:"建築家一覧に戻る"}),e.jsxs(ae,{sx:{p:3,mb:4},children:[e.jsx(i,{variant:"h4",component:"h1",gutterBottom:!0,children:t.name||"不明"}),e.jsxs(r,{sx:{display:"flex",flexWrap:"wrap",gap:2,my:3},children:[t.nationality&&e.jsx(B,{icon:e.jsx(Vt,{}),label:`nationality:${t.nationality}`,variant:"outlined",onClick:()=>_("nationality",t.nationality),clickable:!0}),t.birthYear>0&&e.jsx(B,{icon:e.jsx(Jt,{}),label:`born:${Math.floor(t.birthYear/10)*10}s`,variant:"outlined",onClick:()=>_("born",Math.floor(t.birthYear/10)*10),clickable:!0}),t.deathYear>0&&e.jsx(B,{icon:e.jsx(Xt,{}),label:`died:${t.deathYear}`,variant:"outlined",onClick:()=>_("died",t.deathYear),clickable:!0}),t.category&&e.jsx(B,{icon:e.jsx(tt,{}),label:`category:${t.category}`,variant:"outlined",onClick:()=>_("category",t.category),clickable:!0}),t.office&&e.jsx(B,{icon:e.jsx(er,{}),label:t.office,variant:"outlined"})]}),e.jsx(qe,{sx:{my:3}}),e.jsxs(r,{sx:{mb:3,display:"flex",flexDirection:"row",gap:1},children:[t.website&&e.jsx(Ce,{title:"公式ホームページ",children:e.jsx($,{href:t.website.startsWith("http")?t.website:`http://${t.website}`,target:"_blank",rel:"noopener noreferrer",startIcon:e.jsx(tr,{}),variant:"contained",size:"small",sx:{backgroundColor:"#4caf50",color:"#ffffff","&:hover":{backgroundColor:"#388e3c"}},children:"ホームページ"})}),e.jsx(Ce,{title:"Google検索",children:e.jsx($,{href:w(t.name,t.nationality),target:"_blank",rel:"noopener noreferrer",startIcon:e.jsx(Ge,{}),variant:"contained",size:"small",sx:{backgroundColor:"#4285F4",color:"#ffffff","&:hover":{backgroundColor:"#3367D6"}},children:"検索"})}),e.jsx(Ce,{title:"Wikipediaで検索",children:e.jsx($,{href:L(t.name),target:"_blank",rel:"noopener noreferrer",startIcon:e.jsx(Wr,{}),variant:"contained",size:"small",sx:{backgroundColor:"#333333",color:"#ffffff","&:hover":{backgroundColor:"#222222"}},children:"Wikipedia"})})]}),e.jsx(rr,{component:ae,variant:"outlined",sx:{mb:4},children:e.jsx(sr,{children:e.jsxs(nr,{children:[t.nationality&&e.jsxs(ge,{children:[e.jsx(G,{component:"th",sx:{width:"30%",bgcolor:"rgba(0, 0, 0, 0.03)"},children:e.jsx(i,{variant:"subtitle2",children:"国籍"})}),e.jsx(G,{children:t.nationality})]}),(t.birthYear>0||t.deathYear>0)&&e.jsxs(ge,{children:[e.jsx(G,{component:"th",sx:{width:"30%",bgcolor:"rgba(0, 0, 0, 0.03)"},children:e.jsx(i,{variant:"subtitle2",children:"生年 - 没年"})}),e.jsxs(G,{children:[t.birthYear>0?`${t.birthYear}年`:"不明",t.deathYear>0?` - ${t.deathYear}年`:""]})]}),t.office&&e.jsxs(ge,{children:[e.jsx(G,{component:"th",sx:{width:"30%",bgcolor:"rgba(0, 0, 0, 0.03)"},children:e.jsx(i,{variant:"subtitle2",children:"事務所"})}),e.jsx(G,{children:t.office})]}),t.prefecture&&e.jsxs(ge,{children:[e.jsx(G,{component:"th",sx:{width:"30%",bgcolor:"rgba(0, 0, 0, 0.03)"},children:e.jsx(i,{variant:"subtitle2",children:"拠点"})}),e.jsx(G,{children:t.prefecture})]}),t.nameEn&&e.jsxs(ge,{children:[e.jsx(G,{component:"th",sx:{width:"30%",bgcolor:"rgba(0, 0, 0, 0.03)"},children:e.jsx(i,{variant:"subtitle2",children:"英語表記"})}),e.jsx(G,{children:t.nameEn})]}),(t.school||t.faculty||t.schoolAbroad)&&e.jsxs(ge,{children:[e.jsx(G,{component:"th",sx:{width:"30%",bgcolor:"rgba(0, 0, 0, 0.03)"},children:e.jsx(i,{variant:"subtitle2",children:"教育背景"})}),e.jsx(G,{children:e.jsxs(r,{sx:{display:"flex",alignItems:"center"},children:[e.jsx(or,{sx:{mr:1,fontSize:"1rem",color:"text.secondary"}}),e.jsx(i,{variant:"body2",children:S()})]})})]}),(t.teacher1||t.teacher2||t.teacher3)&&e.jsxs(ge,{children:[e.jsx(G,{component:"th",sx:{width:"30%",bgcolor:"rgba(0, 0, 0, 0.03)"},children:e.jsx(i,{variant:"subtitle2",children:"師事した建築家"})}),e.jsx(G,{children:e.jsx(r,{sx:{display:"flex",flexDirection:"column",gap:1},children:W()})})]}),t.category&&e.jsxs(ge,{children:[e.jsx(G,{component:"th",sx:{width:"30%",bgcolor:"rgba(0, 0, 0, 0.03)"},children:e.jsx(i,{variant:"subtitle2",children:"カテゴリー"})}),e.jsx(G,{children:t.category})]})]})})}),T.size>0&&e.jsxs(r,{sx:{mb:4},children:[e.jsx(i,{variant:"h6",gutterBottom:!0,children:"受賞歴・選定"}),e.jsx(r,{sx:{display:"flex",flexWrap:"wrap",gap:1,mb:2},children:Array.from(T).map((g,y)=>e.jsx(B,{icon:e.jsx(At,{}),label:String(g),onClick:()=>_("category",g),clickable:!0,color:"secondary",variant:"outlined",size:"small"},y))})]}),t.bio&&e.jsxs(r,{sx:{mb:4},children:[e.jsx(i,{variant:"h6",gutterBottom:!0,children:"経歴"}),e.jsx(i,{variant:"body1",sx:{whiteSpace:"pre-line"},children:t.bio})]}),t.works&&t.works.length>0&&e.jsxs(e.Fragment,{children:[e.jsxs(r,{sx:{mb:4},children:[e.jsx(i,{variant:"h6",gutterBottom:!0,children:"作品マップ"}),t.works.some(g=>g.latitude&&g.longitude)?e.jsx(r,{sx:{height:"400px",width:"100%",mb:3,border:"1px solid #eee",borderRadius:"4px",overflow:"hidden"},children:e.jsx(Ue,{markers:t.works.filter(g=>g.latitude&&g.longitude),zoom:5,center:[t.works[0].latitude||35.6762,t.works[0].longitude||139.6503]})}):e.jsx(i,{variant:"body2",color:"text.secondary",children:"位置情報が登録されている作品がありません。"})]}),e.jsxs(r,{sx:{mb:4},children:[e.jsx(i,{variant:"h6",gutterBottom:!0,children:"代表作品"}),e.jsx($r,{architectures:t.works})]})]})]})]})},Yr=()=>{const[s,t]=x.useState(!0),[o,f]=x.useState([]),[l,j]=x.useState([]),[d,c]=x.useState({yearFrom:"",yearTo:""}),[n,u]=x.useState(!1),[m,S]=x.useState(null),[W,_]=x.useState(!1);x.useEffect(()=>{L()},[]);const w=p=>{if(!p||p.length===0)return{from:0,to:0};const A=p.filter(q=>q.completedYear>0);if(A.length===0)return{from:0,to:0};const D=A.map(q=>q.completedYear).sort((q,V)=>q-V),K=D[0],E=D[D.length-1],je=Math.min(100,Math.floor((E-K)/2)),ee=Math.floor(Math.random()*(D.length-Math.floor(D.length/4))),de=D[ee],ne=Math.min(de+je,E);return{from:de,to:ne}},L=async()=>{t(!0);try{const p=await _t();if(j(p),!d.yearFrom&&!d.yearTo){const A=w(p);c({yearFrom:A.from.toString(),yearTo:A.to.toString()});const D=p.filter(K=>K.completedYear>=A.from&&K.completedYear<=A.to);f(D)}else{let A=p;d.yearFrom&&(A=A.filter(D=>D.completedYear>=parseInt(d.yearFrom))),d.yearTo&&(A=A.filter(D=>D.completedYear<=parseInt(d.yearTo))),f(A)}}catch(p){console.error("Error fetching works:",p)}finally{t(!1)}},T=p=>{const{name:A,value:D}=p.target;c({...d,[A]:D})},Z=()=>{t(!0);let p=l;d.yearFrom&&(p=p.filter(A=>A.completedYear>=parseInt(d.yearFrom))),d.yearTo&&(p=p.filter(A=>A.completedYear<=parseInt(d.yearTo))),f(p),t(!1)},g=()=>{c({yearFrom:"",yearTo:""}),f(l)},y=p=>{S(p),_(!0)};return e.jsxs(se,{maxWidth:"lg",sx:{py:4},children:[e.jsx(i,{variant:"h4",component:"h1",gutterBottom:!0,children:"建築地図"}),e.jsxs(ae,{sx:{p:3,mb:4},children:[e.jsx($,{startIcon:e.jsx(ir,{}),onClick:()=>u(!n),sx:{mb:2},children:n?"フィルターを閉じる":"フィルターを表示"}),n&&e.jsx(r,{sx:{mb:2},children:e.jsxs(H,{container:!0,spacing:2,children:[e.jsx(H,{item:!0,xs:12,sm:6,md:4,children:e.jsx(Te,{fullWidth:!0,label:"年代（から）",name:"yearFrom",type:"number",value:d.yearFrom,onChange:T})}),e.jsx(H,{item:!0,xs:12,sm:6,md:4,children:e.jsx(Te,{fullWidth:!0,label:"年代（まで）",name:"yearTo",type:"number",value:d.yearTo,onChange:T})}),e.jsx(H,{item:!0,xs:12,md:4,children:e.jsxs(r,{sx:{display:"flex",gap:1,height:"100%"},children:[e.jsx($,{variant:"contained",color:"primary",onClick:Z,sx:{flexGrow:1},children:"フィルター適用"}),e.jsx($,{variant:"outlined",onClick:g,sx:{flexGrow:1},children:"クリア"})]})})]})}),e.jsxs(r,{sx:{display:"flex",alignItems:"center",mb:2},children:[e.jsx(Ie,{sx:{mr:1}}),e.jsxs(i,{variant:"body2",color:"text.secondary",children:["マップ上に表示された作品: ",o.length,"件 ",d.yearFrom&&d.yearTo&&`(${d.yearFrom}年〜${d.yearTo}年)`]})]})]}),s?e.jsx(r,{sx:{display:"flex",justifyContent:"center",py:4},children:e.jsx(Ee,{})}):e.jsxs(r,{sx:{height:600,bgcolor:"grey.200",position:"relative",borderRadius:1},children:[e.jsx(Ue,{markers:o,height:"600px",zoom:5,center:[35.6762,139.6503]}),e.jsxs(r,{sx:{position:"absolute",top:16,right:16,width:320,maxHeight:568,overflow:"auto",bgcolor:"background.paper",borderRadius:1,boxShadow:3,p:2,zIndex:1e3},children:[e.jsx(i,{variant:"h6",gutterBottom:!0,children:"作品リスト"}),o.length===0?e.jsx(i,{variant:"body2",children:"条件に一致する作品はありません"}):e.jsx(ut,{dense:!0,children:o.map(p=>e.jsxs(It.Fragment,{children:[e.jsx(mt,{onClick:()=>y(p),sx:{cursor:"pointer",bgcolor:m&&m.id===p.id?"action.selected":"transparent","&:hover":{bgcolor:"action.hover"}},children:e.jsx(gt,{primary:p.name,secondary:e.jsxs(e.Fragment,{children:[p.architectName&&e.jsxs("span",{children:[p.architectName,e.jsx("br",{})]}),p.completedYear>0&&`${p.completedYear}年 | `,p.city||""]})})}),e.jsx(qe,{component:"li"})]},p.id))})]})]}),e.jsx(xt,{anchor:"right",open:W,onClose:()=>_(!1),children:m&&e.jsxs(r,{sx:{width:350,p:3},children:[e.jsx(i,{variant:"h5",gutterBottom:!0,children:m.name}),e.jsxs(r,{sx:{mb:3},children:[m.architectName&&e.jsx(i,{variant:"subtitle1",color:"text.secondary",children:m.architectName}),e.jsxs(i,{variant:"body2",children:[m.completedYear>0&&`${m.completedYear}年`,m.city&&` | ${m.city}`]}),m.location&&e.jsx(i,{variant:"body2",sx:{mt:1},children:m.location})]}),e.jsx(r,{sx:{mb:3,height:200},children:e.jsx(Ue,{singleMarker:m,height:"200px",zoom:15,center:[m.latitude,m.longitude]})}),e.jsxs(r,{sx:{display:"flex",justifyContent:"space-between",mt:4},children:[e.jsx($,{variant:"outlined",onClick:()=>_(!1),children:"閉じる"}),e.jsx($,{variant:"contained",component:z,to:`/architecture/${m.id}`,children:"詳細を見る"})]})]})})]})};class Yt extends x.Component{constructor(t){super(t),this.state={hasError:!1,error:null,errorInfo:null}}static getDerivedStateFromError(t){return{hasError:!0,error:t,errorInfo:null}}componentDidCatch(t,o){console.error("Uncaught error:",t,o),this.setState({error:t,errorInfo:o})}handleRetry=()=>{window.location.reload()};render(){return this.state.hasError?this.props.fallback?this.props.fallback:e.jsx(r,{sx:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",padding:4,height:"100vh"},children:e.jsxs(ae,{elevation:3,sx:{padding:4,maxWidth:600,width:"100%",borderRadius:2,textAlign:"center"},children:[e.jsx(i,{variant:"h5",color:"error",gutterBottom:!0,children:"問題が発生しました"}),e.jsx(i,{variant:"body1",paragraph:!0,children:"アプリケーションで予期しないエラーが発生しました。 お手数ですが、再読み込みをお試しください。"}),!1,e.jsxs(r,{sx:{mt:3},children:[e.jsx($,{variant:"contained",color:"primary",onClick:this.handleRetry,sx:{mr:2},children:"ページを再読み込み"}),e.jsx($,{variant:"outlined",onClick:()=>window.location.href="/",children:"ホームに戻る"})]})]})}):this.props.children}}const Fr=()=>{try{const s=window?.location?.hostname||"";return/github\.io$/.test(s)}catch(s){return console.error("環境チェックエラー:",s),!1}},Lr=async()=>{try{const t=Fr();console.log("アプリケーション環境: 本番"),console.log(`GitHub Pages環境: ${t?"はい":"いいえ"}`);try{const f=await fetch(t?"./db/database-info.json":"/db/database-info.json");if(f.ok){const l=await f.json();console.log("データベース情報:"),console.log(`- ファイル: ${l.database}`),console.log(`- 更新日時: ${l.date}`),console.log(`- サイズ: ${(l.size/1024/1024).toFixed(2)} MB`),console.log(`- チャンク: ${l.chunks} (${l.chunkSize/1024}KB)のチャンク`),console.log(`- テーブル数: ${l.tables.length}`),console.log(`- インデックス数: ${l.indexes.length}`)}else console.warn("データベースメタデータが見つかりません:",f.status)}catch(o){console.warn("データベースメタデータ読み込みエラー:",o)}}catch(s){console.error("データベース設定ログエラー:",s)}},Or=({children:s})=>{const[t,o]=x.useState(Ar()),[f,l]=x.useState(null),[j,d]=x.useState(0);return x.useEffect(()=>{let c=!0,n;return(async()=>{t!==Me.READY&&setTimeout(async()=>{n=setInterval(()=>{c&&d(m=>{const S=(95-m)*.1;return Math.min(m+S,95)})},300);try{await Rt(),c&&(d(100),o(Me.READY))}catch(m){c&&(l(`データベースの初期化に失敗しました: ${m instanceof Error?m.message:"不明なエラー"}`),o(Me.ERROR))}finally{clearInterval(n)}},100)})(),()=>{c=!1,clearInterval(n)}},[t]),e.jsx(e.Fragment,{children:s})},st={primary:{main:"#2E3440",light:"#4C566A",dark:"#1B1F2B",contrastText:"#FFFFFF"},secondary:{main:"#88C0D0",light:"#B3D4E0",dark:"#5E81AC",contrastText:"#2E3440"},accent:{main:"#D08770",light:"#E5A088",dark:"#BF616A"},background:{default:"#ECEFF4",paper:"#FFFFFF",elevated:"#F8F9FA"},text:{primary:"#2E3440",secondary:"#4C566A",disabled:"#D8DEE9"},divider:"#E5E9F0",success:{main:"#A3BE8C",light:"#B8CCA3",dark:"#8CAF69"},warning:{main:"#EBCB8B",light:"#F0D5A3",dark:"#D4B571"},error:{main:"#BF616A",light:"#CC8088",dark:"#A54A56"},info:{main:"#88C0D0",light:"#B3D4E0",dark:"#5E81AC"}},Br={fontFamily:'"Inter", "Roboto", "Helvetica Neue", "Arial", sans-serif',h1:{fontSize:"3rem",fontWeight:700,lineHeight:1.2,letterSpacing:"-0.02em"},h2:{fontSize:"2.25rem",fontWeight:600,lineHeight:1.3,letterSpacing:"-0.01em"},h3:{fontSize:"1.875rem",fontWeight:600,lineHeight:1.3,letterSpacing:"-0.01em"},h4:{fontSize:"1.5rem",fontWeight:600,lineHeight:1.4},h5:{fontSize:"1.25rem",fontWeight:600,lineHeight:1.4},h6:{fontSize:"1.125rem",fontWeight:600,lineHeight:1.4},subtitle1:{fontSize:"1rem",fontWeight:500,lineHeight:1.5},subtitle2:{fontSize:"0.875rem",fontWeight:500,lineHeight:1.5},body1:{fontSize:"1rem",fontWeight:400,lineHeight:1.6},body2:{fontSize:"0.875rem",fontWeight:400,lineHeight:1.6},caption:{fontSize:"0.75rem",fontWeight:400,lineHeight:1.5},button:{fontSize:"0.875rem",fontWeight:600,textTransform:"none",letterSpacing:"0.02em"}},Pr={MuiButton:{styleOverrides:{root:{borderRadius:8,padding:"10px 24px",transition:"all 0.2s ease-in-out","&:hover":{transform:"translateY(-1px)",boxShadow:"0 4px 12px rgba(0, 0, 0, 0.15)"}},contained:{boxShadow:"0 2px 8px rgba(0, 0, 0, 0.1)"}}},MuiCard:{styleOverrides:{root:{borderRadius:12,boxShadow:"0 2px 12px rgba(0, 0, 0, 0.08)",transition:"all 0.3s ease-in-out","&:hover":{transform:"translateY(-2px)",boxShadow:"0 8px 24px rgba(0, 0, 0, 0.15)"}}}},MuiTextField:{styleOverrides:{root:{"& .MuiOutlinedInput-root":{borderRadius:8,transition:"all 0.2s ease-in-out","&:hover":{"& .MuiOutlinedInput-notchedOutline":{borderColor:st.secondary.main}},"&.Mui-focused":{"& .MuiOutlinedInput-notchedOutline":{borderColor:st.primary.main,borderWidth:2}}}}}},MuiAppBar:{styleOverrides:{root:{boxShadow:"0 2px 12px rgba(0, 0, 0, 0.1)",backdropFilter:"blur(10px)",backgroundColor:"rgba(46, 52, 64, 0.95)"}}},MuiChip:{styleOverrides:{root:{borderRadius:8,fontWeight:500}}},MuiPaper:{styleOverrides:{root:{borderRadius:12,boxShadow:"0 2px 12px rgba(0, 0, 0, 0.08)"},elevation1:{boxShadow:"0 2px 8px rgba(0, 0, 0, 0.06)"},elevation2:{boxShadow:"0 4px 12px rgba(0, 0, 0, 0.1)"},elevation3:{boxShadow:"0 8px 24px rgba(0, 0, 0, 0.15)"}}}},Nr=lr({palette:st,typography:Br,components:Pr,spacing:8,shape:{borderRadius:8},breakpoints:{values:{xs:0,sm:600,md:960,lg:1280,xl:1920}},transitions:{easing:{easeInOut:"cubic-bezier(0.4, 0, 0.2, 1)",easeOut:"cubic-bezier(0.0, 0, 0.2, 1)",easeIn:"cubic-bezier(0.4, 0, 1, 1)",sharp:"cubic-bezier(0.4, 0, 0.6, 1)"}}}),zr=()=>{const{pathname:s}=Qe();return x.useEffect(()=>{window.scrollTo(0,0)},[s]),null},Mr=()=>(x.useEffect(()=>{console.log("App running in production mode");try{Lr()}catch(s){console.warn("Failed to log database details:",s)}},[]),e.jsxs(e.Fragment,{children:[e.jsx(zr,{}),e.jsx(pr,{}),e.jsx("main",{className:"container",role:"main",children:e.jsx(Yt,{children:e.jsxs(ur,{children:[e.jsx(ve,{path:"/",element:e.jsx(Er,{})}),e.jsx(ve,{path:"/architecture",element:e.jsx(Ir,{})}),e.jsx(ve,{path:"/architecture/:id",element:e.jsx(Sr,{})}),e.jsx(ve,{path:"/architects",element:e.jsx(kr,{})}),e.jsx(ve,{path:"/architects/:id",element:e.jsx(_r,{})}),e.jsx(ve,{path:"/map",element:e.jsx(Yr,{})})]})})}),e.jsx(jr,{})]})),Hr=()=>e.jsx(Yt,{children:e.jsxs(cr,{theme:Nr,children:[e.jsx(dr,{}),e.jsx(xr,{children:e.jsx(Or,{children:e.jsx(Mr,{})})})]})});console.log("React アプリケーションを初期化中...","production");console.log("DOM root element:",document.getElementById("root"));const Ft=document.getElementById("root");if(!Ft)throw console.error('root要素が見つかりません。HTMLに<div id="root"></div>が存在するか確認してください。'),new Error("Failed to find the root element");const Zr=wt(Ft);console.log("Using HashRouter for GitHub Pages compatibility");try{Zr.render(e.jsx(It.StrictMode,{children:e.jsx(Hr,{})})),console.log("React アプリケーションのレンダリングが成功しました")}catch(s){console.error("React アプリケーションのレンダリング中にエラーが発生しました:",s)}
//# sourceMappingURL=index-DS8Nu8PG.js.map
